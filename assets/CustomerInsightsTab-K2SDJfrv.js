import{N as u,j as s,C as t,e as i,K as v,B as f,k as y,T as b,I as w,i as C,p as _,q as T,t as m,v as o,a as c,b as d,Q as A,a0 as P,W as R,X as k,Y as q,Z as B,a1 as D}from"./index-D0sg9aXi.js";import{P as j}from"./progress-kyMZixnj.js";import{P as L}from"./PermissionGuard-DbOiIV9e.js";const Q=({organizationId:n})=>{const{data:l,isLoading:p}=u(n),g=({active:e,payload:a,label:N})=>e&&a&&a.length?s.jsxs("div",{className:"p-2 bg-background border rounded-lg shadow-sm",children:[s.jsx("p",{className:"text-sm text-muted-foreground max-w-[200px] break-words",children:N}),s.jsx("p",{className:"font-bold text-foreground",children:`${a[0].value}% completion`})]}):null;if(p)return s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>s.jsx("div",{className:"h-32 bg-gray-200 rounded"},e))})]})});if(!l)return s.jsx(t,{children:s.jsxs(i,{className:"p-6 text-center",children:[s.jsx(v,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),s.jsx("p",{className:"text-gray-500",children:"No customer insights data available"})]})});const x=l.questions.map(e=>e.completion_rate),h=x.reduce((e,a)=>e+a,0)/x.length,r=l.questions.reduce((e,a)=>(a.completion_rate<80?e.lowCompletion.push(a):a.completion_rate>=90&&e.highPerforming.push(a),a.completion_rate<70&&e.needAttention.push(a),e),{highPerforming:[],needAttention:[],lowCompletion:[]});return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Customer Insights"}),s.jsxs(f,{variant:"outline",children:[l.summary.total_responses," total responses"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx(t,{children:s.jsxs(i,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(y,{className:"w-5 h-5 text-green-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Avg Completion Rate"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(h),"%"]}),s.jsx(j,{value:h,className:"mt-2"})]})]})}),s.jsx(t,{children:s.jsxs(i,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(b,{className:"w-5 h-5 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"High Performers"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"text-2xl font-bold",children:r.highPerforming.length}),s.jsx("div",{className:"text-sm text-gray-500",children:"questions ≥ 90% completion"})]})]})}),s.jsx(t,{children:s.jsxs(i,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(w,{className:"w-5 h-5 text-red-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Need Attention"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"text-2xl font-bold",children:r.needAttention.length}),s.jsx("div",{className:"text-sm text-gray-500",children:"questions < 70% completion"})]})]})}),s.jsx(t,{children:s.jsxs(i,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(C,{className:"w-5 h-5 text-orange-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Low Completion"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"text-2xl font-bold",children:r.lowCompletion.length}),s.jsx("div",{className:"text-sm text-gray-500",children:"questions < 80% completion"})]})]})})]}),s.jsxs(_,{defaultValue:"trends",className:"w-full",children:[s.jsxs(T,{className:"grid grid-cols-3 w-full max-w-md",children:[s.jsx(m,{value:"trends",children:"Trends"}),s.jsx(m,{value:"themes",children:"Themes"}),s.jsx(m,{value:"sessions",children:"Sessions"})]}),s.jsx(o,{value:"trends",className:"space-y-4",children:s.jsxs(t,{children:[s.jsx(c,{children:s.jsx(d,{children:"Feedback Trends"})}),s.jsx(i,{children:s.jsx("div",{className:"space-y-4",children:l.categories.map((e,a)=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:e.category}),s.jsxs("p",{className:"text-sm text-gray-600",children:[e.total_questions," questions • ",e.total_responses," responses"]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"text-sm text-gray-500",children:[e.completion_rate,"% completion"]})})]},a))})})]})}),s.jsx(o,{value:"themes",className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(t,{children:[s.jsx(c,{children:s.jsx(d,{className:"text-green-600",children:"High Performing Questions"})}),s.jsx(i,{children:s.jsxs("div",{className:"space-y-3",children:[r.highPerforming.slice(0,5).map((e,a)=>s.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border-l-4 border-green-500",children:[s.jsx("div",{className:"font-medium text-sm",children:e.question_text}),s.jsx("div",{className:"flex justify-between items-center mt-2",children:s.jsxs("span",{className:"text-sm text-gray-600",children:[e.total_responses," responses"]})})]},a)),r.highPerforming.length===0&&s.jsx("p",{className:"text-gray-500 text-center py-4",children:"No high performing questions yet"})]})})]}),s.jsxs(t,{children:[s.jsx(c,{children:s.jsx(d,{className:"text-red-600",children:"Questions Needing Attention"})}),s.jsx(i,{children:s.jsxs("div",{className:"space-y-3",children:[r.needAttention.slice(0,5).map((e,a)=>s.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border-l-4 border-red-500",children:[s.jsx("div",{className:"font-medium text-sm",children:e.question_text}),s.jsx("div",{className:"flex justify-between items-center mt-2",children:s.jsxs("span",{className:"text-sm text-gray-600",children:[e.total_responses," responses"]})})]},a)),r.needAttention.length===0&&s.jsx("p",{className:"text-gray-500 text-center py-4",children:"All questions performing well!"})]})})]})]})}),s.jsx(o,{value:"sessions",className:"space-y-4",children:s.jsxs(t,{children:[s.jsx(c,{children:s.jsx(d,{children:"Session Analysis"})}),s.jsx(i,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-3",children:"Completion Rate by Question"}),s.jsx("div",{className:"h-[300px]",children:s.jsx(A,{width:"100%",height:"100%",children:s.jsxs(P,{layout:"vertical",data:l.questions.slice(0,5).map(e=>({name:e.question_text,"Completion Rate":e.completion_rate})),margin:{top:5,right:20,left:10,bottom:5},children:[s.jsx(R,{strokeDasharray:"3 3",horizontal:!1}),s.jsx(k,{type:"number",domain:[0,100],unit:"%"}),s.jsx(q,{dataKey:"name",type:"category",width:60,tickLine:!1,axisLine:!1,tickFormatter:e=>e.length>15?`${e.substring(0,15)}...`:e}),s.jsx(B,{content:s.jsx(g,{}),cursor:{fill:"hsl(var(--muted))"}}),s.jsx(D,{dataKey:"Completion Rate",fill:"hsl(var(--primary))",barSize:20,radius:[0,4,4,0]})]})})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-3",children:"Response Distribution"}),s.jsx("div",{className:"space-y-2",children:l.categories.map((e,a)=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm",children:e.category}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(j,{value:e.total_responses/l.summary.total_responses*100,className:"w-16 h-2"}),s.jsx("span",{className:"text-sm font-medium",children:e.total_responses})]})]},a))})]})]})})]})})]})]})},S=({organizationId:n})=>s.jsx(L,{permission:"view_analytics",organizationId:n,showRequiredRole:!0,fallback:s.jsxs("div",{className:"text-center p-8",children:[s.jsx("p",{className:"text-gray-500",children:"You need viewer-level access or higher to view customer insights."}),s.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:s.jsx(Q,{organizationId:n})});export{S as CustomerInsightsTab,S as default};
