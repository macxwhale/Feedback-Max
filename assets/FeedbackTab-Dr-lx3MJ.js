import{a as k,j as e,C as l,b as o,d,f as c,s as m}from"./index-Dks8y0C-.js";import{R as h,C as j,X as p,Y as g,T as u,B as T}from"./generateCategoricalChart-BACluyv-.js";import{B as R}from"./BarChart-CuMitbLB.js";import{L as S,a as f}from"./LineChart-mYNCjnAW.js";import{P as A}from"./PermissionGuard-Cm_jM8-F.js";const w=({organizationId:a})=>{const{data:s,isLoading:y}=k({queryKey:["organization-specific-stats",a],queryFn:async()=>{const[t,r,i]=await Promise.all([m.from("feedback_responses").select("id, created_at, score").eq("organization_id",a),m.from("feedback_sessions").select("id, status, created_at, total_score").eq("organization_id",a),m.from("organization_users").select("id, created_at, status").eq("organization_id",a)]);return{responses:t.data||[],sessions:r.data||[],members:i.data||[]}},enabled:!!a});if(y)return e.jsx("div",{className:"p-8",children:"Loading organization statistics..."});const b=(s==null?void 0:s.sessions.filter(t=>t.status==="active").length)||0,N=(s==null?void 0:s.sessions.filter(t=>t.status==="completed").length)||0,v=(s==null?void 0:s.members.filter(t=>t.status==="active").length)||0,C=(s==null?void 0:s.responses.reduce((t,r)=>{const i=new Date(r.created_at).toLocaleString("default",{month:"short",year:"2-digit"}),n=t.find(x=>x.month===i);return n?n.responses++:t.push({month:i,responses:1}),t},[]))||[],_=(s==null?void 0:s.sessions.reduce((t,r)=>{const i=new Date(r.created_at).toLocaleString("default",{month:"short",year:"2-digit"}),n=t.find(x=>x.month===i);return n?(n.sessions++,r.status==="completed"&&n.completed++):t.push({month:i,sessions:1,completed:r.status==="completed"?1:0}),t},[]))||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Organization Analytics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(d,{className:"text-lg",children:"Total Responses"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold",children:(s==null?void 0:s.responses.length)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"All time"})]})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(d,{className:"text-lg",children:"Active Sessions"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:b}),e.jsx("p",{className:"text-sm text-gray-600",children:"Currently active"})]})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(d,{className:"text-lg",children:"Completed Sessions"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:N}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total completed"})]})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(d,{className:"text-lg",children:"Team Members"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:v}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active members"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(d,{children:"Monthly Response Trends"})}),e.jsx(c,{children:e.jsx(h,{width:"100%",height:300,children:e.jsxs(R,{data:C,children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(p,{dataKey:"month"}),e.jsx(g,{}),e.jsx(u,{}),e.jsx(T,{dataKey:"responses",fill:"#007ACE"})]})})})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(d,{children:"Session Completion Trends"})}),e.jsx(c,{children:e.jsx(h,{width:"100%",height:300,children:e.jsxs(S,{data:_,children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(p,{dataKey:"month"}),e.jsx(g,{}),e.jsx(u,{}),e.jsx(f,{type:"monotone",dataKey:"sessions",stroke:"#007ACE",strokeWidth:2,name:"Total Sessions"}),e.jsx(f,{type:"monotone",dataKey:"completed",stroke:"#10b981",strokeWidth:2,name:"Completed"})]})})})]})]})]})},B=({organizationId:a})=>e.jsx(A,{permission:"export_data",organizationId:a,showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need analyst-level access or higher to view detailed feedback analytics."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsx(w,{organizationId:a})});export{B as FeedbackTab,B as default};
