import{c as P,s as S,a3 as $,a4 as W,r as v,u as B,a5 as q,j as e,C as M,a as T,b as F,d as ne,e as A,a6 as L,g as f,a7 as re,w as ve,x as be,y as Y,z as O,A as we,E as I,S as Se,B as U,f as Ce,a8 as ke,a9 as ie,aa as le,ab as ce,ac as de,ad as oe,ae as me,af as ue,ag as he,ah as xe,ai as _e,aj as Me,ak as Ae,al as Pe,am as De,an as Te,ao as Fe,ap as pe,aq as j,ar as R,I as G,as as Ee,at as qe,au as ge,M as K,av as z,aw as je,K as V,ax as fe,T as Le,G as Ke,i as Ie,ay as Re,az as Ue,aA as Oe,aB as Be,aC as H,aD as Ve,aE as $e,aF as Ye,aG as X,aH as Z,aI as ee,aJ as se,aK as E,aL as He,aM as Qe,p as We,q as ze,t as ae,v as te,aN as ye}from"./index-3TPC94wt.js";import{P as Ne}from"./progress-vo3mRSR5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=P("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=P("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=P("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=P("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=P("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=P("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=P("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=P("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=P("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=P("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=P("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=P("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=P("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),cs=async s=>{const{data:a,error:t}=await S.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",s).order("created_at",{ascending:!1});if(t)throw t;return a},ds=async(s,a)=>{const{data:t,error:i}=await S.rpc("create_api_key",{p_organization_id:s,p_key_name:a});if(i)throw i;return t},os=async(s,a)=>{const{data:t,error:i}=await S.from("api_keys").update({status:a}).eq("id",s).select().single();if(i)throw i;return t},ms=({apiKey:s})=>{const[a,t]=v.useState(!1),i=()=>{navigator.clipboard.writeText(s),t(!0),j({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>t(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:s}),e.jsx(f,{variant:"ghost",size:"icon",onClick:i,children:a?e.jsx(pe,{className:"h-4 w-4 text-green-500"}):e.jsx(J,{className:"h-4 w-4"})})]})},us=()=>{const{organization:s}=$(),a=W(),[t,i]=v.useState(""),[n,c]=v.useState(null),m=["apiKeys",s==null?void 0:s.id],{data:d,isLoading:u}=B({queryKey:m,queryFn:()=>cs(s.id),enabled:!!s}),x=q({mutationFn:r=>ds(s.id,r),onSuccess:r=>{j({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),c(r),i(""),a.invalidateQueries({queryKey:m})},onError:r=>{j({title:"Error",description:r.message,variant:"destructive"})}}),l=q({mutationFn:({keyId:r,status:p})=>os(r,p),onSuccess:()=>{j({title:"Status Updated"}),a.invalidateQueries({queryKey:m})},onError:r=>{j({title:"Error",description:r.message,variant:"destructive"})}}),o=r=>{r.preventDefault(),t.trim()&&s&&x.mutate(t.trim())};return e.jsxs(M,{className:"w-full",children:[e.jsxs(T,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(as,{})," API Keys"]}),e.jsx(ne,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(A,{children:[e.jsxs("form",{onSubmit:o,className:"flex items-center gap-2 mb-6",children:[e.jsx(L,{placeholder:"New key name (e.g., 'SMS Integration')",value:t,onChange:r=>i(r.target.value),disabled:x.isPending}),e.jsxs(f,{type:"submit",disabled:!t.trim()||x.isPending,children:[x.isPending?e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Xe,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(ve,{children:[e.jsx(be,{children:e.jsxs(Y,{children:[e.jsx(O,{children:"Name"}),e.jsx(O,{children:"Key Prefix"}),e.jsx(O,{children:"Status"}),e.jsx(O,{children:"Last Used"}),e.jsx(O,{children:"Created"}),e.jsx(O,{className:"text-right",children:"Actions"})]})}),e.jsx(we,{children:u?Array.from({length:3}).map((r,p)=>e.jsx(Y,{children:e.jsx(I,{colSpan:6,children:e.jsx(Se,{className:"h-8 w-full"})})},p)):d&&d.length>0?d.map(r=>e.jsxs(Y,{children:[e.jsx(I,{className:"font-medium",children:r.key_name}),e.jsx(I,{children:e.jsxs("code",{children:[r.key_prefix,"..."]})}),e.jsx(I,{children:e.jsx(U,{variant:r.status==="active"?"default":"secondary",children:r.status})}),e.jsx(I,{children:r.last_used_at?`${Ce(new Date(r.last_used_at))} ago`:"Never"}),e.jsx(I,{children:ke(new Date(r.created_at),"MMM d, yyyy")}),e.jsx(I,{className:"text-right",children:e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",disabled:l.isPending,children:r.status==="active"?e.jsx(ns,{className:"h-4 w-4"}):e.jsx(rs,{className:"h-4 w-4"})})}),e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(oe,{children:"Are you sure?"}),e.jsxs(me,{children:["This will ",r.status==="active"?"deactivate":"activate"," the API key.",r.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(ue,{children:[e.jsx(he,{children:"Cancel"}),e.jsx(xe,{onClick:()=>l.mutate({keyId:r.id,status:r.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},r.id)):e.jsx(Y,{children:e.jsx(I,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(_e,{open:!!n,onOpenChange:r=>!r&&c(null),children:e.jsxs(Me,{children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:"API Key Created Successfully"}),e.jsx(De,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(ms,{apiKey:n||""}),e.jsx(Te,{children:e.jsx(Fe,{asChild:!0,children:e.jsx(f,{children:"Close"})})})]})})]})]})},hs=({organization:s,currentSettings:a,onSettingsUpdate:t})=>{var o,r,p,k;const[i,n]=v.useState(((o=a==null?void 0:a.sms_settings)==null?void 0:o.username)||""),[c,m]=v.useState(""),[d,u]=v.useState((a==null?void 0:a.sms_sender_id)||""),x=q({mutationFn:async()=>{const{data:N,error:C}=await S.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:(a==null?void 0:a.sms_enabled)||!1,senderId:d.trim(),username:i.trim(),apiKey:c.trim()}});if(C)throw C;return N},onSuccess:()=>{j({title:"Africa's Talking settings saved successfully",description:"Your SMS integration is now configured"}),m(""),t()},onError:N=>{j({title:"Error saving settings",description:N.message,variant:"destructive"})}}),l=N=>{var C;if(N.preventDefault(),!i.trim()){j({title:"Username required",description:"Please enter your Africa's Talking username",variant:"destructive"});return}if(!c.trim()&&!((C=a==null?void 0:a.sms_settings)!=null&&C.apiKey)){j({title:"API Key required",description:"Please enter your Africa's Talking API key",variant:"destructive"});return}x.mutate()};return e.jsxs(M,{className:"mt-4",children:[e.jsx(T,{children:e.jsx(F,{className:"text-lg",children:"Africa's Talking Configuration"})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"at-username",children:"Username *"}),e.jsx(L,{id:"at-username",value:i,onChange:N=>n(N.target.value),placeholder:"Your Africa's Talking username",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"at-sender-id",children:"Sender ID (Optional)"}),e.jsx(L,{id:"at-sender-id",value:d,onChange:N=>u(N.target.value),placeholder:"e.g., YourBrand",maxLength:11}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Max 11 characters. Leave blank to use default."})]})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"at-api-key",children:"API Key *"}),e.jsx(L,{id:"at-api-key",type:"password",value:c,onChange:N=>m(N.target.value),placeholder:(r=a==null?void 0:a.sms_settings)!=null&&r.apiKey?"Enter new API key (leave blank to keep current)":"Your Africa's Talking API key",required:!((p=a==null?void 0:a.sms_settings)!=null&&p.apiKey)}),((k=a==null?void 0:a.sms_settings)==null?void 0:k.apiKey)&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"API key is configured. Enter a new key only if you want to update it."})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(G,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Setup Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside text-blue-700 space-y-1 mt-1",children:[e.jsx("li",{children:"Get your credentials from Africa's Talking dashboard"}),e.jsx("li",{children:"Configure the webhook URL in your Africa's Talking app settings"}),e.jsx("li",{children:"Test the integration by sending an SMS to your shortcode"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{type:"submit",disabled:x.isPending,className:"flex items-center gap-2",children:[x.isPending?e.jsx(re,{className:"w-4 h-4 animate-spin"}):null,"Save Configuration"]}),e.jsxs(f,{type:"button",variant:"outline",onClick:()=>window.open("https://account.africastalking.com/","_blank"),className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),"Open Dashboard"]})]})]})})]})},xs=({enabled:s,onToggle:a,isLoading:t})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"SMS Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to provide feedback via SMS"})]}),e.jsx(Ee,{checked:s,onCheckedChange:a,disabled:t})]}),ps=({webhookSecret:s,isVisible:a})=>{const[t,i]=v.useState(!1),c=`https://rigurrwjiaucodxuuzeh.supabase.co/functions/v1/handle-sms-webhook?secret=${s}`,m=async()=>{try{await navigator.clipboard.writeText(c),j({title:"Webhook URL copied to clipboard"})}catch(d){console.error("Failed to copy webhook URL:",d),j({title:"Failed to copy URL",description:"Please copy the URL manually",variant:"destructive"})}};return!a||!s?null:e.jsxs(M,{children:[e.jsx(T,{children:e.jsx(F,{className:"text-sm font-medium",children:"SMS Webhook URL"})}),e.jsxs(A,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use this URL in your SMS provider's webhook configuration to receive incoming SMS messages."}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:t?c:"•".repeat(50),readOnly:!0,className:"font-mono text-xs"}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>i(!t),children:t?e.jsx(qe,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:m,children:e.jsx(J,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Method:"})," POST"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Content-Type:"})," application/x-www-form-urlencoded or application/json"]})]})]})]})},gs=({providers:s,selectedProvider:a,onProviderSelect:t})=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Available Providers"}),s.map(i=>{const n=i.icon;return e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${a===i.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>i.status==="available"&&t(a===i.id?null:i.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:i.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:i.status==="available"?e.jsxs(e.Fragment,{children:[e.jsx(U,{variant:"default",children:"Available"}),a===i.id&&e.jsx(pe,{className:"w-4 h-4 text-blue-500"})]}):e.jsx(U,{variant:"secondary",children:"Coming Soon"})})]})},i.id)})]}),js=[{id:"africastalking",name:"Africa's Talking",description:"SMS services across Africa with reliable delivery",icon:K,status:"available"},{id:"twilio",name:"Twilio",description:"Global SMS and communication platform",icon:K,status:"coming_soon"},{id:"vonage",name:"Vonage",description:"SMS API for global messaging",icon:K,status:"coming_soon"}],Q=(s,a)=>{if(!s||typeof s!="object")return"";const t=s[a];return typeof t=="string"?t:""},fs=s=>{if(!s||typeof s!="object")return!1;const a=Q(s,"username"),t=Q(s,"apiKey");return a.length>0&&t.length>0},ys=()=>e.jsxs(T,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Integrations"]}),e.jsx(ne,{children:"Enable SMS feedback collection from your customers"})]}),Ns=({title:s="SMS Integrations"})=>e.jsxs(M,{children:[e.jsx(T,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),s]})}),e.jsx(A,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}),vs=({title:s="SMS Integrations",message:a,onRetry:t})=>e.jsxs(M,{children:[e.jsx(T,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-red-500"}),s]})}),e.jsx(A,{children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-sm text-red-600 mb-2",children:"Organization not found or failed to load"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:a}),t&&e.jsx("button",{onClick:t,className:"text-sm text-blue-600 hover:underline",children:"Try again"})]})})]}),bs=()=>e.jsxs(M,{children:[e.jsx(T,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(A,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"You need admin access to manage SMS integrations."})})]}),ws=({phoneNumber:s,name:a,onPhoneNumberChange:t,onNameChange:i,onSubmit:n,isLoading:c})=>e.jsx("form",{onSubmit:n,className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"phone-number",children:"Phone Number *"}),e.jsx(L,{id:"phone-number",value:s,onChange:m=>t(m.target.value),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"name",children:"Name (Optional)"}),e.jsx(L,{id:"name",value:a,onChange:m=>i(m.target.value),placeholder:"John Doe"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(f,{type:"submit",disabled:c,className:"w-full",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Add Number"]})})]})}),Ss=({bulkNumbers:s,onBulkNumbersChange:a,onBulkAdd:t,onCancel:i,isLoading:n})=>e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"bulk-numbers",children:"Bulk Add Phone Numbers"}),e.jsx(je,{id:"bulk-numbers",value:s,onChange:c=>a(c.target.value),placeholder:"Enter phone numbers, one per line. Format: +1234567890 or +1234567890,John Doe",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Format: One phone number per line. Optionally add name after comma."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:t,disabled:n,children:"Add All Numbers"}),e.jsx(f,{variant:"outline",onClick:i,children:"Cancel"})]})]}),Cs=({phoneNumbers:s,onDelete:a,isDeleting:t})=>{const i=n=>n.startsWith("+")?n:`+${n}`;return s.length===0?e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No phone numbers added yet."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers to start sending SMS campaigns."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Registered Phone Numbers"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:i(n.phone_number)}),n.name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:n.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(U,{variant:n.status==="active"?"default":"secondary",children:n.status}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Added ",new Date(n.created_at).toLocaleDateString()]})]})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>a(n.id),disabled:t,children:e.jsx(fe,{className:"w-4 h-4"})})]},n.id))})]})},ks=()=>{const{organization:s}=$(),a=W(),[t,i]=v.useState(""),[n,c]=v.useState(""),[m,d]=v.useState(""),[u,x]=v.useState(!1),{data:l,isLoading:o}=B({queryKey:["sms-phone-numbers",s==null?void 0:s.id],queryFn:async()=>{const{data:h,error:g}=await S.from("sms_phone_numbers").select("*").eq("organization_id",s.id).order("created_at",{ascending:!1});if(g)throw g;return h},enabled:!!(s!=null&&s.id)}),r=q({mutationFn:async({phoneNumber:h,name:g})=>{const{data:y,error:b}=await S.from("sms_phone_numbers").insert({organization_id:s.id,phone_number:h.trim(),name:(g==null?void 0:g.trim())||null}).select().single();if(b)throw b;return y},onSuccess:()=>{j({title:"Phone number added successfully"}),i(""),c(""),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:h=>{j({title:"Error adding phone number",description:h.message,variant:"destructive"})}}),p=q({mutationFn:async h=>{const{data:g,error:y}=await S.from("sms_phone_numbers").insert(h.map(({phoneNumber:b,name:D})=>({organization_id:s.id,phone_number:b.trim(),name:(D==null?void 0:D.trim())||null})));if(y)throw y;return g},onSuccess:()=>{j({title:"Phone numbers added successfully"}),d(""),x(!1),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:h=>{j({title:"Error adding phone numbers",description:h.message,variant:"destructive"})}}),k=q({mutationFn:async h=>{const{error:g}=await S.from("sms_phone_numbers").delete().eq("id",h);if(g)throw g},onSuccess:()=>{j({title:"Phone number removed successfully"}),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:h=>{j({title:"Error removing phone number",description:h.message,variant:"destructive"})}}),N=h=>{h.preventDefault(),t.trim()&&r.mutate({phoneNumber:t,name:n})},C=()=>{const g=m.split(`
`).filter(y=>y.trim()).map(y=>{const b=y.split(",").map(D=>D.trim());return{phoneNumber:b[0],name:b[1]||void 0}}).filter(y=>y.phoneNumber);if(g.length===0){j({title:"No valid phone numbers found",description:"Please enter at least one phone number",variant:"destructive"});return}p.mutate(g)};return o?e.jsxs(M,{children:[e.jsx(T,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Phone Numbers"]})}),e.jsx(A,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}):e.jsxs(M,{children:[e.jsx(T,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Phone Numbers (",(l==null?void 0:l.length)||0,")"]})}),e.jsxs(A,{className:"space-y-6",children:[e.jsx(ws,{phoneNumber:t,name:n,onPhoneNumberChange:i,onNameChange:c,onSubmit:N,isLoading:r.isPending}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(f,{variant:"outline",onClick:()=>x(!u),children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Bulk Add"]})}),u&&e.jsx(Ss,{bulkNumbers:m,onBulkNumbersChange:d,onBulkAdd:C,onCancel:()=>x(!1),isLoading:p.isPending}),e.jsx(Cs,{phoneNumbers:l||[],onDelete:h=>k.mutate(h),isDeleting:k.isPending})]})]})},_s=()=>{const{organization:s}=$(),a=W(),{data:t,isLoading:i,error:n}=B({queryKey:["sms-campaigns",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return[];console.log("Fetching SMS campaigns for organization:",s.id);const{data:l,error:o}=await S.from("sms_campaigns").select("*").eq("organization_id",s.id).order("created_at",{ascending:!1});if(o)throw console.error("Error fetching SMS campaigns:",o),o;return console.log("SMS campaigns fetched:",(l==null?void 0:l.length)||0),l||[]},enabled:!!(s!=null&&s.id),retry:2,retryDelay:1e3}),{data:c,isLoading:m,error:d}=B({queryKey:["sms-phone-numbers",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return[];console.log("Fetching SMS phone numbers for organization:",s.id);const{data:l,error:o}=await S.from("sms_phone_numbers").select("*").eq("organization_id",s.id).eq("status","active");if(o)throw console.error("Error fetching SMS phone numbers:",o),o;return console.log("SMS phone numbers fetched:",(l==null?void 0:l.length)||0),l||[]},enabled:!!(s!=null&&s.id),retry:2,retryDelay:1e3}),u=q({mutationFn:async({name:l,template:o})=>{if(!(s!=null&&s.id))throw new Error("Organization not found");if(!l.trim())throw new Error("Campaign name is required");if(!o.trim())throw new Error("Message template is required");console.log("Creating SMS campaign:",{name:l,template:o,orgId:s.id});const{data:r,error:p}=await S.from("sms_campaigns").insert({organization_id:s.id,name:l.trim(),message_template:o.trim(),total_recipients:(c==null?void 0:c.length)||0}).select().single();if(p)throw console.error("Error creating SMS campaign:",p),p;return console.log("SMS campaign created:",r),r},onSuccess:()=>{j({title:"Campaign created successfully"}),a.invalidateQueries({queryKey:["sms-campaigns",s==null?void 0:s.id]})},onError:l=>{console.error("Create campaign error:",l),j({title:"Error creating campaign",description:l.message||"An unexpected error occurred",variant:"destructive"})}}),x=q({mutationFn:async({campaignId:l,isResend:o=!1,isRetry:r=!1})=>{if(!(s!=null&&s.id))throw new Error("Organization not found");if(!c||c.length===0)throw new Error("No active phone numbers found");const p=t==null?void 0:t.find(h=>h.id===l);if(!p)throw new Error("Campaign not found");console.log("Sending SMS campaign:",{campaignId:l,isResend:o,isRetry:r,recipientCount:c.length}),await S.from("sms_campaigns").update({status:"sending",started_at:new Date().toISOString()}).eq("id",l);let k=c.map(h=>h.phone_number);if(o){const{data:h}=await S.from("sms_sends").select("phone_number").eq("campaign_id",l).eq("status","failed");if(h&&h.length>0)k=h.map(g=>g.phone_number);else throw new Error("No failed sends to retry for this campaign")}r&&(k=c.map(h=>h.phone_number));const{data:N,error:C}=await S.functions.invoke("send-sms",{body:{phoneNumbers:k,message:p.message_template,organizationId:s.id,campaignId:l}});if(C)throw console.error("Error sending SMS campaign:",C),new Error(C.message||"Failed to send campaign");return console.log("SMS campaign sent successfully:",N),N},onSuccess:(l,o)=>{let r="Sent";o.isResend&&(r="Resent"),o.isRetry&&(r="Retried"),j({title:`Campaign ${r.toLowerCase()} successfully`,description:`${r} to ${l.summary.sent} recipients`}),a.invalidateQueries({queryKey:["sms-campaigns",s==null?void 0:s.id]})},onError:l=>{console.error("Send campaign error:",l),j({title:"Error sending campaign",description:l.message||"An unexpected error occurred",variant:"destructive"})}});return{campaigns:t||[],campaignsLoading:i,campaignsError:n,phoneNumbers:c||[],phoneNumbersLoading:m,phoneNumbersError:d,createCampaignMutation:u,sendCampaignMutation:x,organization:s}},Ms=({onSubmit:s,onCancel:a,isLoading:t,phoneNumbersCount:i,organizationName:n})=>{const[c,m]=v.useState(""),[d,u]=v.useState(""),x=`Hi! We'd love your feedback on our service. Please text back 'START' to begin a quick survey. Your input helps us improve. Thank you! - ${n||"Your Company"}`,l=o=>{o.preventDefault(),!(!c.trim()||!d.trim())&&(s(c,d),m(""),u(""))};return e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium",children:"Create New Campaign"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"campaign-name",children:"Campaign Name *"}),e.jsx(L,{id:"campaign-name",value:c,onChange:o=>m(o.target.value),placeholder:"Feedback Request Campaign",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"message-template",children:"Message Template *"}),e.jsx(je,{id:"message-template",value:d,onChange:o=>u(o.target.value),placeholder:x,rows:4,required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Recipients: ",i," active phone numbers"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:t,children:"Create Campaign"}),e.jsx(f,{type:"button",variant:"outline",onClick:a,children:"Cancel"})]})]})]})},As=({campaign:s})=>{const a=s.sent_count>0?s.delivered_count/s.sent_count*100:0,t=s.sent_count>0?s.failed_count/s.sent_count*100:0,i=s.total_recipients>0?s.sent_count/s.total_recipients*100:0,n=()=>{if(!s.started_at)return null;const c=new Date(s.started_at),d=(s.completed_at?new Date(s.completed_at):new Date).getTime()-c.getTime(),u=Math.round(d/(1e3*60));return u<60?`${u}m`:`${Math.round(u/60)}h ${u%60}m`};return e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(V,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:s.sent_count}),e.jsx("div",{className:"text-xs text-blue-600",children:"Sent"}),e.jsx(Ne,{value:i,className:"h-1 mt-1"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 rounded-lg",children:[e.jsx(Le,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-green-900",children:[a.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-green-600",children:"Delivered"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.delivered_count,"/",s.sent_count]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 rounded-lg",children:[e.jsx(Ke,{className:"w-4 h-4 text-red-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-red-900",children:[t.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-red-600",children:"Failed"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.failed_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-purple-50 rounded-lg",children:[e.jsx(Ie,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-purple-900",children:n()||"N/A"}),e.jsx("div",{className:"text-xs text-purple-600",children:"Duration"}),e.jsx(U,{variant:"outline",className:"text-xs mt-1",children:s.status})]})]})]})},Ps=({campaign:s,onSend:a,onResend:t,onRetry:i,onDuplicate:n,onSchedule:c,onDelete:m,isLoading:d})=>{const[u,x]=v.useState(!1),l=p=>{switch(p){case"completed":return"default";case"sending":return"secondary";case"failed":return"destructive";case"draft":return"outline";default:return"secondary"}},o=p=>{switch(p){case"completed":return"text-green-600";case"sending":return"text-blue-600";case"failed":return"text-red-600";case"draft":return"text-gray-600";default:return"text-gray-600"}},r=s.total_recipients>0?s.sent_count/s.total_recipients*100:0;return e.jsx(M,{className:"transition-all duration-200 hover:shadow-md",children:e.jsxs(A,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h5",{className:"font-semibold text-lg",children:s.name}),e.jsx(U,{variant:l(s.status),className:o(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Created ",new Date(s.created_at).toLocaleDateString()," • ",s.total_recipients," recipients"]}),s.status==="sending"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Sending Progress"}),e.jsxs("span",{children:[s.sent_count,"/",s.total_recipients]})]}),e.jsx(Ne,{value:r,className:"h-2"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="draft"&&e.jsxs(f,{size:"sm",onClick:()=>a(s.id),disabled:d,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ts,{className:"w-4 h-4 mr-2"}),"Send Now"]}),s.status==="failed"&&e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>i(s.id),disabled:d,children:[e.jsx(is,{className:"w-4 h-4 mr-2"}),"Retry"]}),s.status==="completed"&&s.failed_count>0&&e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>t(s.id),disabled:d,children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Resend Failed"]}),e.jsxs(Ue,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm",children:e.jsx(Ze,{className:"w-4 h-4"})})}),e.jsxs(Be,{align:"end",children:[e.jsxs(H,{onClick:()=>x(!u),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),u?"Hide":"Show"," Analytics"]}),e.jsxs(H,{onClick:()=>n(s.id),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Duplicate Campaign"]}),s.status==="draft"&&e.jsxs(H,{onClick:()=>c(s.id),children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Schedule Campaign"]}),e.jsx($e,{}),e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsxs(H,{onSelect:p=>p.preventDefault(),className:"text-red-600",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Delete Campaign"]})}),e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(oe,{children:"Delete Campaign"}),e.jsxs(me,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone.']})]}),e.jsxs(ue,{children:[e.jsx(he,{children:"Cancel"}),e.jsx(xe,{onClick:()=>m(s.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Message Preview:"}),e.jsx("p",{className:"text-sm text-blue-800 leading-relaxed",children:s.message_template.length>120?`${s.message_template.substring(0,120)}...`:s.message_template})]})}),u&&e.jsx(As,{campaign:s})]})})},Ds=({searchTerm:s,onSearchChange:a,statusFilter:t,onStatusFilterChange:i,sortBy:n,onSortByChange:c,sortOrder:m,onSortOrderChange:d,totalCampaigns:u,filteredCount:x})=>{const l=()=>{a(""),i("all"),c("created_at"),d("desc")},o=s||t!=="all";return e.jsxs("div",{className:"w-full space-y-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters"}),o&&e.jsxs(U,{variant:"secondary",className:"text-xs",children:[x," of ",u]})]}),o&&e.jsx(f,{variant:"ghost",size:"sm",onClick:l,children:"Clear All"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(L,{placeholder:"Search campaigns...",value:s,onChange:r=>a(r.target.value),className:"pl-10 w-full"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(X,{value:t,onValueChange:i,children:[e.jsx(Z,{className:"w-full sm:w-[150px]",children:e.jsx(ee,{placeholder:"Status"})}),e.jsxs(se,{children:[e.jsx(E,{value:"all",children:"All Status"}),e.jsx(E,{value:"draft",children:"Draft"}),e.jsx(E,{value:"sending",children:"Sending"}),e.jsx(E,{value:"completed",children:"Completed"}),e.jsx(E,{value:"failed",children:"Failed"})]})]}),e.jsxs(X,{value:n,onValueChange:c,children:[e.jsx(Z,{className:"w-full sm:w-[150px]",children:e.jsx(ee,{placeholder:"Sort by"})}),e.jsxs(se,{children:[e.jsx(E,{value:"created_at",children:"Created Date"}),e.jsx(E,{value:"name",children:"Name"}),e.jsx(E,{value:"total_recipients",children:"Recipients"}),e.jsx(E,{value:"delivered_count",children:"Delivery Rate"})]})]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>d(m==="asc"?"desc":"asc"),className:"w-full sm:w-auto",children:m==="asc"?e.jsx(Je,{className:"w-4 h-4"}):e.jsx(Ge,{className:"w-4 h-4"})})]})]})]})},Ts=({campaigns:s,onSend:a,onResend:t,onRetry:i,onDuplicate:n,onSchedule:c,onDelete:m,onCreateNew:d,isLoading:u})=>{const[x,l]=v.useState(""),[o,r]=v.useState("all"),[p,k]=v.useState("created_at"),[N,C]=v.useState("desc"),h=v.useMemo(()=>{let y=s.filter(b=>{const D=x===""||b.name.toLowerCase().includes(x.toLowerCase())||b.message_template.toLowerCase().includes(x.toLowerCase()),_=o==="all"||b.status===o;return D&&_});return y.sort((b,D)=>{let _=b[p],w=D[p];return p==="created_at"||p==="started_at"||p==="completed_at"?(_=new Date(_||0).getTime(),w=new Date(w||0).getTime()):typeof _=="string"&&(_=_.toLowerCase(),w=w.toLowerCase()),_<w?N==="asc"?-1:1:_>w?N==="asc"?1:-1:0}),y},[s,x,o,p,N]),g=()=>{const y=[["Name","Status","Recipients","Sent","Delivered","Failed","Created"],...h.map(w=>[w.name,w.status,w.total_recipients.toString(),w.sent_count.toString(),w.delivered_count.toString(),w.failed_count.toString(),new Date(w.created_at).toLocaleDateString()])].map(w=>w.join(",")).join(`
`),b=new Blob([y],{type:"text/csv"}),D=URL.createObjectURL(b),_=document.createElement("a");_.href=D,_.download=`sms-campaigns-${new Date().toISOString().split("T")[0]}.csv`,_.click(),URL.revokeObjectURL(D)};return s.length===0?e.jsxs("div",{className:"w-full text-center p-12",children:[e.jsx(He,{className:"w-16 h-16 mx-auto mb-6 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No SMS Campaigns Yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Create your first SMS campaign to start engaging with your customers through text messaging."}),e.jsxs(f,{onClick:d,size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(z,{className:"w-5 h-5 mr-2"}),"Create First Campaign"]})]}):e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold",children:["SMS Campaigns (",s.length,")"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",h.length," of ",s.length," campaigns"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:g,className:"w-full sm:w-auto",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(f,{onClick:d,size:"sm",className:"w-full sm:w-auto",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"New Campaign"]})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(Ds,{searchTerm:x,onSearchChange:l,statusFilter:o,onStatusFilterChange:r,sortBy:p,onSortByChange:k,sortOrder:N,onSortOrderChange:C,totalCampaigns:s.length,filteredCount:h.length})}),h.length===0?e.jsxs("div",{className:"w-full text-center p-8 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500",children:"No campaigns match your current filters."}),e.jsx(f,{variant:"ghost",onClick:()=>{l(""),r("all")},className:"mt-2",children:"Clear Filters"})]}):e.jsx("div",{className:"w-full space-y-4",children:h.map(y=>e.jsx("div",{className:"w-full",children:e.jsx(Ps,{campaign:y,onSend:a,onResend:t,onRetry:i,onDuplicate:n,onSchedule:c,onDelete:m,isLoading:u})},y.id))})]})},Fs=()=>e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No active phone numbers found."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers before creating campaigns."})]}),Es=()=>{const[s,a]=v.useState(!1),{campaigns:t,campaignsLoading:i,campaignsError:n,phoneNumbers:c,phoneNumbersLoading:m,phoneNumbersError:d,createCampaignMutation:u,sendCampaignMutation:x,organization:l}=_s(),o=(g,y)=>{u.mutate({name:g,template:y},{onSuccess:()=>{a(!1)}})},r=g=>{x.mutate({campaignId:g})},p=g=>{x.mutate({campaignId:g,isResend:!0})},k=g=>{x.mutate({campaignId:g,isRetry:!0})},N=g=>{const y=t.find(b=>b.id===g);y&&(u.mutate({name:`${y.name} (Copy)`,template:y.message_template}),j({title:"Campaign duplicated successfully"}))},C=g=>{j({title:"Scheduling feature coming soon",description:"Campaign scheduling will be available in the next update."})},h=g=>{j({title:"Delete feature coming soon",description:"Campaign deletion will be available in the next update."})};return i||m?e.jsx("div",{className:"w-full",children:e.jsxs(M,{className:"w-full",children:[e.jsx(T,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(A,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]})}):n||d?e.jsx("div",{className:"w-full",children:e.jsxs(M,{className:"w-full",children:[e.jsx(T,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 rounded-lg",children:[e.jsx(G,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Failed to load campaigns or phone numbers"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:(n==null?void 0:n.message)||(d==null?void 0:d.message)||"An unexpected error occurred"})]})]})})]})}):e.jsx("div",{className:"w-full",children:e.jsxs(M,{className:"w-full",children:[e.jsx(T,{children:e.jsx(F,{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Campaigns"]})})}),e.jsx(A,{className:"space-y-6 p-6",children:c.length===0?e.jsx(Fs,{}):e.jsxs("div",{className:"w-full space-y-6",children:[s&&e.jsx("div",{className:"w-full",children:e.jsx(Ms,{onSubmit:o,onCancel:()=>a(!1),isLoading:u.isPending,phoneNumbersCount:c.length,organizationName:l==null?void 0:l.name})}),e.jsx("div",{className:"w-full",children:e.jsx(Ts,{campaigns:t,onSend:r,onResend:p,onRetry:k,onDuplicate:N,onSchedule:C,onDelete:h,onCreateNew:()=>a(!0),isLoading:x.isPending})})]})})]})})},qs=()=>e.jsx("div",{className:"w-full mt-6",children:e.jsxs(We,{defaultValue:"phone-numbers",className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(ae,{value:"phone-numbers",className:"flex-1",children:"Phone Numbers"}),e.jsx(ae,{value:"campaigns",className:"flex-1",children:"Campaigns"})]}),e.jsx(te,{value:"phone-numbers",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(ks,{})})}),e.jsx(te,{value:"campaigns",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Es,{})})})]})}),Ls=()=>{const{organization:s}=$(),a=W(),{data:t,isLoading:i,error:n}=B({queryKey:["organization-sms-settings",s==null?void 0:s.id],queryFn:async()=>{console.log("Fetching SMS settings for organization:",s==null?void 0:s.id);const{data:m,error:d}=await S.from("organizations").select("sms_enabled, sms_sender_id, sms_settings, webhook_secret").eq("id",s.id).single();if(d)throw console.error("Error fetching organization SMS settings:",d),d;return console.log("Organization SMS settings fetched:",m),m},enabled:!!(s!=null&&s.id),retry:3,retryDelay:1e3}),c=q({mutationFn:async m=>{if(!(s!=null&&s.id))throw new Error("Organization not found");console.log("Updating SMS status:",{enabled:m,orgId:s.id});const{data:d,error:u}=await S.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:m,senderId:(t==null?void 0:t.sms_sender_id)||"",username:Q(t==null?void 0:t.sms_settings,"username"),apiKey:Q(t==null?void 0:t.sms_settings,"apiKey")}});if(u)throw console.error("SMS status update error:",u),new Error(u.message||"Failed to update SMS settings");return console.log("SMS status updated successfully:",d),d},onSuccess:()=>{j({title:"SMS status updated successfully"}),a.invalidateQueries({queryKey:["organization-sms-settings",s==null?void 0:s.id]})},onError:m=>{console.error("SMS toggle error:",m),j({title:"Error updating SMS status",description:m.message||"An unexpected error occurred",variant:"destructive"})}});return{orgData:t,isLoading:i,error:n,updateSmsStatus:c,organization:s}},Ks=()=>{const{isAdmin:s,isOrgAdmin:a}=ye(),[t,i]=v.useState(null),{orgData:n,isLoading:c,error:m,updateSmsStatus:d,organization:u}=Ls(),x=s||a,l=r=>{if(!x){j({title:"Access denied",description:"You need admin access to manage SMS settings",variant:"destructive"});return}if(!(u!=null&&u.id)){j({title:"Error",description:"Organization not found",variant:"destructive"});return}d.mutate(r)};if(!x)return e.jsx(bs,{});if(c)return e.jsx(Ns,{});if(m){const r=typeof m=="string"?m:"Failed to load SMS settings";return e.jsx(vs,{message:r})}const o=(n==null?void 0:n.sms_enabled)&&fs(n==null?void 0:n.sms_settings);return e.jsx("div",{className:"w-full",children:e.jsxs(M,{className:"w-full",children:[e.jsx(ys,{}),e.jsxs(A,{className:"space-y-6 p-6",children:[e.jsx(xs,{enabled:(n==null?void 0:n.sms_enabled)||!1,onToggle:l,isLoading:d.isPending}),(n==null?void 0:n.sms_enabled)&&e.jsx(ps,{webhookSecret:(n==null?void 0:n.webhook_secret)||"",isVisible:!0}),e.jsx(gs,{providers:js,selectedProvider:t,onProviderSelect:i}),t==="africastalking"&&e.jsx(hs,{organization:u,currentSettings:n,onSettingsUpdate:()=>{}}),o&&e.jsx("div",{className:"w-full",children:e.jsx(qs,{})})]})]})})},Us=()=>{const{isAdmin:s,isOrgAdmin:a}=ye();return $(),s||a?e.jsxs("div",{className:"w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."})]}),e.jsx("div",{className:"w-full",children:e.jsx(Ks,{})}),e.jsx("div",{className:"w-full",children:e.jsx(us,{})})]}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage integrations."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]})};export{Us as IntegrationsTab,Us as default};
