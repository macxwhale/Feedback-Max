import{c as I,s as y,a4 as B,a5 as H,r as N,u as R,a6 as M,j as e,C,a as S,b as P,d as V,e as _,a7 as E,g as f,a8 as G,w as se,x as ae,y as O,z as L,A as te,E as q,S as ne,B as U,f as ie,a9 as re,aa as le,ab as de,ac as ce,ad as oe,ae as me,af as ue,ag as he,ah as xe,ai as pe,aj as je,ak as ge,al as ye,am as fe,an as ve,ao as be,ap as Ne,aq as J,ar as o,as as K,I as X,at as we,K as Y,au as Z,av as z,aw as ke,M as T,ax as Ce,ay as ee,p as _e,q as Ae,t as $,v as W,az as Se}from"./index-D0sg9aXi.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=I("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=I("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=I("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=I("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=I("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=I("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=I("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=I("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Le=async s=>{const{data:a,error:d}=await y.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",s).order("created_at",{ascending:!1});if(d)throw d;return a},De=async(s,a)=>{const{data:d,error:l}=await y.rpc("create_api_key",{p_organization_id:s,p_key_name:a});if(l)throw l;return d},Re=async(s,a)=>{const{data:d,error:l}=await y.from("api_keys").update({status:a}).eq("id",s).select().single();if(l)throw l;return d},Ue=({apiKey:s})=>{const[a,d]=N.useState(!1),l=()=>{navigator.clipboard.writeText(s),d(!0),o({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>d(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:s}),e.jsx(f,{variant:"ghost",size:"icon",onClick:l,children:a?e.jsx(J,{className:"h-4 w-4 text-green-500"}):e.jsx(Me,{className:"h-4 w-4"})})]})},Be=()=>{const{organization:s}=B(),a=H(),[d,l]=N.useState(""),[x,v]=N.useState(null),p=["apiKeys",s==null?void 0:s.id],{data:i,isLoading:u}=R({queryKey:p,queryFn:()=>Le(s.id),enabled:!!s}),h=M({mutationFn:t=>De(s.id,t),onSuccess:t=>{o({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),v(t),l(""),a.invalidateQueries({queryKey:p})},onError:t=>{o({title:"Error",description:t.message,variant:"destructive"})}}),c=M({mutationFn:({keyId:t,status:j})=>Re(t,j),onSuccess:()=>{o({title:"Status Updated"}),a.invalidateQueries({queryKey:p})},onError:t=>{o({title:"Error",description:t.message,variant:"destructive"})}}),k=t=>{t.preventDefault(),d.trim()&&s&&h.mutate(d.trim())};return e.jsxs(C,{className:"col-span-1 lg:col-span-2",children:[e.jsxs(S,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Ke,{})," API Keys"]}),e.jsx(V,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(_,{children:[e.jsxs("form",{onSubmit:k,className:"flex items-center gap-2 mb-6",children:[e.jsx(E,{placeholder:"New key name (e.g., 'SMS Integration')",value:d,onChange:t=>l(t.target.value),disabled:h.isPending}),e.jsxs(f,{type:"submit",disabled:!d.trim()||h.isPending,children:[h.isPending?e.jsx(G,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(O,{children:[e.jsx(L,{children:"Name"}),e.jsx(L,{children:"Key Prefix"}),e.jsx(L,{children:"Status"}),e.jsx(L,{children:"Last Used"}),e.jsx(L,{children:"Created"}),e.jsx(L,{className:"text-right",children:"Actions"})]})}),e.jsx(te,{children:u?Array.from({length:3}).map((t,j)=>e.jsx(O,{children:e.jsx(q,{colSpan:6,children:e.jsx(ne,{className:"h-8 w-full"})})},j)):i&&i.length>0?i.map(t=>e.jsxs(O,{children:[e.jsx(q,{className:"font-medium",children:t.key_name}),e.jsx(q,{children:e.jsxs("code",{children:[t.key_prefix,"..."]})}),e.jsx(q,{children:e.jsx(U,{variant:t.status==="active"?"default":"secondary",children:t.status})}),e.jsx(q,{children:t.last_used_at?`${ie(new Date(t.last_used_at))} ago`:"Never"}),e.jsx(q,{children:re(new Date(t.created_at),"MMM d, yyyy")}),e.jsx(q,{className:"text-right",children:e.jsxs(le,{children:[e.jsx(de,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",disabled:c.isPending,children:t.status==="active"?e.jsx(Ie,{className:"h-4 w-4"}):e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsxs(ce,{children:[e.jsxs(oe,{children:[e.jsx(me,{children:"Are you sure?"}),e.jsxs(ue,{children:["This will ",t.status==="active"?"deactivate":"activate"," the API key.",t.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(he,{children:[e.jsx(xe,{children:"Cancel"}),e.jsx(pe,{onClick:()=>c.mutate({keyId:t.id,status:t.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},t.id)):e.jsx(O,{children:e.jsx(q,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(je,{open:!!x,onOpenChange:t=>!t&&v(null),children:e.jsxs(ge,{children:[e.jsxs(ye,{children:[e.jsx(fe,{children:"API Key Created Successfully"}),e.jsx(ve,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(Ue,{apiKey:x||""}),e.jsx(be,{children:e.jsx(Ne,{asChild:!0,children:e.jsx(f,{children:"Close"})})})]})})]})]})},Oe=({organization:s,currentSettings:a,onSettingsUpdate:d})=>{var k,t,j,A;const[l,x]=N.useState(((k=a==null?void 0:a.sms_settings)==null?void 0:k.username)||""),[v,p]=N.useState(""),[i,u]=N.useState((a==null?void 0:a.sms_sender_id)||""),h=M({mutationFn:async()=>{const{data:g,error:n}=await y.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:(a==null?void 0:a.sms_enabled)||!1,senderId:i.trim(),username:l.trim(),apiKey:v.trim()}});if(n)throw n;return g},onSuccess:()=>{o({title:"Africa's Talking settings saved successfully",description:"Your SMS integration is now configured"}),p(""),d()},onError:g=>{o({title:"Error saving settings",description:g.message,variant:"destructive"})}}),c=g=>{var n;if(g.preventDefault(),!l.trim()){o({title:"Username required",description:"Please enter your Africa's Talking username",variant:"destructive"});return}if(!v.trim()&&!((n=a==null?void 0:a.sms_settings)!=null&&n.apiKey)){o({title:"API Key required",description:"Please enter your Africa's Talking API key",variant:"destructive"});return}h.mutate()};return e.jsxs(C,{className:"mt-4",children:[e.jsx(S,{children:e.jsx(P,{className:"text-lg",children:"Africa's Talking Configuration"})}),e.jsx(_,{children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-username",children:"Username *"}),e.jsx(E,{id:"at-username",value:l,onChange:g=>x(g.target.value),placeholder:"Your Africa's Talking username",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-sender-id",children:"Sender ID (Optional)"}),e.jsx(E,{id:"at-sender-id",value:i,onChange:g=>u(g.target.value),placeholder:"e.g., YourBrand",maxLength:11}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Max 11 characters. Leave blank to use default."})]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-api-key",children:"API Key *"}),e.jsx(E,{id:"at-api-key",type:"password",value:v,onChange:g=>p(g.target.value),placeholder:(t=a==null?void 0:a.sms_settings)!=null&&t.apiKey?"Enter new API key (leave blank to keep current)":"Your Africa's Talking API key",required:!((j=a==null?void 0:a.sms_settings)!=null&&j.apiKey)}),((A=a==null?void 0:a.sms_settings)==null?void 0:A.apiKey)&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"API key is configured. Enter a new key only if you want to update it."})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Setup Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside text-blue-700 space-y-1 mt-1",children:[e.jsx("li",{children:"Get your credentials from Africa's Talking dashboard"}),e.jsx("li",{children:"Configure the webhook URL in your Africa's Talking app settings"}),e.jsx("li",{children:"Test the integration by sending an SMS to your shortcode"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{type:"submit",disabled:h.isPending,className:"flex items-center gap-2",children:[h.isPending?e.jsx(G,{className:"w-4 h-4 animate-spin"}):null,"Save Configuration"]}),e.jsxs(f,{type:"button",variant:"outline",onClick:()=>window.open("https://account.africastalking.com/","_blank"),className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Open Dashboard"]})]})]})})]})},Qe=({enabled:s,onToggle:a,isLoading:d})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"SMS Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to provide feedback via SMS"})]}),e.jsx(we,{checked:s,onCheckedChange:a,disabled:d})]}),Ye=({webhookSecret:s,isVisible:a})=>a?e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"SMS Webhook URL:"})]}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-md",children:e.jsx("code",{className:"text-sm break-all",children:`${window.location.origin}/functions/v1/handle-sms-webhook/${s}`})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use this URL as your SMS webhook endpoint in your provider's dashboard"})]}):null,He=({providers:s,selectedProvider:a,onProviderSelect:d})=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Available Providers"}),s.map(l=>{const x=l.icon;return e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${a===l.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l.status==="available"&&d(a===l.id?null:l.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:l.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:l.status==="available"?e.jsxs(e.Fragment,{children:[e.jsx(U,{variant:"default",children:"Available"}),a===l.id&&e.jsx(J,{className:"w-4 h-4 text-blue-500"})]}):e.jsx(U,{variant:"secondary",children:"Coming Soon"})})]})},l.id)})]}),Ve=()=>{const{organization:s}=B(),a=H(),[d,l]=N.useState(""),[x,v]=N.useState(""),[p,i]=N.useState(""),[u,h]=N.useState(!1),{data:c,isLoading:k}=R({queryKey:["sms-phone-numbers",s==null?void 0:s.id],queryFn:async()=>{const{data:r,error:m}=await y.from("sms_phone_numbers").select("*").eq("organization_id",s.id).order("created_at",{ascending:!1});if(m)throw m;return r},enabled:!!(s!=null&&s.id)}),t=M({mutationFn:async({phoneNumber:r,name:m})=>{const{data:b,error:F}=await y.from("sms_phone_numbers").insert({organization_id:s.id,phone_number:r.trim(),name:(m==null?void 0:m.trim())||null}).select().single();if(F)throw F;return b},onSuccess:()=>{o({title:"Phone number added successfully"}),l(""),v(""),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:r=>{o({title:"Error adding phone number",description:r.message,variant:"destructive"})}}),j=M({mutationFn:async r=>{const{data:m,error:b}=await y.from("sms_phone_numbers").insert(r.map(({phoneNumber:F,name:D})=>({organization_id:s.id,phone_number:F.trim(),name:(D==null?void 0:D.trim())||null})));if(b)throw b;return m},onSuccess:()=>{o({title:"Phone numbers added successfully"}),i(""),h(!1),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:r=>{o({title:"Error adding phone numbers",description:r.message,variant:"destructive"})}}),A=M({mutationFn:async r=>{const{error:m}=await y.from("sms_phone_numbers").delete().eq("id",r);if(m)throw m},onSuccess:()=>{o({title:"Phone number removed successfully"}),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:r=>{o({title:"Error removing phone number",description:r.message,variant:"destructive"})}}),g=r=>{r.preventDefault(),d.trim()&&t.mutate({phoneNumber:d,name:x})},n=()=>{const m=p.split(`
`).filter(b=>b.trim()).map(b=>{const F=b.split(",").map(D=>D.trim());return{phoneNumber:F[0],name:F[1]||void 0}}).filter(b=>b.phoneNumber);if(m.length===0){o({title:"No valid phone numbers found",description:"Please enter at least one phone number",variant:"destructive"});return}j.mutate(m)},w=r=>r.startsWith("+")?r:`+${r}`;return k?e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Phone Numbers"]})}),e.jsx(_,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}):e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Phone Numbers (",(c==null?void 0:c.length)||0,")"]})}),e.jsxs(_,{className:"space-y-6",children:[e.jsx("form",{onSubmit:g,className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"phone-number",children:"Phone Number *"}),e.jsx(E,{id:"phone-number",value:d,onChange:r=>l(r.target.value),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"name",children:"Name (Optional)"}),e.jsx(E,{id:"name",value:x,onChange:r=>v(r.target.value),placeholder:"John Doe"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(f,{type:"submit",disabled:t.isPending,className:"w-full",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Add Number"]})})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(f,{variant:"outline",onClick:()=>h(!u),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Bulk Add"]})}),u&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"bulk-numbers",children:"Bulk Add Phone Numbers"}),e.jsx(z,{id:"bulk-numbers",value:p,onChange:r=>i(r.target.value),placeholder:"Enter phone numbers, one per line. Format: +1234567890 or +1234567890,John Doe",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Format: One phone number per line. Optionally add name after comma."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:n,disabled:j.isPending,children:"Add All Numbers"}),e.jsx(f,{variant:"outline",onClick:()=>h(!1),children:"Cancel"})]})]}),c&&c.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Registered Phone Numbers"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:c.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:w(r.phone_number)}),r.name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(U,{variant:r.status==="active"?"default":"secondary",children:r.status}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Added ",new Date(r.created_at).toLocaleDateString()]})]})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>A.mutate(r.id),disabled:A.isPending,children:e.jsx(ke,{className:"w-4 h-4"})})]},r.id))})]}):e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No phone numbers added yet."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers to start sending SMS campaigns."})]})]})]})},$e=()=>{const{organization:s}=B(),a=H(),[d,l]=N.useState(!1),[x,v]=N.useState(""),[p,i]=N.useState(""),{data:u,isLoading:h}=R({queryKey:["sms-campaigns",s==null?void 0:s.id],queryFn:async()=>{const{data:n,error:w}=await y.from("sms_campaigns").select("*").eq("organization_id",s.id).order("created_at",{ascending:!1});if(w)throw w;return n},enabled:!!(s!=null&&s.id)}),{data:c}=R({queryKey:["sms-phone-numbers",s==null?void 0:s.id],queryFn:async()=>{const{data:n,error:w}=await y.from("sms_phone_numbers").select("*").eq("organization_id",s.id).eq("status","active");if(w)throw w;return n},enabled:!!(s!=null&&s.id)}),k=M({mutationFn:async({name:n,template:w})=>{const{data:r,error:m}=await y.from("sms_campaigns").insert({organization_id:s.id,name:n.trim(),message_template:w.trim(),total_recipients:(c==null?void 0:c.length)||0}).select().single();if(m)throw m;return r},onSuccess:()=>{o({title:"Campaign created successfully"}),v(""),i(""),l(!1),a.invalidateQueries({queryKey:["sms-campaigns",s==null?void 0:s.id]})},onError:n=>{o({title:"Error creating campaign",description:n.message,variant:"destructive"})}}),t=M({mutationFn:async n=>{if(!c||c.length===0)throw new Error("No active phone numbers found");const w=u==null?void 0:u.find(b=>b.id===n);if(!w)throw new Error("Campaign not found");await y.from("sms_campaigns").update({status:"sending",started_at:new Date().toISOString()}).eq("id",n);const{data:r,error:m}=await y.functions.invoke("send-sms",{body:{phoneNumbers:c.map(b=>b.phone_number),message:w.message_template,organizationId:s.id,campaignId:n}});if(m)throw m;return r},onSuccess:n=>{o({title:"Campaign sent successfully",description:`Sent to ${n.summary.sent} recipients`}),a.invalidateQueries({queryKey:["sms-campaigns",s==null?void 0:s.id]})},onError:n=>{o({title:"Error sending campaign",description:n.message,variant:"destructive"})}}),j=n=>{n.preventDefault(),!(!x.trim()||!p.trim())&&k.mutate({name:x,template:p})},A=n=>{switch(n){case"completed":return"default";case"sending":return"secondary";case"failed":return"destructive";case"draft":return"outline";default:return"secondary"}};if(h)return e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(_,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]});const g=`Hi! We'd love your feedback on our service. Please text back 'START' to begin a quick survey. Your input helps us improve. Thank you! - ${(s==null?void 0:s.name)||"Your Company"}`;return e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(P,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"SMS Campaigns (",(u==null?void 0:u.length)||0,")"]}),e.jsxs(f,{onClick:()=>l(!0),disabled:!c||c.length===0,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"New Campaign"]})]})}),e.jsx(_,{className:"space-y-6",children:!c||c.length===0?e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No active phone numbers found."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers before creating campaigns."})]}):e.jsxs(e.Fragment,{children:[d&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium",children:"Create New Campaign"}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"campaign-name",children:"Campaign Name *"}),e.jsx(E,{id:"campaign-name",value:x,onChange:n=>v(n.target.value),placeholder:"Feedback Request Campaign",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"message-template",children:"Message Template *"}),e.jsx(z,{id:"message-template",value:p,onChange:n=>i(n.target.value),placeholder:g,rows:4,required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Recipients: ",c.length," active phone numbers"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:k.isPending,children:"Create Campaign"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancel"})]})]})]}),u&&u.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Your Campaigns"}),u.map(n=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:n.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Created ",new Date(n.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{variant:A(n.status),children:n.status}),n.status==="draft"&&e.jsxs(f,{size:"sm",onClick:()=>t.mutate(n.id),disabled:t.isPending,children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Send Now"]})]})]}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded border-l-4 border-blue-500",children:[e.jsx("strong",{children:"Message:"}),e.jsx("p",{className:"mt-1",children:n.message_template})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:n.total_recipients}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Recipients"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:n.sent_count}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Sent"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:n.delivered_count}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Delivered"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:n.response_count}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Responses"})]})]})]})]},n.id))]}):e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(Ce,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No campaigns created yet."}),e.jsx("p",{className:"text-sm",children:"Create your first SMS campaign to get started."})]})]})})]})},We=[{id:"africastalking",name:"Africa's Talking",description:"SMS services across Africa with reliable delivery",icon:T,status:"available"},{id:"twilio",name:"Twilio",description:"Global SMS and communication platform",icon:T,status:"coming_soon"},{id:"vonage",name:"Vonage",description:"SMS API for global messaging",icon:T,status:"coming_soon"}],Q=(s,a)=>s&&typeof s=="object"&&!Array.isArray(s)&&s[a]||"",Ge=()=>{const{organization:s}=B(),{isAdmin:a,isOrgAdmin:d}=ee(),l=H(),[x,v]=N.useState(null),p=a||d,{data:i,isLoading:u}=R({queryKey:["organization-sms",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return null;const{data:t,error:j}=await y.from("organizations").select("sms_enabled, sms_sender_id, sms_settings, webhook_secret").eq("id",s.id).single();if(j)throw j;return t},enabled:!!(s!=null&&s.id)&&p}),h=M({mutationFn:async t=>{const{data:j,error:A}=await y.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:t,senderId:(i==null?void 0:i.sms_sender_id)||"",username:Q(i==null?void 0:i.sms_settings,"username"),apiKey:Q(i==null?void 0:i.sms_settings,"apiKey")}});if(A)throw A;return j},onSuccess:()=>{o({title:"SMS status updated successfully"}),l.invalidateQueries({queryKey:["organization-sms",s==null?void 0:s.id]})},onError:t=>{o({title:"Error updating SMS status",description:t.message,variant:"destructive"})}}),c=t=>{h.mutate(t)};if(!p)return e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(_,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"You need admin access to manage SMS integrations."})})]});if(u)return e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(_,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]});const k=(i==null?void 0:i.sms_enabled)&&Q(i==null?void 0:i.sms_settings,"username")&&Q(i==null?void 0:i.sms_settings,"apiKey");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsxs(S,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"SMS Integrations"]}),e.jsx(V,{children:"Enable SMS feedback collection from your customers"})]}),e.jsxs(_,{className:"space-y-4",children:[e.jsx(Qe,{enabled:(i==null?void 0:i.sms_enabled)||!1,onToggle:c,isLoading:h.isPending}),e.jsx(Ye,{webhookSecret:(i==null?void 0:i.webhook_secret)||"",isVisible:(i==null?void 0:i.sms_enabled)||!1}),e.jsx(He,{providers:We,selectedProvider:x,onProviderSelect:v}),x==="africastalking"&&e.jsx(Oe,{organization:s,currentSettings:i,onSettingsUpdate:()=>{l.invalidateQueries({queryKey:["organization-sms",s==null?void 0:s.id]})}})]})]}),k&&e.jsx(C,{children:e.jsx(_,{className:"p-0",children:e.jsxs(_e,{defaultValue:"phone-numbers",className:"w-full",children:[e.jsx("div",{className:"px-6 pt-6",children:e.jsxs(Ae,{className:"grid w-full grid-cols-2",children:[e.jsx($,{value:"phone-numbers",children:"Phone Numbers"}),e.jsx($,{value:"campaigns",children:"Campaigns"})]})}),e.jsx(W,{value:"phone-numbers",className:"px-6 pb-6",children:e.jsx(Ve,{})}),e.jsx(W,{value:"campaigns",className:"px-6 pb-6",children:e.jsx($e,{})})]})})})]})},Je=()=>e.jsxs(C,{children:[e.jsxs(S,{children:[e.jsx(P,{children:"CRM Integration"}),e.jsx(V,{children:"Connect to your favorite CRM."})]}),e.jsx(_,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"CRM integrations are coming soon."})})]}),Ze=()=>{const{isAdmin:s,isOrgAdmin:a}=ee();return B(),s||a?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Ge,{}),e.jsx(Se,{}),e.jsx(Be,{}),e.jsx(Je,{})]})]}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage integrations."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]})};export{Ze as IntegrationsTab,Ze as default};
