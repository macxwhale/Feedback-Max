import{c as _,s as S,a3 as Y,a4 as z,r as w,u as V,a5 as E,j as e,C as A,a as T,b as D,d as de,e as P,a6 as L,g as y,a7 as oe,w as _e,x as Me,y as H,z as $,A as Ae,E as R,S as Pe,B as O,f as Te,a8 as De,a9 as me,aa as ue,ab as he,ac as xe,ad as pe,ae as ge,af as je,ag as fe,ah as ye,ai as Fe,aj as qe,ak as Ee,al as Ke,am as Ie,an as Le,ao as Re,ap as Ne,aq as p,ar as U,I as X,as as Ue,at as Oe,au as ve,M as q,av as J,aw as be,K as Q,ax as we,T as Be,G as Se,i as $e,ay as Ve,az as se,aA as Qe,aB as Ye,aC as He,aD as W,aE as We,aF as Ge,aG as ze,aH as ae,aI as te,aJ as re,aK as ne,aL as I,p as Je,q as Xe,t as ie,v as le,aM as Ce}from"./index-J4ynACL8.js";import{P as ke}from"./progress-CfccoVgJ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=_("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=_("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=_("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=_("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=_("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=_("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=_("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=_("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=_("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=_("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=_("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=_("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=_("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=_("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ms=async s=>{const{data:a,error:t}=await S.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",s).order("created_at",{ascending:!1});if(t)throw t;return a},us=async(s,a)=>{const{data:t,error:l}=await S.rpc("create_api_key",{p_organization_id:s,p_key_name:a});if(l)throw l;return t},hs=async(s,a)=>{const{data:t,error:l}=await S.from("api_keys").update({status:a}).eq("id",s).select().single();if(l)throw l;return t},xs=({apiKey:s})=>{const[a,t]=w.useState(!1),l=()=>{navigator.clipboard.writeText(s),t(!0),p({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>t(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:s}),e.jsx(y,{variant:"ghost",size:"icon",onClick:l,children:a?e.jsx(Ne,{className:"h-4 w-4 text-green-500"}):e.jsx(Z,{className:"h-4 w-4"})})]})},ps=()=>{const{organization:s}=Y(),a=z(),[t,l]=w.useState(""),[i,c]=w.useState(null),d=["apiKeys",s==null?void 0:s.id],{data:o,isLoading:m}=V({queryKey:d,queryFn:()=>ms(s.id),enabled:!!s}),g=E({mutationFn:r=>us(s.id,r),onSuccess:r=>{p({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),c(r),l(""),a.invalidateQueries({queryKey:d})},onError:r=>{p({title:"Error",description:r.message,variant:"destructive"})}}),u=E({mutationFn:({keyId:r,status:j})=>hs(r,j),onSuccess:()=>{p({title:"Status Updated"}),a.invalidateQueries({queryKey:d})},onError:r=>{p({title:"Error",description:r.message,variant:"destructive"})}}),n=r=>{r.preventDefault(),t.trim()&&s&&g.mutate(t.trim())};return e.jsxs(A,{className:"w-full",children:[e.jsxs(T,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(ns,{})," API Keys"]}),e.jsx(de,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(P,{children:[e.jsxs("form",{onSubmit:n,className:"flex items-center gap-2 mb-6",children:[e.jsx(L,{placeholder:"New key name (e.g., 'SMS Integration')",value:t,onChange:r=>l(r.target.value),disabled:g.isPending}),e.jsxs(y,{type:"submit",disabled:!t.trim()||g.isPending,children:[g.isPending?e.jsx(oe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ss,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(_e,{children:[e.jsx(Me,{children:e.jsxs(H,{children:[e.jsx($,{children:"Name"}),e.jsx($,{children:"Key Prefix"}),e.jsx($,{children:"Status"}),e.jsx($,{children:"Last Used"}),e.jsx($,{children:"Created"}),e.jsx($,{className:"text-right",children:"Actions"})]})}),e.jsx(Ae,{children:m?Array.from({length:3}).map((r,j)=>e.jsx(H,{children:e.jsx(R,{colSpan:6,children:e.jsx(Pe,{className:"h-8 w-full"})})},j)):o&&o.length>0?o.map(r=>e.jsxs(H,{children:[e.jsx(R,{className:"font-medium",children:r.key_name}),e.jsx(R,{children:e.jsxs("code",{children:[r.key_prefix,"..."]})}),e.jsx(R,{children:e.jsx(O,{variant:r.status==="active"?"default":"secondary",children:r.status})}),e.jsx(R,{children:r.last_used_at?`${Te(new Date(r.last_used_at))} ago`:"Never"}),e.jsx(R,{children:De(new Date(r.created_at),"MMM d, yyyy")}),e.jsx(R,{className:"text-right",children:e.jsxs(me,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"icon",disabled:u.isPending,children:r.status==="active"?e.jsx(is,{className:"h-4 w-4"}):e.jsx(ls,{className:"h-4 w-4"})})}),e.jsxs(he,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Are you sure?"}),e.jsxs(ge,{children:["This will ",r.status==="active"?"deactivate":"activate"," the API key.",r.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(je,{children:[e.jsx(fe,{children:"Cancel"}),e.jsx(ye,{onClick:()=>u.mutate({keyId:r.id,status:r.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},r.id)):e.jsx(H,{children:e.jsx(R,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(Fe,{open:!!i,onOpenChange:r=>!r&&c(null),children:e.jsxs(qe,{children:[e.jsxs(Ee,{children:[e.jsx(Ke,{children:"API Key Created Successfully"}),e.jsx(Ie,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(xs,{apiKey:i||""}),e.jsx(Le,{children:e.jsx(Re,{asChild:!0,children:e.jsx(y,{children:"Close"})})})]})})]})]})},gs=({organization:s,currentSettings:a,onSettingsUpdate:t})=>{var n,r,j,N;const[l,i]=w.useState(((n=a==null?void 0:a.sms_settings)==null?void 0:n.username)||""),[c,d]=w.useState(""),[o,m]=w.useState((a==null?void 0:a.sms_sender_id)||""),g=E({mutationFn:async()=>{const{data:f,error:v}=await S.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:(a==null?void 0:a.sms_enabled)||!1,senderId:o.trim(),username:l.trim(),apiKey:c.trim()}});if(v)throw v;return f},onSuccess:()=>{p({title:"Africa's Talking settings saved successfully",description:"Your SMS integration is now configured"}),d(""),t()},onError:f=>{p({title:"Error saving settings",description:f.message,variant:"destructive"})}}),u=f=>{var v;if(f.preventDefault(),!l.trim()){p({title:"Username required",description:"Please enter your Africa's Talking username",variant:"destructive"});return}if(!c.trim()&&!((v=a==null?void 0:a.sms_settings)!=null&&v.apiKey)){p({title:"API Key required",description:"Please enter your Africa's Talking API key",variant:"destructive"});return}g.mutate()};return e.jsxs(A,{className:"mt-4",children:[e.jsx(T,{children:e.jsx(D,{className:"text-lg",children:"Africa's Talking Configuration"})}),e.jsx(P,{children:e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"at-username",children:"Username *"}),e.jsx(L,{id:"at-username",value:l,onChange:f=>i(f.target.value),placeholder:"Your Africa's Talking username",required:!0})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"at-sender-id",children:"Sender ID (Optional)"}),e.jsx(L,{id:"at-sender-id",value:o,onChange:f=>m(f.target.value),placeholder:"e.g., YourBrand",maxLength:11}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Max 11 characters. Leave blank to use default."})]})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"at-api-key",children:"API Key *"}),e.jsx(L,{id:"at-api-key",type:"password",value:c,onChange:f=>d(f.target.value),placeholder:(r=a==null?void 0:a.sms_settings)!=null&&r.apiKey?"Enter new API key (leave blank to keep current)":"Your Africa's Talking API key",required:!((j=a==null?void 0:a.sms_settings)!=null&&j.apiKey)}),((N=a==null?void 0:a.sms_settings)==null?void 0:N.apiKey)&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"API key is configured. Enter a new key only if you want to update it."})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Setup Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside text-blue-700 space-y-1 mt-1",children:[e.jsx("li",{children:"Get your credentials from Africa's Talking dashboard"}),e.jsx("li",{children:"Configure the webhook URL in your Africa's Talking app settings"}),e.jsx("li",{children:"Test the integration by sending an SMS to your shortcode"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(y,{type:"submit",disabled:g.isPending,className:"flex items-center gap-2",children:[g.isPending?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):null,"Save Configuration"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:()=>window.open("https://account.africastalking.com/","_blank"),className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),"Open Dashboard"]})]})]})})]})},js=({enabled:s,onToggle:a,isLoading:t})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"SMS Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to provide feedback via SMS"})]}),e.jsx(Ue,{checked:s,onCheckedChange:a,disabled:t})]}),fs=({webhookSecret:s,isVisible:a})=>{const[t,l]=w.useState(!1),c=`https://rigurrwjiaucodxuuzeh.supabase.co/functions/v1/handle-sms-webhook?secret=${s}`,d=async()=>{try{await navigator.clipboard.writeText(c),p({title:"Webhook URL copied to clipboard"})}catch(o){console.error("Failed to copy webhook URL:",o),p({title:"Failed to copy URL",description:"Please copy the URL manually",variant:"destructive"})}};return!a||!s?null:e.jsxs(A,{children:[e.jsx(T,{children:e.jsx(D,{className:"text-sm font-medium",children:"SMS Webhook URL"})}),e.jsxs(P,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use this URL in your SMS provider's webhook configuration to receive incoming SMS messages."}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:t?c:"•".repeat(50),readOnly:!0,className:"font-mono text-xs"}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>l(!t),children:t?e.jsx(Oe,{className:"w-4 h-4"}):e.jsx(ve,{className:"w-4 h-4"})}),e.jsx(y,{variant:"outline",size:"sm",onClick:d,children:e.jsx(Z,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Method:"})," POST"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Content-Type:"})," application/x-www-form-urlencoded or application/json"]})]})]})]})},ys=({providers:s,selectedProvider:a,onProviderSelect:t})=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Available Providers"}),s.map(l=>{const i=l.icon;return e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${a===l.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l.status==="available"&&t(a===l.id?null:l.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:l.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:l.status==="available"?e.jsxs(e.Fragment,{children:[e.jsx(O,{variant:"default",children:"Available"}),a===l.id&&e.jsx(Ne,{className:"w-4 h-4 text-blue-500"})]}):e.jsx(O,{variant:"secondary",children:"Coming Soon"})})]})},l.id)})]}),Ns=[{id:"africastalking",name:"Africa's Talking",description:"SMS services across Africa with reliable delivery",icon:q,status:"available"},{id:"twilio",name:"Twilio",description:"Global SMS and communication platform",icon:q,status:"coming_soon"},{id:"vonage",name:"Vonage",description:"SMS API for global messaging",icon:q,status:"coming_soon"}],G=(s,a)=>{if(!s||typeof s!="object")return"";const t=s[a];return typeof t=="string"?t:""},vs=s=>{if(!s||typeof s!="object")return!1;const a=G(s,"username"),t=G(s,"apiKey");return a.length>0&&t.length>0},bs=()=>e.jsxs(T,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"SMS Integrations"]}),e.jsx(de,{children:"Enable SMS feedback collection from your customers"})]}),ws=({title:s="SMS Integrations"})=>e.jsxs(A,{children:[e.jsx(T,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),s]})}),e.jsx(P,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}),Ss=({title:s="SMS Integrations",message:a,onRetry:t})=>e.jsxs(A,{children:[e.jsx(T,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-red-500"}),s]})}),e.jsx(P,{children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-sm text-red-600 mb-2",children:"Organization not found or failed to load"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:a}),t&&e.jsx("button",{onClick:t,className:"text-sm text-blue-600 hover:underline",children:"Try again"})]})})]}),Cs=()=>e.jsxs(A,{children:[e.jsx(T,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(P,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"You need admin access to manage SMS integrations."})})]}),ks=({phoneNumber:s,name:a,onPhoneNumberChange:t,onNameChange:l,onSubmit:i,isLoading:c})=>e.jsx("form",{onSubmit:i,className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"phone-number",children:"Phone Number *"}),e.jsx(L,{id:"phone-number",value:s,onChange:d=>t(d.target.value),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"name",children:"Name (Optional)"}),e.jsx(L,{id:"name",value:a,onChange:d=>l(d.target.value),placeholder:"John Doe"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(y,{type:"submit",disabled:c,className:"w-full",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Add Number"]})})]})}),_s=({bulkNumbers:s,onBulkNumbersChange:a,onBulkAdd:t,onCancel:l,isLoading:i})=>e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"bulk-numbers",children:"Bulk Add Phone Numbers"}),e.jsx(be,{id:"bulk-numbers",value:s,onChange:c=>a(c.target.value),placeholder:"Enter phone numbers, one per line. Format: +1234567890 or +1234567890,John Doe",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Format: One phone number per line. Optionally add name after comma."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:t,disabled:i,children:"Add All Numbers"}),e.jsx(y,{variant:"outline",onClick:l,children:"Cancel"})]})]}),Ms=({phoneNumbers:s,onDelete:a,isDeleting:t})=>{const l=i=>i.startsWith("+")?i:`+${i}`;return s.length===0?e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(Q,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No phone numbers added yet."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers to start sending SMS campaigns."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Registered Phone Numbers"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:l(i.phone_number)}),i.name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(O,{variant:i.status==="active"?"default":"secondary",children:i.status}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Added ",new Date(i.created_at).toLocaleDateString()]})]})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>a(i.id),disabled:t,children:e.jsx(we,{className:"w-4 h-4"})})]},i.id))})]})},As=()=>{const{organization:s}=Y(),a=z(),[t,l]=w.useState(""),[i,c]=w.useState(""),[d,o]=w.useState(""),[m,g]=w.useState(!1),{data:u,isLoading:n}=V({queryKey:["sms-phone-numbers",s==null?void 0:s.id],queryFn:async()=>{const{data:h,error:x}=await S.from("sms_phone_numbers").select("*").eq("organization_id",s.id).order("created_at",{ascending:!1});if(x)throw x;return h},enabled:!!(s!=null&&s.id)}),r=E({mutationFn:async({phoneNumber:h,name:x})=>{const{data:C,error:k}=await S.from("sms_phone_numbers").insert({organization_id:s.id,phone_number:h.trim(),name:(x==null?void 0:x.trim())||null}).select().single();if(k)throw k;return C},onSuccess:()=>{p({title:"Phone number added successfully"}),l(""),c(""),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:h=>{p({title:"Error adding phone number",description:h.message,variant:"destructive"})}}),j=E({mutationFn:async h=>{const{data:x,error:C}=await S.from("sms_phone_numbers").insert(h.map(({phoneNumber:k,name:M})=>({organization_id:s.id,phone_number:k.trim(),name:(M==null?void 0:M.trim())||null})));if(C)throw C;return x},onSuccess:()=>{p({title:"Phone numbers added successfully"}),o(""),g(!1),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:h=>{p({title:"Error adding phone numbers",description:h.message,variant:"destructive"})}}),N=E({mutationFn:async h=>{const{error:x}=await S.from("sms_phone_numbers").delete().eq("id",h);if(x)throw x},onSuccess:()=>{p({title:"Phone number removed successfully"}),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:h=>{p({title:"Error removing phone number",description:h.message,variant:"destructive"})}}),f=h=>{h.preventDefault(),t.trim()&&r.mutate({phoneNumber:t,name:i})},v=()=>{const x=d.split(`
`).filter(C=>C.trim()).map(C=>{const k=C.split(",").map(M=>M.trim());return{phoneNumber:k[0],name:k[1]||void 0}}).filter(C=>C.phoneNumber);if(x.length===0){p({title:"No valid phone numbers found",description:"Please enter at least one phone number",variant:"destructive"});return}j.mutate(x)};return n?e.jsxs(A,{children:[e.jsx(T,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Phone Numbers"]})}),e.jsx(P,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}):e.jsxs(A,{children:[e.jsx(T,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Phone Numbers (",(u==null?void 0:u.length)||0,")"]})}),e.jsxs(P,{className:"space-y-6",children:[e.jsx(ks,{phoneNumber:t,name:i,onPhoneNumberChange:l,onNameChange:c,onSubmit:f,isLoading:r.isPending}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(y,{variant:"outline",onClick:()=>g(!m),children:[e.jsx(os,{className:"w-4 h-4 mr-2"}),"Bulk Add"]})}),m&&e.jsx(_s,{bulkNumbers:d,onBulkNumbersChange:o,onBulkAdd:v,onCancel:()=>g(!1),isLoading:j.isPending}),e.jsx(Ms,{phoneNumbers:u||[],onDelete:h=>N.mutate(h),isDeleting:N.isPending})]})]})},Ps=()=>{const{organization:s}=Y(),a=z(),{data:t,isLoading:l,error:i}=V({queryKey:["sms-campaigns",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return[];console.log("Fetching SMS campaigns for organization:",s.id);const{data:n,error:r}=await S.from("sms_campaigns").select("*").eq("organization_id",s.id).order("created_at",{ascending:!1});if(r)throw console.error("Error fetching SMS campaigns:",r),r;return console.log("SMS campaigns fetched:",(n==null?void 0:n.length)||0),n||[]},enabled:!!(s!=null&&s.id),retry:2,retryDelay:1e3}),{data:c,isLoading:d,error:o}=V({queryKey:["sms-phone-numbers",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return[];console.log("Fetching SMS phone numbers for organization:",s.id);const{data:n,error:r}=await S.from("sms_phone_numbers").select("*").eq("organization_id",s.id).eq("status","active");if(r)throw console.error("Error fetching SMS phone numbers:",r),r;return console.log("SMS phone numbers fetched:",(n==null?void 0:n.length)||0),n||[]},enabled:!!(s!=null&&s.id),retry:2,retryDelay:1e3}),m=E({mutationFn:async({name:n,template:r})=>{if(!(s!=null&&s.id))throw new Error("Organization not found");if(!n.trim())throw new Error("Campaign name is required");if(!r.trim())throw new Error("Message template is required");console.log("Creating SMS campaign:",{name:n,template:r,orgId:s.id});const{data:j,error:N}=await S.from("sms_campaigns").insert({organization_id:s.id,name:n.trim(),message_template:r.trim(),total_recipients:(c==null?void 0:c.length)||0}).select().single();if(N)throw console.error("Error creating SMS campaign:",N),N;return console.log("SMS campaign created:",j),j},onSuccess:()=>{p({title:"Campaign created successfully"}),a.invalidateQueries({queryKey:["sms-campaigns",s==null?void 0:s.id]})},onError:n=>{console.error("Create campaign error:",n),p({title:"Error creating campaign",description:n.message||"An unexpected error occurred",variant:"destructive"})}}),g=E({mutationFn:async({campaignId:n,isResend:r=!1,isRetry:j=!1})=>{if(!(s!=null&&s.id))throw new Error("Organization not found");if(!c||c.length===0)throw new Error("No active phone numbers found");const N=t==null?void 0:t.find(x=>x.id===n);if(!N)throw new Error("Campaign not found");console.log("Sending SMS campaign:",{campaignId:n,isResend:r,isRetry:j,recipientCount:c.length}),await S.from("sms_campaigns").update({status:"sending",started_at:new Date().toISOString()}).eq("id",n);let f=c.map(x=>x.phone_number);if(r){const{data:x}=await S.from("sms_sends").select("phone_number").eq("campaign_id",n).eq("status","failed");if(x&&x.length>0)f=x.map(C=>C.phone_number);else throw new Error("No failed sends to retry for this campaign")}j&&(f=c.map(x=>x.phone_number));const{data:v,error:h}=await S.functions.invoke("send-sms",{body:{phoneNumbers:f,message:N.message_template,organizationId:s.id,campaignId:n}});if(h)throw console.error("Error sending SMS campaign:",h),await S.from("sms_campaigns").update({status:"failed",completed_at:new Date().toISOString()}).eq("id",n),new Error(h.message||"Failed to send campaign");return console.log("SMS campaign sent successfully:",v),v},onSuccess:(n,r)=>{let j="Sent";r.isResend&&(j="Resent"),r.isRetry&&(j="Retried"),p({title:`Campaign ${j.toLowerCase()} successfully`,description:`${j} to ${n.summary.sent} recipients`}),a.invalidateQueries({queryKey:["sms-campaigns",s==null?void 0:s.id]})},onError:n=>{console.error("Send campaign error:",n),p({title:"Error sending campaign",description:n.message||"An unexpected error occurred",variant:"destructive"}),a.invalidateQueries({queryKey:["sms-campaigns",s==null?void 0:s.id]})}}),u=E({mutationFn:async({campaignId:n,action:r})=>{if(!(s!=null&&s.id))throw new Error("Organization not found");if(!(t==null?void 0:t.find(v=>v.id===n)))throw new Error("Campaign not found");console.log(`${r} SMS campaign:`,{campaignId:n});let N={};switch(r){case"cancel":N={status:"failed",completed_at:new Date().toISOString()};break;case"pause":N={status:"paused"};break;case"resume":N={status:"sending"};break}const{error:f}=await S.from("sms_campaigns").update(N).eq("id",n);if(f)throw console.error(`Error ${r} campaign:`,f),f;return{action:r,campaignId:n}},onSuccess:n=>{n.action.charAt(0).toUpperCase()+n.action.slice(1),p({title:`Campaign ${n.action}d successfully`}),a.invalidateQueries({queryKey:["sms-campaigns",s==null?void 0:s.id]})},onError:n=>{console.error("Campaign control error:",n),p({title:"Error controlling campaign",description:n.message||"An unexpected error occurred",variant:"destructive"})}});return{campaigns:t||[],campaignsLoading:l,campaignsError:i,phoneNumbers:c||[],phoneNumbersLoading:d,phoneNumbersError:o,createCampaignMutation:m,sendCampaignMutation:g,campaignControlMutation:u,organization:s}},Ts=({onSubmit:s,onCancel:a,isLoading:t,phoneNumbersCount:l,organizationName:i})=>{const[c,d]=w.useState(""),[o,m]=w.useState(""),g=`Hi! We'd love your feedback on our service. Please text back 'START' to begin a quick survey. Your input helps us improve. Thank you! - ${i||"Your Company"}`,u=n=>{n.preventDefault(),!(!c.trim()||!o.trim())&&(s(c,o),d(""),m(""))};return e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium",children:"Create New Campaign"}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"campaign-name",children:"Campaign Name *"}),e.jsx(L,{id:"campaign-name",value:c,onChange:n=>d(n.target.value),placeholder:"Feedback Request Campaign",required:!0})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"message-template",children:"Message Template *"}),e.jsx(be,{id:"message-template",value:o,onChange:n=>m(n.target.value),placeholder:g,rows:4,required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Recipients: ",l," active phone numbers"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{type:"submit",disabled:t,children:"Create Campaign"}),e.jsx(y,{type:"button",variant:"outline",onClick:a,children:"Cancel"})]})]})]})},Ds=({campaign:s})=>{const a=s.sent_count>0?s.delivered_count/s.sent_count*100:0,t=s.sent_count>0?s.failed_count/s.sent_count*100:0,l=s.total_recipients>0?s.sent_count/s.total_recipients*100:0,i=()=>{if(!s.started_at)return null;const c=new Date(s.started_at),o=(s.completed_at?new Date(s.completed_at):new Date).getTime()-c.getTime(),m=Math.round(o/(1e3*60));return m<60?`${m}m`:`${Math.round(m/60)}h ${m%60}m`};return e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(Q,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:s.sent_count}),e.jsx("div",{className:"text-xs text-blue-600",children:"Sent"}),e.jsx(ke,{value:l,className:"h-1 mt-1"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 rounded-lg",children:[e.jsx(Be,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-green-900",children:[a.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-green-600",children:"Delivered"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.delivered_count,"/",s.sent_count]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 rounded-lg",children:[e.jsx(Se,{className:"w-4 h-4 text-red-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-red-900",children:[t.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-red-600",children:"Failed"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.failed_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-purple-50 rounded-lg",children:[e.jsx($e,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-purple-900",children:i()||"N/A"}),e.jsx("div",{className:"text-xs text-purple-600",children:"Duration"}),e.jsx(O,{variant:"outline",className:"text-xs mt-1",children:s.status})]})]})]})},Fs=({campaign:s,onSend:a,onResend:t,onRetry:l,onDuplicate:i,onSchedule:c,onDelete:d,onCancel:o,onPause:m,onResume:g,isLoading:u})=>{const[n,r]=w.useState(!1),j=h=>{switch(h){case"completed":return"default";case"sending":return"secondary";case"paused":return"outline";case"failed":return"destructive";case"draft":return"outline";default:return"secondary"}},N=h=>{switch(h){case"completed":return"text-green-600";case"sending":return"text-blue-600";case"paused":return"text-yellow-600";case"failed":return"text-red-600";case"draft":return"text-gray-600";default:return"text-gray-600"}},f=s.total_recipients>0?s.sent_count/s.total_recipients*100:0,v=s.status==="sending"&&s.started_at&&new Date().getTime()-new Date(s.started_at).getTime()>10*60*1e3;return e.jsx(A,{className:"transition-all duration-200 hover:shadow-md",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h5",{className:"font-semibold text-lg",children:s.name}),e.jsx(O,{variant:j(s.status),className:N(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),v&&e.jsxs(O,{variant:"destructive",className:"text-orange-700 bg-orange-100",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),"Stuck"]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Created ",new Date(s.created_at).toLocaleDateString()," • ",s.total_recipients," recipients"]}),(s.status==="sending"||s.status==="paused")&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[s.sent_count,"/",s.total_recipients]})]}),e.jsx(ke,{value:f,className:"h-2"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="draft"&&e.jsxs(y,{size:"sm",onClick:()=>a(s.id),disabled:u,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Send Now"]}),s.status==="sending"&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>m(s.id),disabled:u,children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Pause"]}),e.jsxs(y,{size:"sm",variant:"destructive",onClick:()=>o(s.id),disabled:u,children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Cancel"]})]}),s.status==="paused"&&e.jsxs(y,{size:"sm",onClick:()=>g(s.id),disabled:u,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Resume"]}),s.status==="failed"&&e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>l(s.id),disabled:u,children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Retry"]}),s.status==="completed"&&s.failed_count>0&&e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>t(s.id),disabled:u,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Resend Failed"]}),v&&e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>l(s.id),disabled:u,className:"border-orange-500 text-orange-700 hover:bg-orange-50",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Force Retry"]}),e.jsxs(Qe,{children:[e.jsx(Ye,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(as,{className:"w-4 h-4"})})}),e.jsxs(He,{align:"end",children:[e.jsxs(W,{onClick:()=>r(!n),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),n?"Hide":"Show"," Analytics"]}),e.jsxs(W,{onClick:()=>i(s.id),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Duplicate Campaign"]}),s.status==="draft"&&e.jsxs(W,{onClick:()=>c(s.id),children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Schedule Campaign"]}),e.jsx(Ge,{}),e.jsxs(me,{children:[e.jsx(ue,{asChild:!0,children:e.jsxs(W,{onSelect:h=>h.preventDefault(),className:"text-red-600",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Delete Campaign"]})}),e.jsxs(he,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Delete Campaign"}),e.jsxs(ge,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone.']})]}),e.jsxs(je,{children:[e.jsx(fe,{children:"Cancel"}),e.jsx(ye,{onClick:()=>d(s.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Message Preview:"}),e.jsx("p",{className:"text-sm text-blue-800 leading-relaxed",children:s.message_template.length>120?`${s.message_template.substring(0,120)}...`:s.message_template})]})}),n&&e.jsx(Ds,{campaign:s})]})})},qs=({searchTerm:s,onSearchChange:a,statusFilter:t,onStatusFilterChange:l,sortBy:i,onSortByChange:c,sortOrder:d,onSortOrderChange:o,totalCampaigns:m,filteredCount:g})=>{const u=()=>{a(""),l("all"),c("created_at"),o("desc")},n=s||t!=="all";return e.jsxs("div",{className:"w-full space-y-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters"}),n&&e.jsxs(O,{variant:"secondary",className:"text-xs",children:[g," of ",m]})]}),n&&e.jsx(y,{variant:"ghost",size:"sm",onClick:u,children:"Clear All"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(L,{placeholder:"Search campaigns...",value:s,onChange:r=>a(r.target.value),className:"pl-10 w-full"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(ae,{value:t,onValueChange:l,children:[e.jsx(te,{className:"w-full sm:w-[150px]",children:e.jsx(re,{placeholder:"Status"})}),e.jsxs(ne,{children:[e.jsx(I,{value:"all",children:"All Status"}),e.jsx(I,{value:"draft",children:"Draft"}),e.jsx(I,{value:"sending",children:"Sending"}),e.jsx(I,{value:"completed",children:"Completed"}),e.jsx(I,{value:"failed",children:"Failed"})]})]}),e.jsxs(ae,{value:i,onValueChange:c,children:[e.jsx(te,{className:"w-full sm:w-[150px]",children:e.jsx(re,{placeholder:"Sort by"})}),e.jsxs(ne,{children:[e.jsx(I,{value:"created_at",children:"Created Date"}),e.jsx(I,{value:"name",children:"Name"}),e.jsx(I,{value:"total_recipients",children:"Recipients"}),e.jsx(I,{value:"delivered_count",children:"Delivery Rate"})]})]}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>o(d==="asc"?"desc":"asc"),className:"w-full sm:w-auto",children:d==="asc"?e.jsx(es,{className:"w-4 h-4"}):e.jsx(Ze,{className:"w-4 h-4"})})]})]})]})},Es=({campaigns:s,onSend:a,onResend:t,onRetry:l,onCancel:i,onPause:c,onResume:d,onDuplicate:o,onSchedule:m,onDelete:g,onCreateNew:u,isLoading:n})=>{const[r,j]=w.useState(""),[N,f]=w.useState("all"),[v,h]=w.useState("created_at"),[x,C]=w.useState("desc"),k=w.useMemo(()=>{let M=s.filter(b=>{const K=b.name.toLowerCase().includes(r.toLowerCase())||b.message_template.toLowerCase().includes(r.toLowerCase()),F=N==="all"||b.status===N;return K&&F});return M.sort((b,K)=>{let F=b[v],B=K[v];if(v==="created_at"&&(F=new Date(F).getTime(),B=new Date(B).getTime()),typeof F=="number"&&typeof B=="number")return x==="asc"?F-B:B-F;if(typeof F=="string"&&typeof B=="string"){const ee=F.localeCompare(B);return x==="asc"?ee:-ee}return 0}),M},[s,r,N,v,x]);return s.length===0?e.jsxs("div",{className:"w-full text-center p-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(q,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No campaigns yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Create your first SMS campaign to start reaching your audience with targeted messages."}),e.jsxs(y,{onClick:u,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Create Your First Campaign"]})]}):e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Campaign Management"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.length," campaign",s.length!==1?"s":""," total",k.length!==s.length&&` • ${k.length} shown`]})]}),e.jsxs(y,{onClick:u,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"New Campaign"]})]}),e.jsx(qs,{searchTerm:r,onSearchChange:j,statusFilter:N,onStatusFilterChange:f,sortBy:v,onSortByChange:h,sortOrder:x,onSortOrderChange:C,totalCampaigns:s.length,filteredCount:k.length}),e.jsx("div",{className:"w-full space-y-4",children:k.length===0?e.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg",children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No campaigns match your current filters."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search or filter criteria."})]}):k.map(M=>e.jsx(Fs,{campaign:M,onSend:a,onResend:t,onRetry:l,onCancel:i,onPause:c,onResume:d,onDuplicate:o,onSchedule:m,onDelete:g,isLoading:n},M.id))})]})},Ks=()=>e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(Q,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No active phone numbers found."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers before creating campaigns."})]}),Is=()=>{const[s,a]=w.useState(!1),{campaigns:t,campaignsLoading:l,campaignsError:i,phoneNumbers:c,phoneNumbersLoading:d,phoneNumbersError:o,createCampaignMutation:m,sendCampaignMutation:g,campaignControlMutation:u,organization:n}=Ps(),r=(b,K)=>{m.mutate({name:b,template:K},{onSuccess:()=>{a(!1)}})},j=b=>{g.mutate({campaignId:b})},N=b=>{g.mutate({campaignId:b,isResend:!0})},f=b=>{g.mutate({campaignId:b,isRetry:!0})},v=b=>{u.mutate({campaignId:b,action:"cancel"})},h=b=>{u.mutate({campaignId:b,action:"pause"})},x=b=>{u.mutate({campaignId:b,action:"resume"})},C=b=>{const K=t.find(F=>F.id===b);K&&(m.mutate({name:`${K.name} (Copy)`,template:K.message_template}),p({title:"Campaign duplicated successfully"}))},k=b=>{p({title:"Scheduling feature coming soon",description:"Campaign scheduling will be available in the next update."})},M=b=>{p({title:"Delete feature coming soon",description:"Campaign deletion will be available in the next update."})};return l||d?e.jsx("div",{className:"w-full",children:e.jsxs(A,{className:"w-full",children:[e.jsx(T,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(P,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]})}):i||o?e.jsx("div",{className:"w-full",children:e.jsxs(A,{className:"w-full",children:[e.jsx(T,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 rounded-lg",children:[e.jsx(X,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Failed to load campaigns or phone numbers"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:(i==null?void 0:i.message)||(o==null?void 0:o.message)||"An unexpected error occurred"})]})]})})]})}):e.jsx("div",{className:"w-full",children:e.jsxs(A,{className:"w-full",children:[e.jsx(T,{children:e.jsx(D,{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"SMS Campaigns"]})})}),e.jsx(P,{className:"space-y-6 p-6",children:c.length===0?e.jsx(Ks,{}):e.jsxs("div",{className:"w-full space-y-6",children:[s&&e.jsx("div",{className:"w-full",children:e.jsx(Ts,{onSubmit:r,onCancel:()=>a(!1),isLoading:m.isPending,phoneNumbersCount:c.length,organizationName:n==null?void 0:n.name})}),e.jsx("div",{className:"w-full",children:e.jsx(Es,{campaigns:t,onSend:j,onResend:N,onRetry:f,onCancel:v,onPause:h,onResume:x,onDuplicate:C,onSchedule:k,onDelete:M,onCreateNew:()=>a(!0),isLoading:g.isPending||u.isPending})})]})})]})})},Ls=()=>e.jsx("div",{className:"w-full mt-6",children:e.jsxs(Je,{defaultValue:"phone-numbers",className:"w-full",children:[e.jsxs(Xe,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(ie,{value:"phone-numbers",className:"flex-1",children:"Phone Numbers"}),e.jsx(ie,{value:"campaigns",className:"flex-1",children:"Campaigns"})]}),e.jsx(le,{value:"phone-numbers",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(As,{})})}),e.jsx(le,{value:"campaigns",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Is,{})})})]})}),Rs=()=>{const{organization:s}=Y(),a=z(),{data:t,isLoading:l,error:i}=V({queryKey:["organization-sms-settings",s==null?void 0:s.id],queryFn:async()=>{console.log("Fetching SMS settings for organization:",s==null?void 0:s.id);const{data:d,error:o}=await S.from("organizations").select("sms_enabled, sms_sender_id, sms_settings, webhook_secret").eq("id",s.id).single();if(o)throw console.error("Error fetching organization SMS settings:",o),o;return console.log("Organization SMS settings fetched:",d),d},enabled:!!(s!=null&&s.id),retry:3,retryDelay:1e3}),c=E({mutationFn:async d=>{if(!(s!=null&&s.id))throw new Error("Organization not found");console.log("Updating SMS status:",{enabled:d,orgId:s.id});const{data:o,error:m}=await S.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:d,senderId:(t==null?void 0:t.sms_sender_id)||"",username:G(t==null?void 0:t.sms_settings,"username"),apiKey:G(t==null?void 0:t.sms_settings,"apiKey")}});if(m)throw console.error("SMS status update error:",m),new Error(m.message||"Failed to update SMS settings");return console.log("SMS status updated successfully:",o),o},onSuccess:()=>{p({title:"SMS status updated successfully"}),a.invalidateQueries({queryKey:["organization-sms-settings",s==null?void 0:s.id]})},onError:d=>{console.error("SMS toggle error:",d),p({title:"Error updating SMS status",description:d.message||"An unexpected error occurred",variant:"destructive"})}});return{orgData:t,isLoading:l,error:i,updateSmsStatus:c,organization:s}},Us=()=>{const{isAdmin:s,isOrgAdmin:a}=Ce(),[t,l]=w.useState(null),{orgData:i,isLoading:c,error:d,updateSmsStatus:o,organization:m}=Rs(),g=s||a,u=r=>{if(!g){p({title:"Access denied",description:"You need admin access to manage SMS settings",variant:"destructive"});return}if(!(m!=null&&m.id)){p({title:"Error",description:"Organization not found",variant:"destructive"});return}o.mutate(r)};if(!g)return e.jsx(Cs,{});if(c)return e.jsx(ws,{});if(d){const r=typeof d=="string"?d:"Failed to load SMS settings";return e.jsx(Ss,{message:r})}const n=(i==null?void 0:i.sms_enabled)&&vs(i==null?void 0:i.sms_settings);return e.jsx("div",{className:"w-full",children:e.jsxs(A,{className:"w-full",children:[e.jsx(bs,{}),e.jsxs(P,{className:"space-y-6 p-6",children:[e.jsx(js,{enabled:(i==null?void 0:i.sms_enabled)||!1,onToggle:u,isLoading:o.isPending}),(i==null?void 0:i.sms_enabled)&&e.jsx(fs,{webhookSecret:(i==null?void 0:i.webhook_secret)||"",isVisible:!0}),e.jsx(ys,{providers:Ns,selectedProvider:t,onProviderSelect:l}),t==="africastalking"&&e.jsx(gs,{organization:m,currentSettings:i,onSettingsUpdate:()=>{}}),n&&e.jsx("div",{className:"w-full",children:e.jsx(Ls,{})})]})]})})},$s=()=>{const{isAdmin:s,isOrgAdmin:a}=Ce();return Y(),s||a?e.jsxs("div",{className:"w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."})]}),e.jsx("div",{className:"w-full",children:e.jsx(Us,{})}),e.jsx("div",{className:"w-full",children:e.jsx(ps,{})})]}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage integrations."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]})};export{$s as IntegrationsTab,$s as default};
