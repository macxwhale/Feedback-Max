import{c as v,s as b,a4 as L,a5 as F,r as j,u as R,a6 as I,j as e,C as N,a as C,b as A,d as q,e as _,a7 as P,g as f,a8 as U,w as H,x as O,y as S,z as g,A as Q,E as u,S as V,B as T,f as B,a9 as G,aa as $,ab as W,ac as J,ad as X,ae as Z,af as ee,ag as se,ah as ae,ai as ie,aj as te,ak as ne,al as re,am as le,an as de,ao as ce,ap as oe,aq as z,ar as o,as as K,I as Y,at as me,M as w,au as he}from"./index-BQXEG3s8.js";import{P as xe}from"./PermissionGuard-Cc63vkXk.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=v("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=v("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=v("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=v("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=v("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=v("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),be=async s=>{const{data:a,error:r}=await b.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",s).order("created_at",{ascending:!1});if(r)throw r;return a},ve=async(s,a)=>{const{data:r,error:t}=await b.rpc("create_api_key",{p_organization_id:s,p_key_name:a});if(t)throw t;return r},ke=async(s,a)=>{const{data:r,error:t}=await b.from("api_keys").update({status:a}).eq("id",s).select().single();if(t)throw t;return r},we=({apiKey:s})=>{const[a,r]=j.useState(!1),t=()=>{navigator.clipboard.writeText(s),r(!0),o({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>r(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:s}),e.jsx(f,{variant:"ghost",size:"icon",onClick:t,children:a?e.jsx(z,{className:"h-4 w-4 text-green-500"}):e.jsx(pe,{className:"h-4 w-4"})})]})},Ne=()=>{const{organization:s}=L(),a=F(),[r,t]=j.useState(""),[n,h]=j.useState(null),m=["apiKeys",s==null?void 0:s.id],{data:x,isLoading:d}=R({queryKey:m,queryFn:()=>be(s.id),enabled:!!s}),l=I({mutationFn:i=>ve(s.id,i),onSuccess:i=>{o({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),h(i),t(""),a.invalidateQueries({queryKey:m})},onError:i=>{o({title:"Error",description:i.message,variant:"destructive"})}}),p=I({mutationFn:({keyId:i,status:y})=>ke(i,y),onSuccess:()=>{o({title:"Status Updated"}),a.invalidateQueries({queryKey:m})},onError:i=>{o({title:"Error",description:i.message,variant:"destructive"})}}),M=i=>{i.preventDefault(),r.trim()&&s&&l.mutate(r.trim())};return e.jsxs(N,{className:"col-span-1 lg:col-span-2",children:[e.jsxs(C,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(ye,{})," API Keys"]}),e.jsx(q,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(_,{children:[e.jsxs("form",{onSubmit:M,className:"flex items-center gap-2 mb-6",children:[e.jsx(P,{placeholder:"New key name (e.g., 'SMS Integration')",value:r,onChange:i=>t(i.target.value),disabled:l.isPending}),e.jsxs(f,{type:"submit",disabled:!r.trim()||l.isPending,children:[l.isPending?e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(H,{children:[e.jsx(O,{children:e.jsxs(S,{children:[e.jsx(g,{children:"Name"}),e.jsx(g,{children:"Key Prefix"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Last Used"}),e.jsx(g,{children:"Created"}),e.jsx(g,{className:"text-right",children:"Actions"})]})}),e.jsx(Q,{children:d?Array.from({length:3}).map((i,y)=>e.jsx(S,{children:e.jsx(u,{colSpan:6,children:e.jsx(V,{className:"h-8 w-full"})})},y)):x&&x.length>0?x.map(i=>e.jsxs(S,{children:[e.jsx(u,{className:"font-medium",children:i.key_name}),e.jsx(u,{children:e.jsxs("code",{children:[i.key_prefix,"..."]})}),e.jsx(u,{children:e.jsx(T,{variant:i.status==="active"?"default":"secondary",children:i.status})}),e.jsx(u,{children:i.last_used_at?`${B(new Date(i.last_used_at))} ago`:"Never"}),e.jsx(u,{children:G(new Date(i.created_at),"MMM d, yyyy")}),e.jsx(u,{className:"text-right",children:e.jsxs($,{children:[e.jsx(W,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",disabled:p.isPending,children:i.status==="active"?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(fe,{className:"h-4 w-4"})})}),e.jsxs(J,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Are you sure?"}),e.jsxs(ee,{children:["This will ",i.status==="active"?"deactivate":"activate"," the API key.",i.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(se,{children:[e.jsx(ae,{children:"Cancel"}),e.jsx(ie,{onClick:()=>p.mutate({keyId:i.id,status:i.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},i.id)):e.jsx(S,{children:e.jsx(u,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(te,{open:!!n,onOpenChange:i=>!i&&h(null),children:e.jsxs(ne,{children:[e.jsxs(re,{children:[e.jsx(le,{children:"API Key Created Successfully"}),e.jsx(de,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(we,{apiKey:n||""}),e.jsx(ce,{children:e.jsx(oe,{asChild:!0,children:e.jsx(f,{children:"Close"})})})]})})]})]})},Ce=({organization:s,currentSettings:a,onSettingsUpdate:r})=>{var M,i,y,D;const[t,n]=j.useState(((M=a==null?void 0:a.sms_settings)==null?void 0:M.username)||""),[h,m]=j.useState(""),[x,d]=j.useState((a==null?void 0:a.sms_sender_id)||""),l=I({mutationFn:async()=>{const{data:c,error:k}=await b.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:(a==null?void 0:a.sms_enabled)||!1,senderId:x.trim(),username:t.trim(),apiKey:h.trim()}});if(k)throw k;return c},onSuccess:()=>{o({title:"Africa's Talking settings saved successfully",description:"Your SMS integration is now configured"}),m(""),r()},onError:c=>{o({title:"Error saving settings",description:c.message,variant:"destructive"})}}),p=c=>{var k;if(c.preventDefault(),!t.trim()){o({title:"Username required",description:"Please enter your Africa's Talking username",variant:"destructive"});return}if(!h.trim()&&!((k=a==null?void 0:a.sms_settings)!=null&&k.apiKey)){o({title:"API Key required",description:"Please enter your Africa's Talking API key",variant:"destructive"});return}l.mutate()};return e.jsxs(N,{className:"mt-4",children:[e.jsx(C,{children:e.jsx(A,{className:"text-lg",children:"Africa's Talking Configuration"})}),e.jsx(_,{children:e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-username",children:"Username *"}),e.jsx(P,{id:"at-username",value:t,onChange:c=>n(c.target.value),placeholder:"Your Africa's Talking username",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-sender-id",children:"Sender ID (Optional)"}),e.jsx(P,{id:"at-sender-id",value:x,onChange:c=>d(c.target.value),placeholder:"e.g., YourBrand",maxLength:11}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Max 11 characters. Leave blank to use default."})]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-api-key",children:"API Key *"}),e.jsx(P,{id:"at-api-key",type:"password",value:h,onChange:c=>m(c.target.value),placeholder:(i=a==null?void 0:a.sms_settings)!=null&&i.apiKey?"Enter new API key (leave blank to keep current)":"Your Africa's Talking API key",required:!((y=a==null?void 0:a.sms_settings)!=null&&y.apiKey)}),((D=a==null?void 0:a.sms_settings)==null?void 0:D.apiKey)&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"API key is configured. Enter a new key only if you want to update it."})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Setup Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside text-blue-700 space-y-1 mt-1",children:[e.jsx("li",{children:"Get your credentials from Africa's Talking dashboard"}),e.jsx("li",{children:"Configure the webhook URL in your Africa's Talking app settings"}),e.jsx("li",{children:"Test the integration by sending an SMS to your shortcode"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{type:"submit",disabled:l.isPending,className:"flex items-center gap-2",children:[l.isPending?e.jsx(U,{className:"w-4 h-4 animate-spin"}):null,"Save Configuration"]}),e.jsxs(f,{type:"button",variant:"outline",onClick:()=>window.open("https://account.africastalking.com/","_blank"),className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Open Dashboard"]})]})]})})]})},Ae=({enabled:s,onToggle:a,isLoading:r})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"SMS Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to provide feedback via SMS"})]}),e.jsx(me,{checked:s,onCheckedChange:a,disabled:r})]}),_e=({webhookSecret:s,isVisible:a})=>a?e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"SMS Webhook URL:"})]}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-md",children:e.jsx("code",{className:"text-sm break-all",children:`${window.location.origin}/functions/v1/handle-sms-webhook/${s}`})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use this URL as your SMS webhook endpoint in your provider's dashboard"})]}):null,Me=({providers:s,selectedProvider:a,onProviderSelect:r})=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Available Providers"}),s.map(t=>{const n=t.icon;return e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${a===t.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>t.status==="available"&&r(a===t.id?null:t.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.status==="available"?e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"default",children:"Available"}),a===t.id&&e.jsx(z,{className:"w-4 h-4 text-blue-500"})]}):e.jsx(T,{variant:"secondary",children:"Coming Soon"})})]})},t.id)})]}),Se=[{id:"africastalking",name:"Africa's Talking",description:"SMS services across Africa with reliable delivery",icon:w,status:"available"},{id:"twilio",name:"Twilio",description:"Global SMS and communication platform",icon:w,status:"coming_soon"},{id:"vonage",name:"Vonage",description:"SMS API for global messaging",icon:w,status:"coming_soon"}],E=(s,a)=>s&&typeof s=="object"&&!Array.isArray(s)&&s[a]||"",Pe=()=>{const{organization:s}=L(),a=F(),[r,t]=j.useState(null),{data:n,isLoading:h}=R({queryKey:["organization-sms",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return null;const{data:d,error:l}=await b.from("organizations").select("sms_enabled, sms_sender_id, sms_settings, webhook_secret").eq("id",s.id).single();if(l)throw l;return d},enabled:!!(s!=null&&s.id)}),m=I({mutationFn:async d=>{const{data:l,error:p}=await b.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:d,senderId:(n==null?void 0:n.sms_sender_id)||"",username:E(n==null?void 0:n.sms_settings,"username"),apiKey:E(n==null?void 0:n.sms_settings,"apiKey")}});if(p)throw p;return l},onSuccess:()=>{o({title:"SMS status updated successfully"}),a.invalidateQueries({queryKey:["organization-sms",s==null?void 0:s.id]})},onError:d=>{o({title:"Error updating SMS status",description:d.message,variant:"destructive"})}}),x=d=>{m.mutate(d)};return h?e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(_,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}):e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"SMS Integrations"]}),e.jsx(q,{children:"Enable SMS feedback collection from your customers"})]}),e.jsxs(_,{className:"space-y-4",children:[e.jsx(Ae,{enabled:(n==null?void 0:n.sms_enabled)||!1,onToggle:x,isLoading:m.isPending}),e.jsx(_e,{webhookSecret:(n==null?void 0:n.webhook_secret)||"",isVisible:(n==null?void 0:n.sms_enabled)||!1}),e.jsx(Me,{providers:Se,selectedProvider:r,onProviderSelect:t}),r==="africastalking"&&e.jsx(Ce,{organization:s,currentSettings:n,onSettingsUpdate:()=>{a.invalidateQueries({queryKey:["organization-sms",s==null?void 0:s.id]})}})]})]})},Ie=()=>e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsx(A,{children:"CRM Integration"}),e.jsx(q,{children:"Connect to your favorite CRM."})]}),e.jsx(_,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"CRM integrations are coming soon."})})]}),qe=()=>e.jsx(xe,{permission:"manage_organization",showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage integrations."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Pe,{}),e.jsx(he,{}),e.jsx(Ne,{}),e.jsx(Ie,{})]})]})});export{qe as IntegrationsTab,qe as default};
