import{c as N,s as b,a4 as D,a5 as F,r as y,u as L,a6 as I,j as e,C,a as A,b as _,d as q,e as M,a7 as S,g as v,a8 as R,w as Y,x as H,y as P,z as f,A as O,E as u,S as Q,B as T,f as B,a9 as G,aa as V,ab as $,ac as W,ad as J,ae as X,af as Z,ag as ee,ah as se,ai as ae,aj as ie,ak as te,al as ne,am as re,an as le,ao as de,ap as ce,aq as U,ar as o,as as K,I as z,M as k,at as oe,au as me}from"./index-KRJxzIG5.js";import{P as he}from"./PermissionGuard-CnlEqUPw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=N("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=N("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=N("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=N("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=N("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=N("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),fe=async s=>{const{data:i,error:r}=await b.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",s).order("created_at",{ascending:!1});if(r)throw r;return i},ve=async(s,i)=>{const{data:r,error:l}=await b.rpc("create_api_key",{p_organization_id:s,p_key_name:i});if(l)throw l;return r},be=async(s,i)=>{const{data:r,error:l}=await b.from("api_keys").update({status:i}).eq("id",s).select().single();if(l)throw l;return r},Ne=({apiKey:s})=>{const[i,r]=y.useState(!1),l=()=>{navigator.clipboard.writeText(s),r(!0),o({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>r(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:s}),e.jsx(v,{variant:"ghost",size:"icon",onClick:l,children:i?e.jsx(U,{className:"h-4 w-4 text-green-500"}):e.jsx(ue,{className:"h-4 w-4"})})]})},we=()=>{const{organization:s}=D(),i=F(),[r,l]=y.useState(""),[t,h]=y.useState(null),m=["apiKeys",s==null?void 0:s.id],{data:x,isLoading:n}=L({queryKey:m,queryFn:()=>fe(s.id),enabled:!!s}),d=I({mutationFn:a=>ve(s.id,a),onSuccess:a=>{o({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),h(a),l(""),i.invalidateQueries({queryKey:m})},onError:a=>{o({title:"Error",description:a.message,variant:"destructive"})}}),p=I({mutationFn:({keyId:a,status:g})=>be(a,g),onSuccess:()=>{o({title:"Status Updated"}),i.invalidateQueries({queryKey:m})},onError:a=>{o({title:"Error",description:a.message,variant:"destructive"})}}),j=a=>{a.preventDefault(),r.trim()&&s&&d.mutate(r.trim())};return e.jsxs(C,{className:"col-span-1 lg:col-span-2",children:[e.jsxs(A,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(je,{})," API Keys"]}),e.jsx(q,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(M,{children:[e.jsxs("form",{onSubmit:j,className:"flex items-center gap-2 mb-6",children:[e.jsx(S,{placeholder:"New key name (e.g., 'SMS Integration')",value:r,onChange:a=>l(a.target.value),disabled:d.isPending}),e.jsxs(v,{type:"submit",disabled:!r.trim()||d.isPending,children:[d.isPending?e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(Y,{children:[e.jsx(H,{children:e.jsxs(P,{children:[e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Key Prefix"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Last Used"}),e.jsx(f,{children:"Created"}),e.jsx(f,{className:"text-right",children:"Actions"})]})}),e.jsx(O,{children:n?Array.from({length:3}).map((a,g)=>e.jsx(P,{children:e.jsx(u,{colSpan:6,children:e.jsx(Q,{className:"h-8 w-full"})})},g)):x&&x.length>0?x.map(a=>e.jsxs(P,{children:[e.jsx(u,{className:"font-medium",children:a.key_name}),e.jsx(u,{children:e.jsxs("code",{children:[a.key_prefix,"..."]})}),e.jsx(u,{children:e.jsx(T,{variant:a.status==="active"?"default":"secondary",children:a.status})}),e.jsx(u,{children:a.last_used_at?`${B(new Date(a.last_used_at))} ago`:"Never"}),e.jsx(u,{children:G(new Date(a.created_at),"MMM d, yyyy")}),e.jsx(u,{className:"text-right",children:e.jsxs(V,{children:[e.jsx($,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",disabled:p.isPending,children:a.status==="active"?e.jsx(ye,{className:"h-4 w-4"}):e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(W,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Are you sure?"}),e.jsxs(Z,{children:["This will ",a.status==="active"?"deactivate":"activate"," the API key.",a.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(ee,{children:[e.jsx(se,{children:"Cancel"}),e.jsx(ae,{onClick:()=>p.mutate({keyId:a.id,status:a.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},a.id)):e.jsx(P,{children:e.jsx(u,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(ie,{open:!!t,onOpenChange:a=>!a&&h(null),children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(re,{children:"API Key Created Successfully"}),e.jsx(le,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(Ne,{apiKey:t||""}),e.jsx(de,{children:e.jsx(ce,{asChild:!0,children:e.jsx(v,{children:"Close"})})})]})})]})]})},ke=({organization:s,currentSettings:i,onSettingsUpdate:r})=>{var j,a,g,E;const[l,t]=y.useState(((j=i==null?void 0:i.sms_settings)==null?void 0:j.username)||""),[h,m]=y.useState(""),[x,n]=y.useState((i==null?void 0:i.sms_sender_id)||""),d=I({mutationFn:async()=>{const{data:c,error:w}=await b.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:(i==null?void 0:i.sms_enabled)||!1,senderId:x.trim(),username:l.trim(),apiKey:h.trim()}});if(w)throw w;return c},onSuccess:()=>{o({title:"Africa's Talking settings saved successfully",description:"Your SMS integration is now configured"}),m(""),r()},onError:c=>{o({title:"Error saving settings",description:c.message,variant:"destructive"})}}),p=c=>{var w;if(c.preventDefault(),!l.trim()){o({title:"Username required",description:"Please enter your Africa's Talking username",variant:"destructive"});return}if(!h.trim()&&!((w=i==null?void 0:i.sms_settings)!=null&&w.apiKey)){o({title:"API Key required",description:"Please enter your Africa's Talking API key",variant:"destructive"});return}d.mutate()};return e.jsxs(C,{className:"mt-4",children:[e.jsx(A,{children:e.jsx(_,{className:"text-lg",children:"Africa's Talking Configuration"})}),e.jsx(M,{children:e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-username",children:"Username *"}),e.jsx(S,{id:"at-username",value:l,onChange:c=>t(c.target.value),placeholder:"Your Africa's Talking username",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-sender-id",children:"Sender ID (Optional)"}),e.jsx(S,{id:"at-sender-id",value:x,onChange:c=>n(c.target.value),placeholder:"e.g., YourBrand",maxLength:11}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Max 11 characters. Leave blank to use default."})]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-api-key",children:"API Key *"}),e.jsx(S,{id:"at-api-key",type:"password",value:h,onChange:c=>m(c.target.value),placeholder:(a=i==null?void 0:i.sms_settings)!=null&&a.apiKey?"Enter new API key (leave blank to keep current)":"Your Africa's Talking API key",required:!((g=i==null?void 0:i.sms_settings)!=null&&g.apiKey)}),((E=i==null?void 0:i.sms_settings)==null?void 0:E.apiKey)&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"API key is configured. Enter a new key only if you want to update it."})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(z,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Setup Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside text-blue-700 space-y-1 mt-1",children:[e.jsx("li",{children:"Get your credentials from Africa's Talking dashboard"}),e.jsx("li",{children:"Configure the webhook URL in your Africa's Talking app settings"}),e.jsx("li",{children:"Test the integration by sending an SMS to your shortcode"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{type:"submit",disabled:d.isPending,className:"flex items-center gap-2",children:[d.isPending?e.jsx(R,{className:"w-4 h-4 animate-spin"}):null,"Save Configuration"]}),e.jsxs(v,{type:"button",variant:"outline",onClick:()=>window.open("https://account.africastalking.com/","_blank"),className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Open Dashboard"]})]})]})})]})},Ce=[{id:"africastalking",name:"Africa's Talking",description:"SMS services across Africa with reliable delivery",icon:e.jsx(k,{className:"w-6 h-6"}),status:"available"},{id:"twilio",name:"Twilio",description:"Global SMS and communication platform",icon:e.jsx(k,{className:"w-6 h-6"}),status:"coming_soon"},{id:"vonage",name:"Vonage",description:"SMS API for global messaging",icon:e.jsx(k,{className:"w-6 h-6"}),status:"coming_soon"}],Ae=()=>{const{organization:s}=D(),i=F(),[r,l]=y.useState(null),{data:t,isLoading:h}=L({queryKey:["organization-sms",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return null;const{data:n,error:d}=await b.from("organizations").select("sms_enabled, sms_sender_id, sms_settings, webhook_secret").eq("id",s.id).single();if(d)throw d;return n},enabled:!!(s!=null&&s.id)}),m=I({mutationFn:async n=>{var j,a;const{data:d,error:p}=await b.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:n,senderId:(t==null?void 0:t.sms_sender_id)||"",username:((j=t==null?void 0:t.sms_settings)==null?void 0:j.username)||"",apiKey:((a=t==null?void 0:t.sms_settings)==null?void 0:a.apiKey)||""}});if(p)throw p;return d},onSuccess:()=>{o({title:"SMS status updated successfully"}),i.invalidateQueries({queryKey:["organization-sms",s==null?void 0:s.id]})},onError:n=>{o({title:"Error updating SMS status",description:n.message,variant:"destructive"})}}),x=n=>{m.mutate(n)};return h?e.jsxs(C,{children:[e.jsx(A,{children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(M,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}):e.jsxs(C,{children:[e.jsxs(A,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"SMS Integrations"]}),e.jsx(q,{children:"Enable SMS feedback collection from your customers"})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"SMS Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to provide feedback via SMS"})]}),e.jsx(oe,{checked:(t==null?void 0:t.sms_enabled)||!1,onCheckedChange:x,disabled:m.isPending})]}),(t==null?void 0:t.sms_enabled)&&e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"SMS Webhook URL:"})]}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-md",children:e.jsx("code",{className:"text-sm break-all",children:`${window.location.origin}/functions/v1/handle-sms-webhook/${t==null?void 0:t.webhook_secret}`})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use this URL as your SMS webhook endpoint in your provider's dashboard"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Available Providers"}),Ce.map(n=>e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${r===n.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>n.status==="available"&&l(r===n.id?null:n.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[n.icon,e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:n.status==="available"?e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"default",children:"Available"}),r===n.id&&e.jsx(U,{className:"w-4 h-4 text-blue-500"})]}):e.jsx(T,{variant:"secondary",children:"Coming Soon"})})]})},n.id))]}),r==="africastalking"&&e.jsx(ke,{organization:s,currentSettings:t,onSettingsUpdate:()=>{i.invalidateQueries({queryKey:["organization-sms",s==null?void 0:s.id]})}})]})]})},_e=()=>e.jsxs(C,{children:[e.jsxs(A,{children:[e.jsx(_,{children:"CRM Integration"}),e.jsx(q,{children:"Connect to your favorite CRM."})]}),e.jsx(M,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"CRM integrations are coming soon."})})]}),Se=()=>e.jsx(he,{permission:"manage_organization",showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage integrations."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Ae,{}),e.jsx(me,{}),e.jsx(we,{}),e.jsx(_e,{})]})]})});export{Se as IntegrationsTab,Se as default};
