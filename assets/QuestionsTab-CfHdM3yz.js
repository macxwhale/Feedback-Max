import{c as T,r as E,j as e,ar as y,aw as $,a6 as h,C as V,e as O,g as b,aO as B,av as H,aH as L,aI as P,aJ as F,aK as I,aL as z,aP as R,ax as G,a4 as J,u as k,a5 as q,a as A,b as K,aQ as g}from"./index-Dc5E2FtZ.js";import{P as U}from"./PermissionGuard-DOUngD9a.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=T("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=T("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),W=({questionType:s,supportsOptions:u,supportsScale:d,options:x=[],scaleConfig:t,helpText:p="",placeholderText:r="",onOptionsChange:j,onScaleChange:m,onHelpTextChange:i,onPlaceholderChange:o})=>{const[v,_]=E.useState(x.length>0?x:N());function N(){return s==="emoji"?[{text:"ðŸ˜Š",value:"happy"},{text:"ðŸ˜",value:"neutral"},{text:"ðŸ˜ž",value:"sad"}]:[{text:""},{text:""}]}const Q=()=>{const l=s==="emoji"?{text:"ðŸ˜Š",value:""}:{text:""},n=[...v,l];_(n),j(n)},w=l=>{const n=v.filter((c,S)=>S!==l);_(n),j(n)},a=(l,n,c)=>{const S=v.map((M,f)=>f===l?{...M,[n]:c}:M);_(S),j(S)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"help-text",children:"Help Text (optional)"}),e.jsx($,{id:"help-text",value:p,onChange:l=>i(l.target.value),placeholder:"Additional guidance for users...",className:"mt-1"})]}),s==="text"&&e.jsxs("div",{children:[e.jsx(y,{htmlFor:"placeholder",children:"Placeholder Text"}),e.jsx(h,{id:"placeholder",value:r,onChange:l=>o(l.target.value),placeholder:"Enter placeholder text...",className:"mt-1"})]}),u&&e.jsx(V,{children:e.jsx(O,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{children:s==="emoji"?"Emoji Options":"Answer Options"}),s==="emoji"&&e.jsx("p",{className:"text-sm text-gray-600",children:"Enter emoji characters (ðŸ˜Š, ðŸ˜, ðŸ˜ž, etc.) for users to select from"}),v.map((l,n)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{value:l.text,onChange:c=>a(n,"text",c.target.value),placeholder:s==="emoji"?"ðŸ˜Š":`Option ${n+1}`,className:s==="emoji"?"w-16 text-center text-2xl":"flex-1"}),s!=="emoji"&&e.jsx(h,{value:l.value||"",onChange:c=>a(n,"value",c.target.value),placeholder:"Value",className:"w-20"}),s==="emoji"&&e.jsx(h,{value:l.value||"",onChange:c=>a(n,"value",c.target.value),placeholder:"Description",className:"flex-1"}),v.length>(s==="emoji"?1:2)&&e.jsx(b,{type:"button",variant:"outline",size:"sm",onClick:()=>w(n),children:e.jsx(B,{className:"w-4 h-4"})})]},n)),e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:Q,className:"w-full",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"Add ",s==="emoji"?"Emoji":"Option"]})]})})}),d&&e.jsx(V,{children:e.jsx(O,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{children:"Scale Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"min-value",children:"Min Value"}),e.jsx(h,{id:"min-value",type:"number",value:(t==null?void 0:t.minValue)||1,onChange:l=>m({...t,minValue:parseInt(l.target.value)||1,maxValue:(t==null?void 0:t.maxValue)||5})})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"max-value",children:"Max Value"}),e.jsx(h,{id:"max-value",type:"number",value:(t==null?void 0:t.maxValue)||5,onChange:l=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:parseInt(l.target.value)||5})})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"min-label",children:"Min Label"}),e.jsx(h,{id:"min-label",value:(t==null?void 0:t.minLabel)||"",onChange:l=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:(t==null?void 0:t.maxValue)||5,minLabel:l.target.value}),placeholder:"e.g., Poor"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"max-label",children:"Max Label"}),e.jsx(h,{id:"max-label",value:(t==null?void 0:t.maxLabel)||"",onChange:l=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:(t==null?void 0:t.maxValue)||5,maxLabel:l.target.value}),placeholder:"e.g., Excellent"})]})]})]})})}),e.jsxs("div",{className:"text-sm text-gray-600 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("strong",{children:["Selected Type: ",s]}),e.jsxs("div",{className:"mt-1",children:[u&&e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:"Supports Options"}),d&&e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs mr-2",children:"Supports Scale"}),s==="text"&&e.jsx("span",{className:"inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:"Text Input"}),s==="emoji"&&e.jsx("span",{className:"inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs",children:"Emoji Selection"})]})]})]})},Z=s=>({"single-choice":{supportsOptions:!0,supportsScale:!1},"multi-choice":{supportsOptions:!0,supportsScale:!1},star:{supportsOptions:!1,supportsScale:!0},likert:{supportsOptions:!1,supportsScale:!0},nps:{supportsOptions:!1,supportsScale:!0},slider:{supportsOptions:!1,supportsScale:!0},emoji:{supportsOptions:!0,supportsScale:!1},ranking:{supportsOptions:!0,supportsScale:!1},matrix:{supportsOptions:!0,supportsScale:!0},text:{supportsOptions:!1,supportsScale:!1}})[s]||{supportsOptions:!1,supportsScale:!1},D=({formData:s,setFormData:u,questionTypes:d,categories:x,editingId:t,onSubmit:p,onCancel:r,isSubmitting:j})=>{const m=Z(s.question_type);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(h,{placeholder:"Question text",value:s.question_text,onChange:i=>u(o=>({...o,question_text:i.target.value}))}),e.jsxs(L,{value:s.question_type,onValueChange:i=>u(o=>({...o,question_type:i,options:[],scaleConfig:{minValue:1,maxValue:5}})),children:[e.jsx(P,{children:e.jsx(F,{})}),e.jsx(I,{children:d.map(i=>e.jsx(z,{value:i.name,children:i.display_name},i.id))})]}),e.jsxs(L,{value:s.category,onValueChange:i=>u(o=>({...o,category:i})),children:[e.jsx(P,{children:e.jsx(F,{})}),e.jsx(I,{children:x.map(i=>e.jsx(z,{value:i.name,children:i.name},i.id))})]})]}),e.jsx(W,{questionType:s.question_type,supportsOptions:m.supportsOptions,supportsScale:m.supportsScale,options:s.options,scaleConfig:s.scaleConfig,helpText:s.help_text,placeholderText:s.placeholder_text,onOptionsChange:i=>u(o=>({...o,options:i})),onScaleChange:i=>u(o=>({...o,scaleConfig:i})),onHelpTextChange:i=>u(o=>({...o,help_text:i})),onPlaceholderChange:i=>u(o=>({...o,placeholder_text:i}))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:p,disabled:!s.question_text.trim()||j,children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),t?"Update":"Add"," Question"]}),t&&e.jsx(b,{variant:"outline",onClick:r,children:"Cancel"})]})]})},C=({questions:s,onEdit:u,onDelete:d,isDeleting:x})=>{const{toast:t}=R(),p=async r=>{r.response_count>0&&t({title:"Question will be archived",description:"This question has responses and will be archived instead of deleted.",variant:"default"}),d(r.id)};return s.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No questions found. Create your first question above."}):e.jsx("div",{className:"space-y-2",children:s.map(r=>e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg ${r.is_active?"":"bg-gray-50 opacity-75"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:r.question_text}),!r.is_active&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800",children:[e.jsx(X,{className:"w-3 h-3"}),"Archived"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Type: ",r.question_type," | Category: ",r.category," | Order: ",r.order_index,r.help_text&&e.jsxs("span",{children:[" | Help: ",r.help_text]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:"outline",onClick:()=>u(r),disabled:!r.is_active,children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>p(r),disabled:x||!r.is_active,children:e.jsx(G,{className:"w-4 h-4"})})]})]},r.id))})},ee=()=>{const{toast:s}=R(),u=J(),[d,x]=E.useState(null),[t,p]=E.useState({question_text:"",question_type:"star",category:"QualityService",order_index:1,help_text:"",placeholder_text:"",is_required:!1,options:[],scaleConfig:{minValue:1,maxValue:5}}),{data:r=[],isLoading:j}=k({queryKey:["questions"],queryFn:()=>g.getQuestions()}),{data:m=[]}=k({queryKey:["question-types"],queryFn:()=>g.getQuestionTypes()}),{data:i=[]}=k({queryKey:["question-categories"],queryFn:()=>g.getQuestionCategories()}),o=q({mutationFn:g.createQuestion,onSuccess:()=>{u.invalidateQueries({queryKey:["questions"]}),s({title:"Question created successfully"}),N()},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),v=q({mutationFn:({id:a,...l})=>g.updateQuestion(a,l),onSuccess:()=>{u.invalidateQueries({queryKey:["questions"]}),s({title:"Question updated successfully"}),N()},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),_=q({mutationFn:a=>g.deleteQuestion(a),onSuccess:()=>{u.invalidateQueries({queryKey:["questions"]}),s({title:"Question deleted successfully"})},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),N=()=>{x(null),p({question_text:"",question_type:"star",category:"QualityService",order_index:1,help_text:"",placeholder_text:"",is_required:!1,options:[],scaleConfig:{minValue:1,maxValue:5}})},Q=()=>{if(!t.question_text.trim()){s({title:"Validation Error",description:"Question text is required",variant:"destructive"});return}const a=r.length>0?Math.max(...r.map(c=>c.order_index)):0,l=d?t.order_index:a+1,n={...t,order_index:l};d?v.mutate({id:d,...n}):o.mutate(n)},w=a=>{var l,n;x(a.id),p({question_text:a.question_text,question_type:a.question_type,category:a.category,order_index:a.order_index,help_text:a.help_text||"",placeholder_text:a.placeholder_text||"",is_required:a.is_required||!1,options:((l=a.question_options)==null?void 0:l.map(c=>({text:c.option_text,value:c.option_value})))||[],scaleConfig:(n=a.question_scale_config)!=null&&n[0]?{minValue:a.question_scale_config[0].min_value,maxValue:a.question_scale_config[0].max_value,minLabel:a.question_scale_config[0].min_label||"",maxLabel:a.question_scale_config[0].max_label||"",stepSize:a.question_scale_config[0].step_size}:{minValue:1,maxValue:5}})};return j?e.jsxs(V,{children:[e.jsx(A,{children:e.jsx(K,{children:"Questions Management"})}),e.jsx(O,{children:e.jsx("div",{className:"text-center py-8",children:"Loading questions..."})})]}):e.jsxs(V,{children:[e.jsx(A,{children:e.jsx(K,{children:"Questions Management"})}),e.jsxs(O,{className:"space-y-6",children:[e.jsx(D,{formData:t,setFormData:p,questionTypes:m,categories:i,editingId:d,onSubmit:Q,onCancel:N,isSubmitting:o.isPending||v.isPending}),e.jsx(C,{questions:r,onEdit:w,onDelete:a=>_.mutate(a),isDeleting:_.isPending})]})]})},ae=()=>e.jsx(U,{permission:"manage_questions",showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need analyst-level access or higher to manage questions."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsx(ee,{})});export{ae as QuestionsTab,ae as default};
