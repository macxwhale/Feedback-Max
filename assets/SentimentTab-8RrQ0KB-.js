import{c as f,j as e,C as x,k as m,q as h,l as d,p as M,aT as S,M as R,r as N,B as o,aU as P,aV as A,i as v,a0 as L,T as z,m as q,aW as B,w as E,x as D,y as C,z as _}from"./index-CwWO4DGV.js";import{u as F}from"./useAnalyticsTableData-K86CzlLg.js";import{T as Q}from"./trending-down-BVhQH8PN.js";import{f as H}from"./format-CK8u0eST.js";import{P as I}from"./progress-DL2uSj7h.js";import{P as V}from"./PermissionGuard-BHd9yjYZ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=f("Frown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=f("Meh",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"8",x2:"16",y1:"15",y2:"15",key:"1xb1d9"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=f("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=f("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),W=({sentimentStats:t,totalQuestions:s,overallScore:a})=>{const i=s>0?Math.round(t.positive/s*100):0,l=s>0?Math.round(t.negative/s*100):0,g=s>0?Math.round(t.neutral/s*100):0;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(x,{children:[e.jsx(m,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-gray-600",children:"High Performing Questions"})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-2",children:t.positive}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(M,{className:"w-4 h-4 mr-1 text-green-500"}),i,"% of questions"]})]})]}),e.jsxs(x,{children:[e.jsx(m,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-gray-600",children:"Needs Attention"})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 mb-2",children:t.negative}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Q,{className:"w-4 h-4 mr-1 text-red-500"}),l,"% of questions"]})]})]}),e.jsxs(x,{children:[e.jsx(m,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-gray-600",children:"Average Performance"})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600 mb-2",children:t.neutral}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(S,{className:"w-4 h-4 mr-1 text-yellow-500"}),g,"% of questions"]})]})]}),e.jsxs(x,{children:[e.jsx(m,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-gray-600",children:"Total Questions"})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-2",children:s}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(R,{className:"w-4 h-4 mr-1 text-blue-500"}),"Questions analyzed"]})]})]})]})},T=({sentiment:t,className:s="w-4 h-4"})=>{switch(t){case"positive":return e.jsx($,{className:`text-green-600 ${s}`});case"negative":return e.jsx(O,{className:`text-red-600 ${s}`});case"neutral":default:return e.jsx(U,{className:`text-gray-600 ${s}`})}},w=t=>{switch(t){case"positive":return"bg-green-100 text-green-800";case"negative":return"bg-red-100 text-red-800";case"neutral":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},G=t=>{const s={positive:0,negative:0,neutral:0};return t.forEach(a=>{a.sentiment==="positive"?s.positive++:a.sentiment==="negative"?s.negative++:s.neutral++}),s},Y=t=>{const s=t.positive+t.negative+t.neutral;if(s===0)return"neutral";const a=t.positive/s,i=t.negative/s;return a>.6?"positive":i>.4?"negative":"neutral"},Z=({textResponses:t,questionText:s})=>{const[a,i]=N.useState(!1),[l,g]=N.useState(5),[c,j]=N.useState("all"),r=t.filter(n=>c==="all"?!0:c==="high"?n.score>=4:c==="low"?n.score<=2:!0),u=n=>n>=4?"bg-green-100 text-green-800":n<=2?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",p=n=>n>=4?"High Rated":n<=2?"Low Rated":"Average",y=r.slice(0,l),b=r.length>l;return t.length===0?null:e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>i(!a),className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"View Comments (",t.length,")",a?e.jsx(P,{className:"w-4 h-4"}):e.jsx(A,{className:"w-4 h-4"})]}),a&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:c==="all"?"default":"outline",size:"sm",onClick:()=>j("all"),children:"All"}),e.jsx(o,{variant:c==="high"?"default":"outline",size:"sm",onClick:()=>j("high"),children:"High Rated (4-5★)"}),e.jsx(o,{variant:c==="low"?"default":"outline",size:"sm",onClick:()=>j("low"),children:"Low Rated (1-2★)"})]})]}),a&&e.jsxs("div",{className:"space-y-3",children:[y.map(n=>e.jsx(x,{className:"p-4 bg-gray-50",children:e.jsxs(d,{className:"p-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n.score>0&&e.jsxs(e.Fragment,{children:[e.jsx(v,{className:u(n.score),children:p(n.score)}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(S,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),n.score,"/5"]})]}),n.score===0&&e.jsx(v,{className:"bg-gray-100 text-gray-800",children:"No Rating"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(L,{className:"w-3 h-3"}),H(new Date(n.created_at),"MMM d, yyyy")]})]}),e.jsx("div",{className:"text-sm text-gray-700 leading-relaxed",children:e.jsx(J,{text:n.response_value})})]})},n.id)),b&&e.jsx("div",{className:"text-center",children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>g(n=>n+5),children:"Load More Comments"})}),r.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No comments match the selected filter."})]})]})},J=({text:t})=>{const[s,a]=N.useState(!1);return t.length>200?e.jsxs("div",{children:[e.jsx("span",{children:s?t:t.substring(0,200)+"..."}),e.jsx(o,{variant:"ghost",size:"sm",className:"ml-2 p-0 h-auto text-blue-600 hover:text-blue-800",onClick:()=>a(!s),children:s?"Read Less":"Read More"})]}):e.jsx("span",{children:t})},K=({questionSentiments:t})=>e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(h,{children:"Question Sentiment Analysis"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:t.map((s,a)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(T,{sentiment:s.sentiment}),e.jsx(v,{className:w(s.sentiment),children:s.sentiment}),s.question_type==="text"&&s.text_responses&&s.text_responses.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(k,{className:"w-4 h-4"}),s.text_responses.length," comment",s.text_responses.length!==1?"s":""]})]}),e.jsx("h4",{className:"font-medium text-sm",children:s.question_text}),e.jsxs("p",{className:"text-xs text-gray-600",children:[s.total_responses," responses • ",s.completion_rate,"% completion"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold",children:[s.completion_rate,"%"]}),s.sentiment==="negative"&&e.jsx(z,{className:"w-4 h-4 text-red-500 ml-auto mt-1"}),s.sentiment==="positive"&&e.jsx(q,{className:"w-4 h-4 text-green-500 ml-auto mt-1"})]})]}),s.question_type==="text"&&s.text_responses&&s.text_responses.length>0&&e.jsx(Z,{textResponses:s.text_responses,questionText:s.question_text})]},a))})})]}),X=({categorySentiments:t})=>{const s=t.reduce((a,i)=>a+i.total_questions,0);return e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(h,{children:"Performance by Category"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:t.map((a,i)=>{const l=s>0?Math.round(a.total_questions/s*100):0;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{sentiment:a.sentiment}),e.jsx("h4",{className:"font-medium",children:a.category}),e.jsx(v,{className:w(a.sentiment),children:a.sentiment==="positive"?"Performing Well":a.sentiment==="negative"?"Needs Improvement":"Average Performance"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[a.total_questions," question",a.total_questions!==1?"s":""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Category Coverage"}),e.jsxs("span",{children:[l,"%"]})]}),e.jsx(I,{value:l,className:"h-2"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.total_responses," total responses"]})]})]},i)})})})]})},ee=({organizationId:t})=>{const{data:s,isLoading:a}=F(t);if(a)return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(r=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},r))})]})});if(!s)return e.jsx(x,{children:e.jsxs(d,{className:"p-6 text-center",children:[e.jsx(B,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No sentiment data available"})]})});const i=s.questions.map(r=>{const u=r.trend==="positive"?"positive":r.trend==="negative"?"negative":"neutral";return{question_text:r.question_text,sentiment:u,total_responses:r.total_responses,completion_rate:r.completion_rate,question_type:r.question_type,text_responses:r.text_responses||[]}}),l=G(i),g=i.length,c=Y(l),j=s.categories.map(r=>{const u=r.questions.filter(n=>n.trend==="positive").length,p=r.questions.length,y=p>0?u/p:0,b=y>.6?"positive":y<.3?"negative":"neutral";return{category:r.category,sentiment:b,total_questions:r.total_questions,total_responses:r.total_responses}});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Sentiment Analysis"}),e.jsxs(v,{className:w(c),children:["Overall: ",c]})]}),e.jsx(W,{sentimentStats:l,totalQuestions:g,overallScore:0}),e.jsxs(E,{defaultValue:"questions",className:"w-full",children:[e.jsxs(D,{className:"grid grid-cols-2 w-full max-w-md",children:[e.jsx(C,{value:"questions",children:"By Question"}),e.jsx(C,{value:"categories",children:"By Category"})]}),e.jsx(_,{value:"questions",className:"space-y-4",children:e.jsx(K,{questionSentiments:i})}),e.jsx(_,{value:"categories",className:"space-y-4",children:e.jsx(X,{categorySentiments:j})})]})]})},le=({organizationId:t})=>e.jsx(V,{permission:"view_analytics",organizationId:t,showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need viewer-level access or higher to view sentiment analysis."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsx(ee,{organizationId:t})});export{le as SentimentTab,le as default};
