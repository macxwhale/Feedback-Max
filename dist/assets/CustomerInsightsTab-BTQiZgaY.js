import{O as N,j as s,C as a,f as i,L as v,B as f,l as y,P as j,T as b,J as w,k as C,q as _,t as T,v as m,w as o,b as c,d}from"./index-D8xOU8gJ.js";import{R as A,C as R,X as P,Y as k,T as q,B}from"./generateCategoricalChart-Cq1yW8ll.js";import{B as L}from"./BarChart-B9ABQHsA.js";import{P as D}from"./PermissionGuard-CSODul5A.js";const H=({organizationId:n})=>{const{data:l,isLoading:p}=N(n),g=({active:e,payload:t,label:u})=>e&&t&&t.length?s.jsxs("div",{className:"p-2 bg-background border rounded-lg shadow-sm",children:[s.jsx("p",{className:"text-sm text-muted-foreground max-w-[200px] break-words",children:u}),s.jsx("p",{className:"font-bold text-foreground",children:`${t[0].value}% completion`})]}):null;if(p)return s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(e=>s.jsx("div",{className:"h-32 bg-gray-200 rounded"},e))})]})});if(!l)return s.jsx(a,{children:s.jsxs(i,{className:"p-6 text-center",children:[s.jsx(v,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),s.jsx("p",{className:"text-gray-500",children:"No customer insights data available"})]})});const x=l.questions.map(e=>e.completion_rate),h=x.reduce((e,t)=>e+t,0)/x.length,r=l.questions.reduce((e,t)=>(t.completion_rate<80?e.lowCompletion.push(t):t.completion_rate>=90&&e.highPerforming.push(t),t.completion_rate<70&&e.needAttention.push(t),e),{highPerforming:[],needAttention:[],lowCompletion:[]});return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Customer Insights"}),s.jsxs(f,{variant:"outline",children:[l.summary.total_responses," total responses"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx(a,{children:s.jsxs(i,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(y,{className:"w-5 h-5 text-green-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Avg Completion Rate"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(h),"%"]}),s.jsx(j,{value:h,className:"mt-2"})]})]})}),s.jsx(a,{children:s.jsxs(i,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(b,{className:"w-5 h-5 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"High Performers"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"text-2xl font-bold",children:r.highPerforming.length}),s.jsx("div",{className:"text-sm text-gray-500",children:"questions ≥ 90% completion"})]})]})}),s.jsx(a,{children:s.jsxs(i,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(w,{className:"w-5 h-5 text-red-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Need Attention"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"text-2xl font-bold",children:r.needAttention.length}),s.jsx("div",{className:"text-sm text-gray-500",children:"questions < 70% completion"})]})]})}),s.jsx(a,{children:s.jsxs(i,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(C,{className:"w-5 h-5 text-orange-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Low Completion"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"text-2xl font-bold",children:r.lowCompletion.length}),s.jsx("div",{className:"text-sm text-gray-500",children:"questions < 80% completion"})]})]})})]}),s.jsxs(_,{defaultValue:"trends",className:"w-full",children:[s.jsxs(T,{className:"grid grid-cols-3 w-full max-w-md",children:[s.jsx(m,{value:"trends",children:"Trends"}),s.jsx(m,{value:"themes",children:"Themes"}),s.jsx(m,{value:"sessions",children:"Sessions"})]}),s.jsx(o,{value:"trends",className:"space-y-4",children:s.jsxs(a,{children:[s.jsx(c,{children:s.jsx(d,{children:"Feedback Trends"})}),s.jsx(i,{children:s.jsx("div",{className:"space-y-4",children:l.categories.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:e.category}),s.jsxs("p",{className:"text-sm text-gray-600",children:[e.total_questions," questions • ",e.total_responses," responses"]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"text-sm text-gray-500",children:[e.completion_rate,"% completion"]})})]},t))})})]})}),s.jsx(o,{value:"themes",className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(a,{children:[s.jsx(c,{children:s.jsx(d,{className:"text-green-600",children:"High Performing Questions"})}),s.jsx(i,{children:s.jsxs("div",{className:"space-y-3",children:[r.highPerforming.slice(0,5).map((e,t)=>s.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border-l-4 border-green-500",children:[s.jsx("div",{className:"font-medium text-sm",children:e.question_text}),s.jsx("div",{className:"flex justify-between items-center mt-2",children:s.jsxs("span",{className:"text-sm text-gray-600",children:[e.total_responses," responses"]})})]},t)),r.highPerforming.length===0&&s.jsx("p",{className:"text-gray-500 text-center py-4",children:"No high performing questions yet"})]})})]}),s.jsxs(a,{children:[s.jsx(c,{children:s.jsx(d,{className:"text-red-600",children:"Questions Needing Attention"})}),s.jsx(i,{children:s.jsxs("div",{className:"space-y-3",children:[r.needAttention.slice(0,5).map((e,t)=>s.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border-l-4 border-red-500",children:[s.jsx("div",{className:"font-medium text-sm",children:e.question_text}),s.jsx("div",{className:"flex justify-between items-center mt-2",children:s.jsxs("span",{className:"text-sm text-gray-600",children:[e.total_responses," responses"]})})]},t)),r.needAttention.length===0&&s.jsx("p",{className:"text-gray-500 text-center py-4",children:"All questions performing well!"})]})})]})]})}),s.jsx(o,{value:"sessions",className:"space-y-4",children:s.jsxs(a,{children:[s.jsx(c,{children:s.jsx(d,{children:"Session Analysis"})}),s.jsx(i,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-3",children:"Completion Rate by Question"}),s.jsx("div",{className:"h-[300px]",children:s.jsx(A,{width:"100%",height:"100%",children:s.jsxs(L,{layout:"vertical",data:l.questions.slice(0,5).map(e=>({name:e.question_text,"Completion Rate":e.completion_rate})),margin:{top:5,right:20,left:10,bottom:5},children:[s.jsx(R,{strokeDasharray:"3 3",horizontal:!1}),s.jsx(P,{type:"number",domain:[0,100],unit:"%"}),s.jsx(k,{dataKey:"name",type:"category",width:60,tickLine:!1,axisLine:!1,tickFormatter:e=>e.length>15?`${e.substring(0,15)}...`:e}),s.jsx(q,{content:s.jsx(g,{}),cursor:{fill:"hsl(var(--muted))"}}),s.jsx(B,{dataKey:"Completion Rate",fill:"hsl(var(--primary))",barSize:20,radius:[0,4,4,0]})]})})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-3",children:"Response Distribution"}),s.jsx("div",{className:"space-y-2",children:l.categories.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm",children:e.category}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(j,{value:e.total_responses/l.summary.total_responses*100,className:"w-16 h-2"}),s.jsx("span",{className:"text-sm font-medium",children:e.total_responses})]})]},t))})]})]})})]})})]})]})},F=({organizationId:n})=>s.jsx(D,{permission:"view_analytics",organizationId:n,showRequiredRole:!0,fallback:s.jsxs("div",{className:"text-center p-8",children:[s.jsx("p",{className:"text-gray-500",children:"You need viewer-level access or higher to view customer insights."}),s.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:s.jsx(H,{organizationId:n})});export{F as CustomerInsightsTab,F as default};
