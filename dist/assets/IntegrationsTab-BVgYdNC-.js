import{c as C,s as A,a4 as q,a5 as F,r as p,u as U,a6 as P,j as e,C as f,a as v,b,d as D,e as N,a7 as I,g as k,a8 as R,w as H,x as Q,y as S,z as g,A as V,E as j,S as B,B as T,f as $,a9 as G,aa as W,ab as J,ac as X,ad as Z,ae as ee,af as se,ag as ae,ah as ie,ai as te,aj as ne,ak as re,al as le,am as ce,an as de,ao as oe,ap as me,aq as O,ar as o,as as K,I as Y,at as he,M as w,au as z,av as xe}from"./index-BElp8XcP.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=C("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=C("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=C("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=C("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=C("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=C("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),ve=async s=>{const{data:a,error:r}=await A.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",s).order("created_at",{ascending:!1});if(r)throw r;return a},be=async(s,a)=>{const{data:r,error:t}=await A.rpc("create_api_key",{p_organization_id:s,p_key_name:a});if(t)throw t;return r},Ne=async(s,a)=>{const{data:r,error:t}=await A.from("api_keys").update({status:a}).eq("id",s).select().single();if(t)throw t;return r},ke=({apiKey:s})=>{const[a,r]=p.useState(!1),t=()=>{navigator.clipboard.writeText(s),r(!0),o({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>r(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:s}),e.jsx(k,{variant:"ghost",size:"icon",onClick:t,children:a?e.jsx(O,{className:"h-4 w-4 text-green-500"}):e.jsx(je,{className:"h-4 w-4"})})]})},we=()=>{const{organization:s}=q(),a=F(),[r,t]=p.useState(""),[m,u]=p.useState(null),h=["apiKeys",s==null?void 0:s.id],{data:n,isLoading:_}=U({queryKey:h,queryFn:()=>ve(s.id),enabled:!!s}),c=P({mutationFn:i=>be(s.id,i),onSuccess:i=>{o({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),u(i),t(""),a.invalidateQueries({queryKey:h})},onError:i=>{o({title:"Error",description:i.message,variant:"destructive"})}}),y=P({mutationFn:({keyId:i,status:x})=>Ne(i,x),onSuccess:()=>{o({title:"Status Updated"}),a.invalidateQueries({queryKey:h})},onError:i=>{o({title:"Error",description:i.message,variant:"destructive"})}}),l=i=>{i.preventDefault(),r.trim()&&s&&c.mutate(r.trim())};return e.jsxs(f,{className:"col-span-1 lg:col-span-2",children:[e.jsxs(v,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(ye,{})," API Keys"]}),e.jsx(D,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(N,{children:[e.jsxs("form",{onSubmit:l,className:"flex items-center gap-2 mb-6",children:[e.jsx(I,{placeholder:"New key name (e.g., 'SMS Integration')",value:r,onChange:i=>t(i.target.value),disabled:c.isPending}),e.jsxs(k,{type:"submit",disabled:!r.trim()||c.isPending,children:[c.isPending?e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(S,{children:[e.jsx(g,{children:"Name"}),e.jsx(g,{children:"Key Prefix"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Last Used"}),e.jsx(g,{children:"Created"}),e.jsx(g,{className:"text-right",children:"Actions"})]})}),e.jsx(V,{children:_?Array.from({length:3}).map((i,x)=>e.jsx(S,{children:e.jsx(j,{colSpan:6,children:e.jsx(B,{className:"h-8 w-full"})})},x)):n&&n.length>0?n.map(i=>e.jsxs(S,{children:[e.jsx(j,{className:"font-medium",children:i.key_name}),e.jsx(j,{children:e.jsxs("code",{children:[i.key_prefix,"..."]})}),e.jsx(j,{children:e.jsx(T,{variant:i.status==="active"?"default":"secondary",children:i.status})}),e.jsx(j,{children:i.last_used_at?`${$(new Date(i.last_used_at))} ago`:"Never"}),e.jsx(j,{children:G(new Date(i.created_at),"MMM d, yyyy")}),e.jsx(j,{className:"text-right",children:e.jsxs(W,{children:[e.jsx(J,{asChild:!0,children:e.jsx(k,{variant:"ghost",size:"icon",disabled:y.isPending,children:i.status==="active"?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(fe,{className:"h-4 w-4"})})}),e.jsxs(X,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Are you sure?"}),e.jsxs(se,{children:["This will ",i.status==="active"?"deactivate":"activate"," the API key.",i.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(ae,{children:[e.jsx(ie,{children:"Cancel"}),e.jsx(te,{onClick:()=>y.mutate({keyId:i.id,status:i.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},i.id)):e.jsx(S,{children:e.jsx(j,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(ne,{open:!!m,onOpenChange:i=>!i&&u(null),children:e.jsxs(re,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"API Key Created Successfully"}),e.jsx(de,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(ke,{apiKey:m||""}),e.jsx(oe,{children:e.jsx(me,{asChild:!0,children:e.jsx(k,{children:"Close"})})})]})})]})]})},Ae=({organization:s,currentSettings:a,onSettingsUpdate:r})=>{var l,i,x,E;const[t,m]=p.useState(((l=a==null?void 0:a.sms_settings)==null?void 0:l.username)||""),[u,h]=p.useState(""),[n,_]=p.useState((a==null?void 0:a.sms_sender_id)||""),c=P({mutationFn:async()=>{const{data:d,error:M}=await A.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:(a==null?void 0:a.sms_enabled)||!1,senderId:n.trim(),username:t.trim(),apiKey:u.trim()}});if(M)throw M;return d},onSuccess:()=>{o({title:"Africa's Talking settings saved successfully",description:"Your SMS integration is now configured"}),h(""),r()},onError:d=>{o({title:"Error saving settings",description:d.message,variant:"destructive"})}}),y=d=>{var M;if(d.preventDefault(),!t.trim()){o({title:"Username required",description:"Please enter your Africa's Talking username",variant:"destructive"});return}if(!u.trim()&&!((M=a==null?void 0:a.sms_settings)!=null&&M.apiKey)){o({title:"API Key required",description:"Please enter your Africa's Talking API key",variant:"destructive"});return}c.mutate()};return e.jsxs(f,{className:"mt-4",children:[e.jsx(v,{children:e.jsx(b,{className:"text-lg",children:"Africa's Talking Configuration"})}),e.jsx(N,{children:e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-username",children:"Username *"}),e.jsx(I,{id:"at-username",value:t,onChange:d=>m(d.target.value),placeholder:"Your Africa's Talking username",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-sender-id",children:"Sender ID (Optional)"}),e.jsx(I,{id:"at-sender-id",value:n,onChange:d=>_(d.target.value),placeholder:"e.g., YourBrand",maxLength:11}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Max 11 characters. Leave blank to use default."})]})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"at-api-key",children:"API Key *"}),e.jsx(I,{id:"at-api-key",type:"password",value:u,onChange:d=>h(d.target.value),placeholder:(i=a==null?void 0:a.sms_settings)!=null&&i.apiKey?"Enter new API key (leave blank to keep current)":"Your Africa's Talking API key",required:!((x=a==null?void 0:a.sms_settings)!=null&&x.apiKey)}),((E=a==null?void 0:a.sms_settings)==null?void 0:E.apiKey)&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"API key is configured. Enter a new key only if you want to update it."})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Setup Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside text-blue-700 space-y-1 mt-1",children:[e.jsx("li",{children:"Get your credentials from Africa's Talking dashboard"}),e.jsx("li",{children:"Configure the webhook URL in your Africa's Talking app settings"}),e.jsx("li",{children:"Test the integration by sending an SMS to your shortcode"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(k,{type:"submit",disabled:c.isPending,className:"flex items-center gap-2",children:[c.isPending?e.jsx(R,{className:"w-4 h-4 animate-spin"}):null,"Save Configuration"]}),e.jsxs(k,{type:"button",variant:"outline",onClick:()=>window.open("https://account.africastalking.com/","_blank"),className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Open Dashboard"]})]})]})})]})},Ce=({enabled:s,onToggle:a,isLoading:r})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"SMS Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to provide feedback via SMS"})]}),e.jsx(he,{checked:s,onCheckedChange:a,disabled:r})]}),_e=({webhookSecret:s,isVisible:a})=>a?e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"SMS Webhook URL:"})]}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-md",children:e.jsx("code",{className:"text-sm break-all",children:`${window.location.origin}/functions/v1/handle-sms-webhook/${s}`})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use this URL as your SMS webhook endpoint in your provider's dashboard"})]}):null,Me=({providers:s,selectedProvider:a,onProviderSelect:r})=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Available Providers"}),s.map(t=>{const m=t.icon;return e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${a===t.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>t.status==="available"&&r(a===t.id?null:t.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.status==="available"?e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"default",children:"Available"}),a===t.id&&e.jsx(O,{className:"w-4 h-4 text-blue-500"})]}):e.jsx(T,{variant:"secondary",children:"Coming Soon"})})]})},t.id)})]}),Se=[{id:"africastalking",name:"Africa's Talking",description:"SMS services across Africa with reliable delivery",icon:w,status:"available"},{id:"twilio",name:"Twilio",description:"Global SMS and communication platform",icon:w,status:"coming_soon"},{id:"vonage",name:"Vonage",description:"SMS API for global messaging",icon:w,status:"coming_soon"}],L=(s,a)=>s&&typeof s=="object"&&!Array.isArray(s)&&s[a]||"",Ie=()=>{const{organization:s}=q(),{isAdmin:a,isOrgAdmin:r}=z(),t=F(),[m,u]=p.useState(null),h=a||r,{data:n,isLoading:_}=U({queryKey:["organization-sms",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return null;const{data:l,error:i}=await A.from("organizations").select("sms_enabled, sms_sender_id, sms_settings, webhook_secret").eq("id",s.id).single();if(i)throw i;return l},enabled:!!(s!=null&&s.id)&&h}),c=P({mutationFn:async l=>{const{data:i,error:x}=await A.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:l,senderId:(n==null?void 0:n.sms_sender_id)||"",username:L(n==null?void 0:n.sms_settings,"username"),apiKey:L(n==null?void 0:n.sms_settings,"apiKey")}});if(x)throw x;return i},onSuccess:()=>{o({title:"SMS status updated successfully"}),t.invalidateQueries({queryKey:["organization-sms",s==null?void 0:s.id]})},onError:l=>{o({title:"Error updating SMS status",description:l.message,variant:"destructive"})}}),y=l=>{c.mutate(l)};return h?_?e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(N,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}):e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"SMS Integrations"]}),e.jsx(D,{children:"Enable SMS feedback collection from your customers"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsx(Ce,{enabled:(n==null?void 0:n.sms_enabled)||!1,onToggle:y,isLoading:c.isPending}),e.jsx(_e,{webhookSecret:(n==null?void 0:n.webhook_secret)||"",isVisible:(n==null?void 0:n.sms_enabled)||!1}),e.jsx(Me,{providers:Se,selectedProvider:m,onProviderSelect:u}),m==="africastalking"&&e.jsx(Ae,{organization:s,currentSettings:n,onSettingsUpdate:()=>{t.invalidateQueries({queryKey:["organization-sms",s==null?void 0:s.id]})}})]})]}):e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(N,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"You need admin access to manage SMS integrations."})})]})},Pe=()=>e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsx(b,{children:"CRM Integration"}),e.jsx(D,{children:"Connect to your favorite CRM."})]}),e.jsx(N,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"CRM integrations are coming soon."})})]}),Te=()=>{const{isAdmin:s,isOrgAdmin:a}=z();return q(),s||a?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Ie,{}),e.jsx(xe,{}),e.jsx(we,{}),e.jsx(Pe,{})]})]}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage integrations."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]})};export{Te as IntegrationsTab,Te as default};
