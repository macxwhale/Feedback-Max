import{c as P,s as C,af as X,ab as Z,r as v,u as J,ac as F,j as e,C as A,k as q,q as D,ai as Pe,a4 as be,l as E,K as I,B as p,aj as Fe,ak as qe,al as De,am as se,an as $,ao as Ke,ap as B,V as Te,i as ee,aq as we,ar as Ie,as as Le,at as Re,au as Oe,av as Ue,aw as ze,ax as Be,ay as Qe,az as We,aA as re,aB as ie,aC as le,aD as ce,aE as $e,aF as Ve,aG as He,aH as Ce,aI as g,M as L,a5 as K,ag as Ye,aJ as Je,E as Ge,aK as Xe,o as Se,a8 as ne,a6 as de,U as G,aa as ke,ae as oe,m as ue,aL as Ze,a0 as es,Y as ss,J as as,_ as he,$ as xe,a1 as pe,a2 as ge,a3 as U,T as ts,w as ns,x as rs,y as je,z as fe}from"./index-CwWO4DGV.js";import{f as is}from"./format-CK8u0eST.js";import{S as ls}from"./switch-DVt7D-Yp.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=P("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=P("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=P("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=P("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=P("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=P("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=P("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=P("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=P("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=P("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=P("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=P("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=P("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]),js=async s=>{const{data:a,error:t}=await C.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",s).order("created_at",{ascending:!1});if(t)throw t;return a},fs=async(s,a)=>{const{data:t,error:c}=await C.rpc("create_api_key",{p_organization_id:s,p_key_name:a});if(c)throw c;return t},ys=async(s,a)=>{const{data:t,error:c}=await C.from("api_keys").update({status:a}).eq("id",s).select().single();if(c)throw c;return t},vs=({apiKey:s})=>{const[a,t]=v.useState(!1),c=()=>{navigator.clipboard.writeText(s),t(!0),g({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>t(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:s}),e.jsx(p,{variant:"ghost",size:"icon",onClick:c,children:a?e.jsx(Ce,{className:"h-4 w-4 text-green-500"}):e.jsx(ae,{className:"h-4 w-4"})})]})},Ns=()=>{const{organization:s}=X(),a=Z(),[t,c]=v.useState(""),[n,o]=v.useState(null),i=["apiKeys",s==null?void 0:s.id],{data:d,isLoading:u}=J({queryKey:i,queryFn:()=>js(s.id),enabled:!!s}),j=F({mutationFn:r=>fs(s.id,r),onSuccess:r=>{g({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),o(r),c(""),a.invalidateQueries({queryKey:i})},onError:r=>{g({title:"Error",description:r.message,variant:"destructive"})}}),m=F({mutationFn:({keyId:r,status:S})=>ys(r,S),onSuccess:()=>{g({title:"Status Updated"}),a.invalidateQueries({queryKey:i})},onError:r=>{g({title:"Error",description:r.message,variant:"destructive"})}}),l=r=>{r.preventDefault(),t.trim()&&s&&j.mutate(t.trim())};return e.jsxs(A,{className:"w-full",children:[e.jsxs(q,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Pe,{})," API Keys"]}),e.jsx(be,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(E,{children:[e.jsxs("form",{onSubmit:l,className:"flex items-center gap-2 mb-6",children:[e.jsx(I,{placeholder:"New key name (e.g., 'SMS Integration')",value:t,onChange:r=>c(r.target.value),disabled:j.isPending}),e.jsxs(p,{type:"submit",disabled:!t.trim()||j.isPending,children:[j.isPending?e.jsx(Fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(os,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(qe,{children:[e.jsx(De,{children:e.jsxs(se,{children:[e.jsx($,{children:"Name"}),e.jsx($,{children:"Key Prefix"}),e.jsx($,{children:"Status"}),e.jsx($,{children:"Last Used"}),e.jsx($,{children:"Created"}),e.jsx($,{className:"text-right",children:"Actions"})]})}),e.jsx(Ke,{children:u?Array.from({length:3}).map((r,S)=>e.jsx(se,{children:e.jsx(B,{colSpan:6,children:e.jsx(Te,{className:"h-8 w-full"})})},S)):d&&d.length>0?d.map(r=>e.jsxs(se,{children:[e.jsx(B,{className:"font-medium",children:r.key_name}),e.jsx(B,{children:e.jsxs("code",{children:[r.key_prefix,"..."]})}),e.jsx(B,{children:e.jsx(ee,{variant:r.status==="active"?"default":"secondary",children:r.status})}),e.jsx(B,{children:r.last_used_at?`${we(new Date(r.last_used_at))} ago`:"Never"}),e.jsx(B,{children:is(new Date(r.created_at),"MMM d, yyyy")}),e.jsx(B,{className:"text-right",children:e.jsxs(Ie,{children:[e.jsx(Le,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",disabled:m.isPending,children:r.status==="active"?e.jsx(hs,{className:"h-4 w-4"}):e.jsx(xs,{className:"h-4 w-4"})})}),e.jsxs(Re,{children:[e.jsxs(Oe,{children:[e.jsx(Ue,{children:"Are you sure?"}),e.jsxs(ze,{children:["This will ",r.status==="active"?"deactivate":"activate"," the API key.",r.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(Be,{children:[e.jsx(Qe,{children:"Cancel"}),e.jsx(We,{onClick:()=>m.mutate({keyId:r.id,status:r.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},r.id)):e.jsx(se,{children:e.jsx(B,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(re,{open:!!n,onOpenChange:r=>!r&&o(null),children:e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"API Key Created Successfully"}),e.jsx($e,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(vs,{apiKey:n||""}),e.jsx(Ve,{children:e.jsx(He,{asChild:!0,children:e.jsx(p,{children:"Close"})})})]})})]})]})},bs=({organization:s,currentSettings:a,onSettingsUpdate:t})=>{var u,j;const c=Z(),[n,o]=v.useState({username:((u=a==null?void 0:a.sms_settings)==null?void 0:u.username)||"",apiKey:((j=a==null?void 0:a.sms_settings)==null?void 0:j.apiKey)||"",senderId:(a==null?void 0:a.sms_sender_id)||""}),i=F({mutationFn:async m=>{const{data:l,error:r}=await C.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:!0,senderId:m.senderId,username:m.username,apiKey:m.apiKey}});if(r)throw r;return l},onSuccess:()=>{g({title:"Success",description:"SMS settings updated successfully"}),c.invalidateQueries({queryKey:["organization-sms-settings"]}),t()},onError:m=>{g({title:"Error",description:m.message||"Failed to update SMS settings",variant:"destructive"})}}),d=m=>{if(m.preventDefault(),!n.username.trim()||!n.apiKey.trim()||!n.senderId.trim()){g({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"});return}i.mutate(n)};return e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"SMS Provider Settings"]})}),e.jsx(E,{children:e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"username",children:"Username *"}),e.jsx(I,{id:"username",type:"text",value:n.username,onChange:m=>o(l=>({...l,username:m.target.value})),placeholder:"Enter your SMS provider username",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"apiKey",children:"API Key *"}),e.jsx(I,{id:"apiKey",type:"password",value:n.apiKey,onChange:m=>o(l=>({...l,apiKey:m.target.value})),placeholder:"Enter your SMS provider API key",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"senderId",children:"Sender ID *"}),e.jsx(I,{id:"senderId",type:"text",value:n.senderId,onChange:m=>o(l=>({...l,senderId:m.target.value})),placeholder:"Enter your sender ID (e.g., 12345)",required:!0}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This is your SMS sender identifier that recipients will see"})]}),e.jsxs(p,{type:"submit",disabled:i.isPending,className:"w-full",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),i.isPending?"Saving...":"Save Settings"]})]})})]})},ws=({enabled:s,onToggle:a,isLoading:t})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"SMS Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to provide feedback via SMS"})]}),e.jsx(ls,{checked:s,onCheckedChange:a,disabled:t})]}),Cs=({webhookSecret:s,isVisible:a,isFlaskWrapper:t=!1})=>{const[c,n]=v.useState(!1),d=`${window.location.origin}${t?"/functions/v1/handle-flask-sms-callback":"/functions/v1/handle-sms-webhook"}`,u=j=>{navigator.clipboard.writeText(j),g({title:"Copied to clipboard",description:"Webhook URL has been copied to your clipboard"})};return a?e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5"}),t?"Flask Webhook Configuration":"SMS Webhook Configuration"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{value:d,readOnly:!0,className:"font-mono text-sm"}),e.jsx(p,{onClick:()=>u(d),variant:"outline",size:"icon",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t?"Configure your Flask wrapper to send callbacks to this URL":"Configure this URL in your Africa's Talking SMS callback settings"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{children:"Webhook Secret"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:c?"text":"password",value:s,readOnly:!0,className:"font-mono text-sm"}),e.jsx(p,{onClick:()=>n(!c),variant:"outline",size:"icon",type:"button",children:c?e.jsx(Je,{className:"w-4 h-4"}):e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx(p,{onClick:()=>u(s),variant:"outline",size:"icon",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use this secret to verify webhook authenticity"})]}),t&&e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-blue-500 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-sm",children:"Flask Integration Notes:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Your Flask wrapper should forward SMS callbacks to the webhook URL above"}),e.jsx("li",{children:"• Include the webhook secret in your callback validation"}),e.jsxs("li",{children:["• Ensure the callback format matches: ","{linkId, text, to, id, date, from}"]}),e.jsx("li",{children:"• The 'to' field should contain your organization's sender ID"})]})]})]})})]})]}):null},Ss=({selectedProvider:s,onProviderSelect:a})=>{const t={id:"sms-provider",name:"SMS Provider (Flask Wrapper)",description:"SMS services via Flask wrapper integration",icon:L,status:"available"};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"SMS Integration"}),e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${s===t.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>a(s===t.id?null:t.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(t.icon,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{variant:"default",children:"Available"}),s===t.id&&e.jsx(Ce,{className:"w-4 h-4 text-blue-500"})]})]})})]})},te=(s,a)=>{if(!s||typeof s!="object")return"";const t=s[a];return typeof t=="string"?t:""},ks=s=>{if(!s||typeof s!="object")return!1;const a=te(s,"username"),t=te(s,"apiKey");return a.length>0&&t.length>0},_s=()=>e.jsxs(q,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"SMS Integrations"]}),e.jsx(be,{children:"Enable SMS feedback collection from your customers"})]}),Ms=({title:s="SMS Integrations"})=>e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),s]})}),e.jsx(E,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}),As=({title:s="SMS Integrations",message:a,onRetry:t})=>e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-red-500"}),s]})}),e.jsx(E,{children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-sm text-red-600 mb-2",children:"Organization not found or failed to load"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:a}),t&&e.jsx("button",{onClick:t,className:"text-sm text-blue-600 hover:underline",children:"Try again"})]})})]}),Es=()=>e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(E,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"You need admin access to manage SMS integrations."})})]}),Ps=({phoneNumber:s,name:a,onPhoneNumberChange:t,onNameChange:c,onSubmit:n,isLoading:o})=>e.jsx("form",{onSubmit:n,className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"phone-number",children:"Phone Number *"}),e.jsx(I,{id:"phone-number",value:s,onChange:i=>t(i.target.value),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"name",children:"Name (Optional)"}),e.jsx(I,{id:"name",value:a,onChange:i=>c(i.target.value),placeholder:"John Doe"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(p,{type:"submit",disabled:o,className:"w-full",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Add Number"]})})]})}),Fs=({bulkNumbers:s,onBulkNumbersChange:a,onBulkAdd:t,onCancel:c,isLoading:n})=>e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"bulk-numbers",children:"Bulk Add Phone Numbers"}),e.jsx(de,{id:"bulk-numbers",value:s,onChange:o=>a(o.target.value),placeholder:"Enter phone numbers, one per line. Format: +1234567890 or +1234567890,John Doe",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Format: One phone number per line. Optionally add name after comma."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onClick:t,disabled:n,children:"Add All Numbers"}),e.jsx(p,{variant:"outline",onClick:c,children:"Cancel"})]})]}),qs=({phoneNumbers:s,onDelete:a,isDeleting:t})=>{const c=n=>n.startsWith("+")?n:`+${n}`;return s.length===0?e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No phone numbers added yet."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers to start sending SMS campaigns."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Registered Phone Numbers"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:c(n.phone_number)}),n.name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:n.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ee,{variant:n.status==="active"?"default":"secondary",children:n.status}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Added ",new Date(n.created_at).toLocaleDateString()]})]})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>a(n.id),disabled:t,children:e.jsx(ke,{className:"w-4 h-4"})})]},n.id))})]})},Ds=()=>{const{organization:s}=X(),a=Z(),[t,c]=v.useState(""),[n,o]=v.useState(""),[i,d]=v.useState(""),[u,j]=v.useState(!1),{data:m,isLoading:l}=J({queryKey:["sms-phone-numbers",s==null?void 0:s.id],queryFn:async()=>{const{data:x,error:y}=await C.from("sms_phone_numbers").select("*").eq("organization_id",s.id).order("created_at",{ascending:!1});if(y)throw y;return x},enabled:!!(s!=null&&s.id)}),r=F({mutationFn:async({phoneNumber:x,name:y})=>{const{data:b,error:_}=await C.from("sms_phone_numbers").insert({organization_id:s.id,phone_number:x.trim(),name:(y==null?void 0:y.trim())||null}).select().single();if(_)throw _;return b},onSuccess:()=>{g({title:"Phone number added successfully"}),c(""),o(""),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:x=>{g({title:"Error adding phone number",description:x.message,variant:"destructive"})}}),S=F({mutationFn:async x=>{const{data:y,error:b}=await C.from("sms_phone_numbers").insert(x.map(({phoneNumber:_,name:k})=>({organization_id:s.id,phone_number:_.trim(),name:(k==null?void 0:k.trim())||null})));if(b)throw b;return y},onSuccess:()=>{g({title:"Phone numbers added successfully"}),d(""),j(!1),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:x=>{g({title:"Error adding phone numbers",description:x.message,variant:"destructive"})}}),h=F({mutationFn:async x=>{const{error:y}=await C.from("sms_phone_numbers").delete().eq("id",x);if(y)throw y},onSuccess:()=>{g({title:"Phone number removed successfully"}),a.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:x=>{g({title:"Error removing phone number",description:x.message,variant:"destructive"})}}),f=x=>{x.preventDefault(),t.trim()&&r.mutate({phoneNumber:t,name:n})},w=()=>{const y=i.split(`
`).filter(b=>b.trim()).map(b=>{const _=b.split(",").map(k=>k.trim());return{phoneNumber:_[0],name:_[1]||void 0}}).filter(b=>b.phoneNumber);if(y.length===0){g({title:"No valid phone numbers found",description:"Please enter at least one phone number",variant:"destructive"});return}S.mutate(y)};return l?e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Phone Numbers"]})}),e.jsx(E,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}):e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Phone Numbers (",(m==null?void 0:m.length)||0,")"]})}),e.jsxs(E,{className:"space-y-6",children:[e.jsx(Ps,{phoneNumber:t,name:n,onPhoneNumberChange:c,onNameChange:o,onSubmit:f,isLoading:r.isPending}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(p,{variant:"outline",onClick:()=>j(!u),children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Bulk Add"]})}),u&&e.jsx(Fs,{bulkNumbers:i,onBulkNumbersChange:d,onBulkAdd:w,onCancel:()=>j(!1),isLoading:S.isPending}),e.jsx(qs,{phoneNumbers:m||[],onDelete:x=>h.mutate(x),isDeleting:h.isPending})]})]})},Ks=()=>{const{user:s}=oe(),{organization:a}=X(),t=Z(),{data:c=[],isLoading:n,error:o}=J({queryKey:["sms-campaigns",a==null?void 0:a.id],queryFn:async()=>{if(!(a!=null&&a.id))return[];const{data:h,error:f}=await C.from("sms_campaigns").select("*").eq("organization_id",a.id).order("created_at",{ascending:!1});if(f)throw f;return h||[]},enabled:!!(a!=null&&a.id)}),{data:i=[],isLoading:d,error:u}=J({queryKey:["sms-phone-numbers",a==null?void 0:a.id],queryFn:async()=>{if(!(a!=null&&a.id))return[];const{data:h,error:f}=await C.from("sms_phone_numbers").select("*").eq("organization_id",a.id).eq("status","active").order("created_at",{ascending:!1});if(f)throw f;return h||[]},enabled:!!(a!=null&&a.id)}),j=F({mutationFn:async({name:h,template:f})=>{if(!(a!=null&&a.id)||!(s!=null&&s.id))throw new Error("Missing organization or user");const{data:w,error:x}=await C.from("sms_campaigns").insert({organization_id:a.id,name:h,message_template:f,created_by_user_id:s.id,status:"draft"}).select().single();if(x)throw x;return w},onSuccess:()=>{t.invalidateQueries({queryKey:["sms-campaigns"]}),g({title:"Success",description:"Campaign created successfully"})},onError:h=>{console.error("Error creating campaign:",h),g({title:"Error",description:"Failed to create campaign",variant:"destructive"})}}),m=F({mutationFn:async({campaignId:h,name:f,template:w})=>{const{data:x,error:y}=await C.from("sms_campaigns").update({name:f,message_template:w,updated_at:new Date().toISOString()}).eq("id",h).select().single();if(y)throw y;return x},onSuccess:()=>{t.invalidateQueries({queryKey:["sms-campaigns"]}),g({title:"Success",description:"Campaign updated successfully"})},onError:h=>{console.error("Error updating campaign:",h),g({title:"Error",description:"Failed to update campaign",variant:"destructive"})}}),l=F({mutationFn:async h=>{const{error:f}=await C.from("sms_campaigns").delete().eq("id",h);if(f)throw f},onSuccess:()=>{t.invalidateQueries({queryKey:["sms-campaigns"]}),g({title:"Success",description:"Campaign deleted successfully"})},onError:h=>{console.error("Error deleting campaign:",h),g({title:"Error",description:"Failed to delete campaign",variant:"destructive"})}}),r=F({mutationFn:async({campaignId:h,isResend:f=!1,isRetry:w=!1})=>{const{data:x,error:y}=await C.functions.invoke("send-sms-flask",{body:{campaignId:h,isResend:f,isRetry:w}});if(y)throw y;return x},onSuccess:h=>{t.invalidateQueries({queryKey:["sms-campaigns"]}),t.invalidateQueries({queryKey:["sms-sends"]}),g({title:"Success",description:`Campaign sent successfully! ${h.sentCount}/${h.sentCount+h.failedCount} messages delivered.`})},onError:h=>{console.error("Error sending campaign:",h),g({title:"Error",description:"Failed to send campaign",variant:"destructive"})}}),S=F({mutationFn:async({campaignId:h,action:f})=>{let w;switch(f){case"pause":w="paused";break;case"resume":w="sending";break;case"cancel":w="cancelled";break;default:throw new Error("Invalid action")}const{error:x}=await C.from("sms_campaigns").update({status:w}).eq("id",h);if(x)throw x},onSuccess:(h,{action:f})=>{t.invalidateQueries({queryKey:["sms-campaigns"]}),g({title:"Success",description:`Campaign ${f}d successfully`})},onError:h=>{console.error("Error controlling campaign:",h),g({title:"Error",description:"Failed to update campaign status",variant:"destructive"})}});return{campaigns:c,campaignsLoading:n,campaignsError:o,phoneNumbers:i,phoneNumbersLoading:d,phoneNumbersError:u,createCampaignMutation:j,updateCampaignMutation:m,deleteCampaignMutation:l,sendCampaignMutation:r,campaignControlMutation:S,organization:a}},Ts=({onSubmit:s,onCancel:a,isLoading:t,phoneNumbersCount:c,organizationName:n})=>{const[o,i]=v.useState(""),[d,u]=v.useState(""),j=`Hi! We'd love your feedback on our service. Please text back 'START' to begin a quick survey. Your input helps us improve. Thank you! - ${n||"Your Company"}`,m=l=>{l.preventDefault(),!(!o.trim()||!d.trim())&&(s(o,d),i(""),u(""))};return e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium",children:"Create New Campaign"}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"campaign-name",children:"Campaign Name *"}),e.jsx(I,{id:"campaign-name",value:o,onChange:l=>i(l.target.value),placeholder:"Feedback Request Campaign",required:!0})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"message-template",children:"Message Template *"}),e.jsx(de,{id:"message-template",value:d,onChange:l=>u(l.target.value),placeholder:j,rows:4,required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Recipients: ",c," active phone numbers"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"submit",disabled:t,children:"Create Campaign"}),e.jsx(p,{type:"button",variant:"outline",onClick:a,children:"Cancel"})]})]})]})},Is=({campaign:s,onSend:a,onResend:t,onRetry:c,onCancel:n,onPause:o,onResume:i,onDuplicate:d,onSchedule:u,onEdit:j,onDelete:m,isLoading:l})=>{const[r,S]=v.useState(!1),h=z=>{switch(z){case"draft":return"bg-gray-100 text-gray-800";case"sending":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"paused":return"bg-yellow-100 text-yellow-800";case"cancelled":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-800"}},f=z=>{switch(z){case"completed":return e.jsx(ue,{className:"w-4 h-4"});case"failed":return e.jsx(ye,{className:"w-4 h-4"});case"sending":return e.jsx(ss,{className:"w-4 h-4"});default:return null}},w=s.status==="draft",x=s.status==="completed",y=s.status==="failed",b=s.status==="sending",_=s.status==="paused",k=s.status==="sending"||s.status==="paused",V=s.status==="draft"||s.status==="failed";return e.jsx(A,{className:"w-full hover:shadow-md transition-shadow",children:e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsxs(ee,{className:`${h(s.status)} flex items-center gap-1`,children:[f(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-3",children:["Created ",we(new Date(s.created_at),{addSuffix:!0})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.total_recipients||0," recipients"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.sent_count||0," sent"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:[s.delivered_count||0," delivered"]})]}),s.failed_count>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{children:[s.failed_count," failed"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[V&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>j(s),disabled:l,children:[e.jsx(us,{className:"w-4 h-4 mr-1"}),"Edit"]}),w&&e.jsxs(p,{onClick:()=>a(s.id),disabled:l,size:"sm",children:[e.jsx(ve,{className:"w-4 h-4 mr-1"}),"Send"]}),x&&e.jsxs(p,{variant:"outline",onClick:()=>t(s.id),disabled:l,size:"sm",children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"}),"Resend"]}),y&&e.jsxs(p,{variant:"outline",onClick:()=>c(s.id),disabled:l,size:"sm",children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"}),"Retry"]}),b&&e.jsxs(p,{variant:"outline",onClick:()=>o(s.id),disabled:l,size:"sm",children:[e.jsx(Ze,{className:"w-4 h-4 mr-1"}),"Pause"]}),_&&e.jsxs(p,{variant:"outline",onClick:()=>i(s.id),disabled:l,size:"sm",children:[e.jsx(ve,{className:"w-4 h-4 mr-1"}),"Resume"]}),k&&e.jsx(p,{variant:"outline",onClick:()=>n(s.id),disabled:l,size:"sm",children:"Cancel"}),e.jsxs(p,{variant:"outline",onClick:()=>d(s.id),disabled:l,size:"sm",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Duplicate"]}),e.jsxs(p,{variant:"outline",onClick:()=>u(s.id),disabled:l,size:"sm",children:[e.jsx(es,{className:"w-4 h-4 mr-1"}),"Schedule"]}),e.jsxs(p,{variant:"outline",onClick:()=>m(s),disabled:l,size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(ke,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("button",{onClick:()=>S(!r),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:[r?"Hide":"Show"," message preview"]}),r&&e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:s.message_template})})]}),(s.started_at||s.completed_at)&&e.jsxs("div",{className:"mt-4 text-xs text-gray-500 space-y-1",children:[s.started_at&&e.jsxs("div",{children:["Started: ",new Date(s.started_at).toLocaleString()]}),s.completed_at&&e.jsxs("div",{children:["Completed: ",new Date(s.completed_at).toLocaleString()]})]})]})})},Ls=({searchTerm:s,onSearchChange:a,statusFilter:t,onStatusFilterChange:c,sortBy:n,onSortByChange:o,sortOrder:i,onSortOrderChange:d,totalCampaigns:u,filteredCount:j})=>{const m=()=>{a(""),c("all"),o("created_at"),d("desc")},l=s||t!=="all";return e.jsxs("div",{className:"w-full space-y-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters"}),l&&e.jsxs(ee,{variant:"secondary",className:"text-xs",children:[j," of ",u]})]}),l&&e.jsx(p,{variant:"ghost",size:"sm",onClick:m,children:"Clear All"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(I,{placeholder:"Search campaigns...",value:s,onChange:r=>a(r.target.value),className:"pl-10 w-full"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(he,{value:t,onValueChange:c,children:[e.jsx(xe,{className:"w-full sm:w-[150px]",children:e.jsx(pe,{placeholder:"Status"})}),e.jsxs(ge,{children:[e.jsx(U,{value:"all",children:"All Status"}),e.jsx(U,{value:"draft",children:"Draft"}),e.jsx(U,{value:"sending",children:"Sending"}),e.jsx(U,{value:"completed",children:"Completed"}),e.jsx(U,{value:"failed",children:"Failed"})]})]}),e.jsxs(he,{value:n,onValueChange:o,children:[e.jsx(xe,{className:"w-full sm:w-[150px]",children:e.jsx(pe,{placeholder:"Sort by"})}),e.jsxs(ge,{children:[e.jsx(U,{value:"created_at",children:"Created Date"}),e.jsx(U,{value:"name",children:"Name"}),e.jsx(U,{value:"total_recipients",children:"Recipients"}),e.jsx(U,{value:"delivered_count",children:"Delivery Rate"})]})]}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>d(i==="asc"?"desc":"asc"),className:"w-full sm:w-auto",children:i==="asc"?e.jsx(ds,{className:"w-4 h-4"}):e.jsx(cs,{className:"w-4 h-4"})})]})]})]})},Rs=({campaign:s,isOpen:a,onClose:t,onSave:c,isLoading:n})=>{const[o,i]=v.useState(""),[d,u]=v.useState("");v.useEffect(()=>{s&&(i(s.name),u(s.message_template))},[s]);const j=()=>{s&&o.trim()&&d.trim()&&c(s.id,o.trim(),d.trim())},m=()=>{i(""),u(""),t()};return s?e.jsx(re,{open:a,onOpenChange:m,children:e.jsxs(ie,{className:"max-w-md",children:[e.jsx(le,{children:e.jsx(ce,{children:"Edit Campaign"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(K,{htmlFor:"campaign-name",children:"Campaign Name"}),e.jsx(I,{id:"campaign-name",value:o,onChange:l=>i(l.target.value),placeholder:"Enter campaign name",disabled:n})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"message-template",children:"Message Template"}),e.jsx(de,{id:"message-template",value:d,onChange:l=>u(l.target.value),placeholder:"Enter your message template",rows:4,disabled:n})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:m,disabled:n,children:"Cancel"}),e.jsx(p,{onClick:j,disabled:n||!o.trim()||!d.trim(),children:n?"Saving...":"Save Changes"})]})]})]})}):null},Os=({campaign:s,isOpen:a,onClose:t,onDelete:c,isLoading:n})=>{const o=()=>{s&&c(s.id)};if(!s)return null;const i=s.status==="sending"||s.status==="completed";return e.jsx(re,{open:a,onOpenChange:t,children:e.jsxs(ie,{className:"max-w-md",children:[e.jsx(le,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-5 h-5 text-red-600"}),"Delete Campaign"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:['Are you sure you want to delete the campaign "',s.name,'"?']}),i&&e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-yellow-800 font-medium mb-1",children:"Warning: This campaign has been sent or is active"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Deleting this campaign will permanently remove all associated data including send records and statistics. This action cannot be undone."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:t,disabled:n,children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:o,disabled:n,children:n?"Deleting...":"Delete Campaign"})]})]})]})})},Us=({campaigns:s,onSend:a,onResend:t,onRetry:c,onCancel:n,onPause:o,onResume:i,onDuplicate:d,onSchedule:u,onEdit:j,onDelete:m,onCreateNew:l,isLoading:r,isEditLoading:S=!1,isDeleteLoading:h=!1})=>{const[f,w]=v.useState(""),[x,y]=v.useState("all"),[b,_]=v.useState("created_at"),[k,V]=v.useState("desc"),[z,H]=v.useState(null),[N,T]=v.useState(null),R=v.useMemo(()=>{let M=s.filter(Q=>{const Y=Q.name.toLowerCase().includes(f.toLowerCase())||Q.message_template.toLowerCase().includes(f.toLowerCase()),O=x==="all"||Q.status===x;return Y&&O});return M.sort((Q,Y)=>{let O=Q[b],W=Y[b];if(b==="created_at"&&(O=new Date(O).getTime(),W=new Date(W).getTime()),typeof O=="number"&&typeof W=="number")return k==="asc"?O-W:W-O;if(typeof O=="string"&&typeof W=="string"){const me=O.localeCompare(W);return k==="asc"?me:-me}return 0}),M},[s,f,x,b,k]),_e=M=>{H(M)},Me=(M,Q,Y)=>{j(M,Q,Y),H(null)},Ae=M=>{T(M)},Ee=M=>{m(M),T(null)};return s.length===0?e.jsxs("div",{className:"w-full text-center p-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(L,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No campaigns yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Create your first SMS campaign to start reaching your audience with targeted messages."}),e.jsxs(p,{onClick:l,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Create Your First Campaign"]})]}):e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Campaign Management"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.length," campaign",s.length!==1?"s":""," total",R.length!==s.length&&` • ${R.length} shown`]})]}),e.jsxs(p,{onClick:l,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"New Campaign"]})]}),e.jsx(Ls,{searchTerm:f,onSearchChange:w,statusFilter:x,onStatusFilterChange:y,sortBy:b,onSortByChange:_,sortOrder:k,onSortOrderChange:V,totalCampaigns:s.length,filteredCount:R.length}),e.jsx("div",{className:"w-full space-y-4",children:R.length===0?e.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No campaigns match your current filters."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search or filter criteria."})]}):R.map(M=>e.jsx(Is,{campaign:M,onSend:a,onResend:t,onRetry:c,onCancel:n,onPause:o,onResume:i,onDuplicate:d,onSchedule:u,onEdit:_e,onDelete:Ae,isLoading:r},M.id))}),e.jsx(Rs,{campaign:z,isOpen:!!z,onClose:()=>H(null),onSave:Me,isLoading:S}),e.jsx(Os,{campaign:N,isOpen:!!N,onClose:()=>T(null),onDelete:Ee,isLoading:h})]})},zs=()=>e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No active phone numbers found."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers before creating campaigns."})]}),Bs=()=>{const[s,a]=v.useState(!1),{campaigns:t,campaignsLoading:c,campaignsError:n,phoneNumbers:o,phoneNumbersLoading:i,phoneNumbersError:d,createCampaignMutation:u,updateCampaignMutation:j,deleteCampaignMutation:m,sendCampaignMutation:l,campaignControlMutation:r,organization:S}=Ks(),h=(N,T)=>{u.mutate({name:N,template:T},{onSuccess:()=>{a(!1)}})},f=(N,T,R)=>{j.mutate({campaignId:N,name:T,template:R})},w=N=>{m.mutate(N)},x=N=>{l.mutate({campaignId:N})},y=N=>{l.mutate({campaignId:N,isResend:!0})},b=N=>{l.mutate({campaignId:N,isRetry:!0})},_=N=>{r.mutate({campaignId:N,action:"cancel"})},k=N=>{r.mutate({campaignId:N,action:"pause"})},V=N=>{r.mutate({campaignId:N,action:"resume"})},z=N=>{const T=t.find(R=>R.id===N);T&&(u.mutate({name:`${T.name} (Copy)`,template:T.message_template}),g({title:"Campaign duplicated successfully"}))},H=N=>{g({title:"Scheduling feature coming soon",description:"Campaign scheduling will be available in the next update."})};return c||i?e.jsx("div",{className:"w-full",children:e.jsxs(A,{className:"w-full",children:[e.jsx(q,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(E,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]})}):n||d?e.jsx("div",{className:"w-full",children:e.jsxs(A,{className:"w-full",children:[e.jsx(q,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 rounded-lg",children:[e.jsx(Se,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Failed to load campaigns or phone numbers"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:(n==null?void 0:n.message)||(d==null?void 0:d.message)||"An unexpected error occurred"})]})]})})]})}):e.jsx("div",{className:"w-full",children:e.jsxs(A,{className:"w-full",children:[e.jsx(q,{children:e.jsx(D,{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"SMS Campaigns"]})})}),e.jsx(E,{className:"space-y-6 p-6",children:o.length===0?e.jsx(zs,{}):e.jsxs("div",{className:"w-full space-y-6",children:[s&&e.jsx("div",{className:"w-full",children:e.jsx(Ts,{onSubmit:h,onCancel:()=>a(!1),isLoading:u.isPending,phoneNumbersCount:o.length,organizationName:S==null?void 0:S.name})}),e.jsx("div",{className:"w-full",children:e.jsx(Us,{campaigns:t,onSend:x,onResend:y,onRetry:b,onCancel:_,onPause:k,onResume:V,onDuplicate:z,onSchedule:H,onEdit:f,onDelete:w,onCreateNew:()=>a(!0),isLoading:l.isPending||r.isPending,isEditLoading:j.isPending,isDeleteLoading:m.isPending})})]})})]})})},Qs=()=>e.jsx("div",{className:"w-full mt-6",children:e.jsxs(ns,{defaultValue:"phone-numbers",className:"w-full",children:[e.jsxs(rs,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(je,{value:"phone-numbers",className:"flex-1",children:"Phone Numbers"}),e.jsx(je,{value:"campaigns",className:"flex-1",children:"Campaigns"})]}),e.jsx(fe,{value:"phone-numbers",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Ds,{})})}),e.jsx(fe,{value:"campaigns",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Bs,{})})})]})}),Ws=()=>{const{organization:s}=X(),a=Z(),{data:t,isLoading:c,error:n}=J({queryKey:["organization-sms-settings",s==null?void 0:s.id],queryFn:async()=>{console.log("Fetching SMS settings for organization:",s==null?void 0:s.id);const{data:i,error:d}=await C.from("organizations").select("sms_enabled, sms_sender_id, sms_settings, webhook_secret").eq("id",s.id).single();if(d)throw console.error("Error fetching organization SMS settings:",d),d;return console.log("Organization SMS settings fetched:",i),i},enabled:!!(s!=null&&s.id),retry:3,retryDelay:1e3}),o=F({mutationFn:async i=>{if(!(s!=null&&s.id))throw new Error("Organization not found");console.log("Updating SMS status:",{enabled:i,orgId:s.id});const{data:d,error:u}=await C.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:i,senderId:(t==null?void 0:t.sms_sender_id)||"",username:te(t==null?void 0:t.sms_settings,"username"),apiKey:te(t==null?void 0:t.sms_settings,"apiKey")}});if(u)throw console.error("SMS status update error:",u),new Error(u.message||"Failed to update SMS settings");return console.log("SMS status updated successfully:",d),d},onSuccess:()=>{g({title:"SMS status updated successfully"}),a.invalidateQueries({queryKey:["organization-sms-settings",s==null?void 0:s.id]})},onError:i=>{console.error("SMS toggle error:",i),g({title:"Error updating SMS status",description:i.message||"An unexpected error occurred",variant:"destructive"})}});return{orgData:t,isLoading:c,error:n,updateSmsStatus:o,organization:s}},$s=()=>{const{isAdmin:s,isOrgAdmin:a}=oe(),[t,c]=v.useState(null),{orgData:n,isLoading:o,error:i,updateSmsStatus:d,organization:u}=Ws(),j=s||a,m=r=>{if(!j){g({title:"Access denied",description:"You need admin access to manage SMS settings",variant:"destructive"});return}if(!(u!=null&&u.id)){g({title:"Error",description:"Organization not found",variant:"destructive"});return}d.mutate(r)};if(!j)return e.jsx(Es,{});if(o)return e.jsx(Ms,{});if(i){const r=typeof i=="string"?i:"Failed to load SMS settings";return e.jsx(As,{message:r})}const l=(n==null?void 0:n.sms_enabled)&&ks(n==null?void 0:n.sms_settings);return e.jsx("div",{className:"w-full",children:e.jsxs(A,{className:"w-full",children:[e.jsx(_s,{}),e.jsxs(E,{className:"space-y-6 p-6",children:[e.jsx(ws,{enabled:(n==null?void 0:n.sms_enabled)||!1,onToggle:m,isLoading:d.isPending}),(n==null?void 0:n.sms_enabled)&&e.jsx(Cs,{webhookSecret:(n==null?void 0:n.webhook_secret)||"",isVisible:!0,isFlaskWrapper:!0}),e.jsx(Ss,{selectedProvider:t,onProviderSelect:c}),t==="sms-provider"&&e.jsx(bs,{organization:u,currentSettings:n,onSettingsUpdate:()=>{}}),l&&e.jsx("div",{className:"w-full",children:e.jsx(Qs,{})})]})]})})},Js=()=>{const{isAdmin:s,isOrgAdmin:a}=oe();return X(),s||a?e.jsxs("div",{className:"w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."})]}),e.jsx("div",{className:"w-full",children:e.jsx($s,{})}),e.jsx("div",{className:"w-full",children:e.jsx(Ns,{})})]}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage integrations."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]})};export{Js as IntegrationsTab,Js as default};
