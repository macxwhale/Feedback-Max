import{c as y,j as e,C as d,k as u,q as g,l as m,r as p,B as x,aT as z,aU as A,i as N,aV as L,a0 as B,T as E,m as P,aW as D,w as F,x as I,y as C,z as _}from"./index-BOg6IISU.js";import{u as V}from"./useAnalyticsTableData-BPy5LO4G.js";import{f as q}from"./format-D1Mm8Wx_.js";import{P as O}from"./PermissionGuard-chs8jsE8.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=y("Frown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=y("Meh",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"8",x2:"16",y1:"15",y2:"15",key:"1xb1d9"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=y("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=y("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),$=({sentimentStats:t,totalQuestions:s})=>{const n=s>0?Math.round(t.positive/s*100):0,r=s>0?Math.round(t.negative/s*100):0,c=s>0?Math.round(t.neutral/s*100):0;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(d,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Positive Sentiment"}),e.jsx(T,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[n,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.positive," out of ",s," questions"]})]})]}),e.jsxs(d,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Negative Sentiment"}),e.jsx(S,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:[r,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.negative," out of ",s," questions"]})]})]}),e.jsxs(d,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Neutral Sentiment"}),e.jsx(k,{className:"h-4 w-4 text-gray-600"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-600",children:[c,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.neutral," out of ",s," questions"]})]})]})]})},R=({sentiment:t,className:s="w-4 h-4"})=>{switch(t){case"positive":return e.jsx(T,{className:`text-green-600 ${s}`});case"negative":return e.jsx(S,{className:`text-red-600 ${s}`});case"neutral":default:return e.jsx(k,{className:`text-gray-600 ${s}`})}},w=t=>{switch(t){case"positive":return"bg-green-100 text-green-800";case"negative":return"bg-red-100 text-red-800";case"neutral":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},U=t=>{const s={positive:0,negative:0,neutral:0};return t.forEach(n=>{n.sentiment==="positive"?s.positive++:n.sentiment==="negative"?s.negative++:s.neutral++}),s},G=t=>{const s=t.positive+t.negative+t.neutral;if(s===0)return"neutral";const n=t.positive/s,r=t.negative/s;return n>.6?"positive":r>.4?"negative":"neutral"},H=({textResponses:t,questionText:s})=>{const[n,r]=p.useState(!1),[c,f]=p.useState(5),[l,o]=p.useState("all"),a=t.filter(i=>l==="all"?!0:i.sentiment===l),h=i=>{switch(i){case"positive":return"bg-green-100 text-green-800";case"negative":return"bg-red-100 text-red-800";case"neutral":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},j=i=>{switch(i){case"positive":return"ðŸ˜Š";case"negative":return"ðŸ˜ž";case"neutral":return"ðŸ˜";default:return"ðŸ˜"}},v=a.slice(0,c),b=a.length>c;return t.length===0?null:e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>r(!n),className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"View Comments (",t.length,")",n?e.jsx(z,{className:"w-4 h-4"}):e.jsx(A,{className:"w-4 h-4"})]}),n&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:l==="all"?"default":"outline",size:"sm",onClick:()=>o("all"),children:"All"}),e.jsx(x,{variant:l==="positive"?"default":"outline",size:"sm",onClick:()=>o("positive"),children:"Positive"}),e.jsx(x,{variant:l==="negative"?"default":"outline",size:"sm",onClick:()=>o("negative"),children:"Negative"}),e.jsx(x,{variant:l==="neutral"?"default":"outline",size:"sm",onClick:()=>o("neutral"),children:"Neutral"})]})]}),n&&e.jsxs("div",{className:"space-y-3",children:[v.map((i,K)=>e.jsx(d,{className:"p-4 bg-gray-50",children:e.jsxs(m,{className:"p-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(N,{className:h(i.sentiment||"neutral"),children:[j(i.sentiment||"neutral")," ",i.sentiment||"neutral"]}),i.score>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(L,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),i.score,"/5"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(B,{className:"w-3 h-3"}),q(new Date(i.created_at),"MMM d, yyyy")]})]}),e.jsx("div",{className:"text-sm text-gray-700 leading-relaxed",children:e.jsx(W,{text:i.response_value})})]})},i.id)),b&&e.jsx("div",{className:"text-center",children:e.jsx(x,{variant:"outline",size:"sm",onClick:()=>f(i=>i+5),children:"Load More Comments"})}),a.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No comments match the selected filter."})]})]})},W=({text:t})=>{const[s,n]=p.useState(!1);return t.length>200?e.jsxs("div",{children:[e.jsx("span",{children:s?t:t.substring(0,200)+"..."}),e.jsx(x,{variant:"ghost",size:"sm",className:"ml-2 p-0 h-auto text-blue-600 hover:text-blue-800",onClick:()=>n(!s),children:s?"Read Less":"Read More"})]}):e.jsx("span",{children:t})},Y=({questionSentiments:t})=>e.jsxs(d,{children:[e.jsx(u,{children:e.jsx(g,{children:"Question Sentiment Analysis"})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-4",children:t.map((s,n)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(R,{sentiment:s.sentiment}),e.jsx(N,{className:w(s.sentiment),children:s.sentiment}),s.question_type==="text"&&s.text_responses&&s.text_responses.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(M,{className:"w-4 h-4"}),s.text_responses.length," comment",s.text_responses.length!==1?"s":""]})]}),e.jsx("h4",{className:"font-medium text-sm",children:s.question_text}),e.jsxs("p",{className:"text-xs text-gray-600",children:[s.total_responses," responses â€¢ ",s.completion_rate,"% completion"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold",children:[s.completion_rate,"%"]}),s.sentiment==="negative"&&e.jsx(E,{className:"w-4 h-4 text-red-500 ml-auto mt-1"}),s.sentiment==="positive"&&e.jsx(P,{className:"w-4 h-4 text-green-500 ml-auto mt-1"})]})]}),s.question_type==="text"&&s.text_responses&&s.text_responses.length>0&&e.jsx(H,{textResponses:s.text_responses,questionText:s.question_text})]},n))})})]}),Z=({categorySentiments:t})=>e.jsxs(d,{children:[e.jsx(u,{children:e.jsx(g,{children:"Category Sentiment Analysis"})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-4",children:t.map((s,n)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(R,{sentiment:s.sentiment}),e.jsx(N,{className:w(s.sentiment),children:s.sentiment})]}),e.jsx("h4",{className:"font-medium text-sm",children:s.category}),e.jsxs("p",{className:"text-xs text-gray-600",children:[s.total_questions," questions â€¢ ",s.total_responses," responses"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold",children:s.total_questions}),e.jsx("div",{className:"text-xs text-gray-500",children:"Questions"})]})]},n))})})]}),J=({organizationId:t})=>{const{data:s,isLoading:n}=V(t);if(n)return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(a=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},a))})]})});if(!s)return e.jsx(d,{children:e.jsxs(m,{className:"p-6 text-center",children:[e.jsx(D,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No sentiment data available"})]})});const r=s.questions.map(a=>{const h=a.trend==="positive"?"positive":a.trend==="negative"?"negative":"neutral";return{question_text:a.question_text,sentiment:h,total_responses:a.total_responses,completion_rate:a.completion_rate,question_type:a.question_type,text_responses:a.text_responses||[]}}),c=U(r),f=r.length,l=G(c),o=s.categories.map(a=>{const h=a.questions.filter(i=>i.trend==="positive").length,j=a.questions.length,v=j>0?h/j:0,b=v>.6?"positive":v<.3?"negative":"neutral";return{category:a.category,sentiment:b,total_questions:a.total_questions,total_responses:a.total_responses}});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Sentiment Analysis"}),e.jsxs(N,{className:w(l),children:["Overall: ",l]})]}),e.jsx($,{sentimentStats:c,totalQuestions:f,overallScore:0}),e.jsxs(F,{defaultValue:"questions",className:"w-full",children:[e.jsxs(I,{className:"grid grid-cols-2 w-full max-w-md",children:[e.jsx(C,{value:"questions",children:"By Question"}),e.jsx(C,{value:"categories",children:"By Category"})]}),e.jsx(_,{value:"questions",className:"space-y-4",children:e.jsx(Y,{questionSentiments:r})}),e.jsx(_,{value:"categories",className:"space-y-4",children:e.jsx(Z,{categorySentiments:o})})]})]})},te=({organizationId:t})=>e.jsx(O,{permission:"view_analytics",organizationId:t,showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need viewer-level access or higher to view sentiment analysis."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsx(J,{organizationId:t})});export{te as SentimentTab,te as default};
